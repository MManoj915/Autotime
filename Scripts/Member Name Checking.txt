SELECT POLICYID,FIRST_NAME FROM(SELECT GRP.GROUP_NAME,iMA.AGENT_NAME_EN AGENTNAME,
IMB.BROKER_NAME_EN BROKERNAME,IP.POLICYID,IP.POLICYNAME,
IM.FIRST_NAME,IM.MIDDLENAME,IM.LAST_NAME,To_Date(IM.DATE_OF_BIRTH,'DD/MM/RRRR') DATE_OF_BIRTH,GEN.CONSTANTNAME GENDERNAME,
GEN1.CONSTANTNAME NATIONALITYNAME,IM.PASSPORT_NO,GEN2.CONSTANTNAME MARITLA_STATUS,IM.EMAILID,
GENC1.CONSTANTNAME RESIDENTLOCATION,GENC2.CONSTANTNAME WORKLOCATION,GENC3.CONSTANTNAME SALARYBANDNAME,GENC4.CONSTANTNAME COMMISSIONTYPENAME,
IM.EMIRATES_ID,IM.UIDNUMBER,GENC5.CONSTANTNAME ENTITYTYPENAME,GENC6.CONSTANTNAME ENTITYIDNAME,IP.EMAILID PRODUCTEMAILID,IP.CONTACTNUMBER PRODUCTCONTACTNUMBER
FROM IM_MEMBERPOLICY IMP
JOIN IM_MEMBERS IM ON IM.MEMBER_CODE = IMP.MEMBERCODE
JOIN IM_POLICY IP ON IMP.POLICYCODE = IP.POLICYCODE AND IMP.TYPEE = 1
JOIN IM_GROUPS GRP ON GRP.GROUP_CODE = IP.GROUPCODE
LEFT JOIN GENCONSTANT GEN ON GEN.CONSTANTVALUE = IM.GENDER AND  GEN.CATEGORY ='Gender' AND GEN.LANGUAGECODE = 'en-US'
LEFT JOIN GENCONSTANT GEN1 ON GEN1.CONSTANTVALUE = IM.NATIONALITY AND  GEN1.CATEGORY ='FND_NATIONALITY' AND GEN1.LANGUAGECODE = 'en-US'
LEFT JOIN GENCONSTANT GEN2 ON GEN2.CONSTANTVALUE = IM.MARITAL_STATUS AND GEN2.CATEGORY='MARITAL_STATUS' AND GEN2.LANGUAGECODE = 'en-US'
LEFT JOIN GENCONSTANT GENC1 ON GENC1.CATEGORY='MEMBERLOCATION' AND GENC1.CONSTANTVALUE=IM.RESIDENTLOCATION AND GENC1.LANGUAGECODE= 'en-US'  
LEFT JOIN GENCONSTANT GENC2 ON GENC2.CATEGORY='MEMBERLOCATION' AND GENC2.CONSTANTVALUE=IM.WORKLOCATION AND GENC2.LANGUAGECODE= 'en-US'  
LEFT JOIN GENCONSTANT GENC3 ON GENC3.CATEGORY='SALARYBANDTYPE' AND GENC3.CONSTANTVALUE=IM.SALARYBAND AND GENC3.LANGUAGECODE='en-US'    
LEFT JOIN GENCONSTANT GENC4 ON GENC4.CATEGORY='MEMYSENO' AND GENC4.CONSTANTVALUE=IM.ISCOMMISSION AND GENC4.LANGUAGECODE='en-US'   
LEFT JOIN GENCONSTANT GENC5 ON GENC5.CATEGORY='ENTITYTYPE' AND GENC5.CONSTANTVALUE=IM.ENTITYTYPE AND GENC5.LANGUAGECODE='en-US'    
LEFT JOIN GENCONSTANT GENC6 ON GENC6.CATEGORY='ENTITYID' AND GENC6.CONSTANTVALUE=IM.ENTITYID AND GENC6.LANGUAGECODE='en-US'                                                          
LEFT JOIN IM_AGENTS IMA ON IMA.AGENTCODE =  IP.AGENTCODE
LEFT JOIN IM_BROKERS IMB ON IMB.BROKERCODE =  IP.BROKERCODE  
WHERE SYSDATE BETWEEN IMP.MEMBERSTARTDATE AND NVL(IMP.MEMBERENDDATE,IMP.POLICYENDDDATE)) GROUP BY 
POLICYID,FIRST_NAME
HAVING Count(*) > 1                                                