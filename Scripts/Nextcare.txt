DECLARE L_MEMBERPOLICYCODE NUMBER;L_SERIALNO NUMBER;
BEGIN
SELECT Max(MEMBERPOLICYCODE)+1 INTO L_MEMBERPOLICYCODE FROM IM_MEMBERPOLICY;
SELECT Max(SERIALNO)+1 INTO L_SERIALNO FROM IM_MEMBERPOLICY;
INSERT INTO IM_MEMBERPOLICY
SELECT L_MEMBERPOLICYCODE+ROWNUM,H.MEMBER_CODE,H.POLICYCODE,H.COVERED_FROM_DATE,P.ENDDATE,P.STARTDATE,P.ENDDATE, 
1, 1, NULL, NULL,SYSDATE, 100000000000000002, NULL, 100000000000000002, 100000000000000001, 100000000000000001, 
L_SERIALNO+ROWNUM,H.CATEGORY_CODE,SYSDATE,0, 2, 1, 0, 
NULL, NULL,H.DATE_OF_BIRTH, H.GENDER, H.RELATION, NULL, H.MARITAL_STATUS, H.MEMBER_ID, H.FIRST_NAME||' '||H.MIDDLENAME||' '||H.LAST_NAME, 
H.GROUP_CODE, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 
NULL, NULL, H.FIRST_NAME, H.LAST_NAME,H.FIRST_NAME,H.NATIONALITY, H.EMIRATES_ID, H.MOBILE_NUMBER, 
H.PHONE_NUMBER, NULL, H.RELATION, H.MARITAL_STATUS, H.CARDNO, H.EMAILID, NULL, NULL, NULL, NULL, NULL, 
H.PHONE_NUMBER, H.MOBILE_NUMBER, H.EMAILID, H.PASSPORT_NO, NULL, NULL, H.STAFF_ID, '1',H.MEMBERSINCE, H.APOLICYID,H.APOLICYNAME, 
H.CARDNO, NULL, NULL, NULL, H.WORKLOCATION, H.RESIDENTLOCATION, H.ISCOMMISSION, H.SALARYBAND, H.UIDNUMBER, NULL, 
NULL, NULL, NULL,NULL, NULL, NULL, 0         
FROM IM_MEMBERS H
JOIN IM_INDIVIDUALPOLICY P ON P.INDIVIDUALPOLICYCODE = H.POLICYCODE
WHERE H.POLICYTYPE=2 AND UPS=1206;
COMMIT;
END;


DECLARE L_MEMBERCODE NUMBER;L_SERIALNO NUMBER;
BEGIN
SELECT Max(MEMBER_CODE) INTO L_MEMBERCODE FROM   IM_MEMBERS;
SELECT Max(SERIALNO) INTO L_SERIALNO FROM   IM_MEMBERS;
INSERT INTO IM_MEMBERS
SELECT P.GROUPCODE, L_MEMBERCODE+ROWNUM,H.BENEFICIARYID, 1, H.BENEFICIARYFIRSTNAME, H.BENEFICIARYFAMILYNAME, H.BENEFICIARYFIRSTNAME , NULL, 
NULL,To_Date(H.DOB,'DD/MM/RRRR'),G1.CONSTANTVALUE,G5.CONSTANTVALUE,NULL,G3.CONSTANTVALUE, G3.CONSTANTVALUE, NULL, H.IDNUMBER, 
H.MOBILENBR, H.MOBILENBR,To_Date(H.EFFECTIVEDATE,'DD/MM/RRRR'),To_Date(H.EFFECTIVEDATE,'DD/MM/RRRR'), To_Date(H.EXPIRYDATE,'DD/MM/RRRR'), 
NULL, 1, NULL, 100000000000000002, NULL, 100000000000000002, 100000000000000001, 100000000000000001, 1, 1, 
L_SERIALNO+ROWNUM, NULL, 100000000000000003, G5.CONSTANTVALUE, 0, 0, 0, G2.CONSTANTVALUE, NULL,H.CARDNUMBER, 100000000000000271, 
To_Date(H.EXPIRYDATE,'DD/MM/RRRR'),H.CARDNUMBER, H.EMAILADDRESS, NULL, NULL, NULL, NULL, NULL, To_Date(H.EFFECTIVEDATE,'DD/MM/RRRR'),
NULL, NULL, NULL, NULL, NULL, NULL, NULL, H.MOBILENBR, H.MOBILENBR,H.EMAILADDRESS, 
H.PASSPORTNUMBER, NULL, NULL,H.STAFFNBR, NULL, NULL, 1, 0,NULL,NULL, 
NULL, P.POLICYCODE,1,NULL,NULL, NULL, NULL,NULL,NULL, 
'A', NULL, NULL, NULL, NULL, NULL, NULL, NULL, 
NULL,NULL,To_Date(H.EFFECTIVEDATE,'DD/MM/RRRR'),P.POLICYID,P.POLICYNAME, NULL, H.STAFFNBR, NULL, 
NULL, NULL, NULL, NULL, NULL, G4.CONSTANTVALUE, G4.CONSTANTVALUE, 2, H.SALARY, H.UIDNUMBER, 
NULL, 1, NULL, H.BENEFICIARYMIDDLENAME, 1, NULL, H.UIDNUMBER,G3.CONSTANTVALUE,1206,
'',NULL,NULL,'',NULL,NULL,''   FROM  IM_PR_NXT_ACTIVE_LIST H
JOIN IM_POLICY  P ON P.POLICYID = H .EXTREF        
LEFT JOIN GENCONSTANT G1 ON G1.CATEGORY = 'GENDER' AND Upper(G1.CONSTANTNAME) = Upper(H.GENDER) AND Upper(G1.LANGUAGECODE) = 'EN-US'
LEFT JOIN GENCONSTANT G2 ON G2.CATEGORY = 'MARITALSTATUS' AND Upper(G2.CONSTANTNAME) = Upper(H.MARITALSTATUS) AND Upper(G2.LANGUAGECODE) = 'EN-US'
LEFT JOIN GENCONSTANT G3 ON G3.CATEGORY = 'FND_NATIONALITY' AND Upper(G3.CONSTANTNAME) = Upper(H.NATIONALITY) AND Upper(G3.LANGUAGECODE) = 'EN-US'
LEFT JOIN GENCONSTANT G4 ON G4.CATEGORY = 'MEMBERLOCATION' AND Upper(G4.CONSTANTNAME) = Upper(H.SUBREGION) AND Upper(G4.LANGUAGECODE) = 'EN-US'
LEFT JOIN GENCONSTANT G5 ON G5.CATEGORY = 'MEMBERRELATION' AND Upper(G5.CONSTANTNAME) = Upper(H.DEPENDENCY) AND Upper(G5.LANGUAGECODE) = 'EN-US'
WHERE P.POLICYID IS NOT NULL --AND H.DEPENDENCY<>'SELF'
AND OWNERCODE IN(1,7,8,17,18);
COMMIT;
END;