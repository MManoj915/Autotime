BEGIN
FOR HDR IN(SELECT AGENTCODE,PINCODE FROM IM_AGENTS_BILLING_DETAIL WHERE AGENTCODE NOT IN(
SELECT AGENTCODE FROM IM_CREDITMODULE_DTL WHERE BILLINGTYPE = 0 AND AGENTCODE IS NOT NULL)) LOOP     
Insert into CAPPS.IM_CREDITMODULE_DTL
(CREDITMODULECODE, 
CREDITMODULEDTLCODE, BILLINGTYPE, AGENTCODE, BROKERCODE, GROUPCODE, 
CREDITLIMIT, CREDITDAYS, ISBLACKLIST, CREATEDON, CREATEDBY, 
LASTMODIFIEDON, LASTMODIFIEDBY, COMPANYCODE, LOCATIONCODE, SERIALNO, 
OUTSTANDINGAMOUNT, PINCODE, ISMANUAL, TPAPREMIUM, TPAPAYABLE, 
COMMISSIONPREMIUM, COMMISSIONPAYABLE, ALLOW)
Values
(100000000000000221, (SELECT Max(CREDITMODULEDTLCODE)+1 FROM IM_CREDITMODULE_DTL), 0, HDR.AGENTCODE, NULL, 
NULL, 0, 3000, 0, SYSDATE, 
100000000000000002,SYSDATE, 100000000000000002, 1, 1, 
(SELECT Max(SERIALNO)+1 FROM IM_CREDITMODULE_DTL), 0, HDR.PINCODE, 0, NULL, 
NULL, NULL, NULL, NULL);
COMMIT;
END LOOP;
FOR HDR IN(SELECT BROKERCODE,PROVIDERPINCODE FROM IM_BROKER_BILLING_DETAIL WHERE BROKERCODE NOT IN(
SELECT BROKERCODE FROM IM_CREDITMODULE_DTL WHERE BILLINGTYPE = 1 AND BROKERCODE IS NOT NULL)) LOOP     
Insert into CAPPS.IM_CREDITMODULE_DTL
(CREDITMODULECODE, 
CREDITMODULEDTLCODE, BILLINGTYPE, AGENTCODE, BROKERCODE, GROUPCODE, 
CREDITLIMIT, CREDITDAYS, ISBLACKLIST, CREATEDON, CREATEDBY, 
LASTMODIFIEDON, LASTMODIFIEDBY, COMPANYCODE, LOCATIONCODE, SERIALNO, 
OUTSTANDINGAMOUNT, PINCODE, ISMANUAL, TPAPREMIUM, TPAPAYABLE, 
COMMISSIONPREMIUM, COMMISSIONPAYABLE, ALLOW)
Values
(100000000000000222, (SELECT Max(CREDITMODULEDTLCODE)+1 FROM IM_CREDITMODULE_DTL), 1,NULL, HDR.BROKERCODE, 
NULL, 0, 3000, 0, SYSDATE, 
100000000000000002,SYSDATE, 100000000000000002, 1, 1, 
(SELECT Max(SERIALNO)+1 FROM IM_CREDITMODULE_DTL), 0, HDR.PROVIDERPINCODE, 0, NULL, 
NULL, NULL, NULL, NULL);
COMMIT;
END LOOP;
FOR HDR IN(SELECT GROUPCODE,Trim(REPLACE(PINCODE,' ',''))PINCODE FROM IM_GROUP_BILLING_DETAIL WHERE GROUPCODE NOT IN(
SELECT GROUPCODE FROM IM_CREDITMODULE_DTL WHERE BILLINGTYPE = 2 AND GROUPCODE IS NOT NULL)) LOOP     
Insert into CAPPS.IM_CREDITMODULE_DTL
(CREDITMODULECODE, 
CREDITMODULEDTLCODE, BILLINGTYPE, AGENTCODE, BROKERCODE, GROUPCODE, 
CREDITLIMIT, CREDITDAYS, ISBLACKLIST, CREATEDON, CREATEDBY, 
LASTMODIFIEDON, LASTMODIFIEDBY, COMPANYCODE, LOCATIONCODE, SERIALNO, 
OUTSTANDINGAMOUNT, PINCODE, ISMANUAL, TPAPREMIUM, TPAPAYABLE, 
COMMISSIONPREMIUM, COMMISSIONPAYABLE, ALLOW)
Values
(100000000000000223, (SELECT Max(CREDITMODULEDTLCODE)+1 FROM IM_CREDITMODULE_DTL), 2,NULL, NULL, 
HDR.GROUPCODE, 0, 120, 0, SYSDATE, 
100000000000000002,SYSDATE, 100000000000000002, 1, 1, 
(SELECT Max(SERIALNO)+1 FROM IM_CREDITMODULE_DTL), 0, HDR.PINCODE, 0, NULL, 
NULL, NULL, NULL, NULL);
COMMIT;
END LOOP;
END;
                                                