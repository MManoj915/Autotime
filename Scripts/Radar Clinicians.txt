CREATE TABLE IM_CLI_RADAR
AS 
SELECT PRO.PROVIDERID,PRO.PROVIDERNAME,HDR.ACR_FORM_NO,HDR.INVOICENUMBER,MP.ACARDID CARDNO,MP.AMEMBERNAME MEMBERNAME,MP.APOLICYID POLICYID,
MP.APOLICYNAME POLICYNAME,To_Date(HDR.ENCOUNTER_START_DATE,'DD/MM/RRRR') TREATMENTDATE,To_Date(HDR.TRANSACTIONDATE,'DD/MM/RRRR') TRANSACTIONDATE,
(SELECT Max(LICENSEID) FROM IM_CLINICIANS WHERE LICENSEID = Nvl(ECA.CLINICIAN,ECA.ORDERINGCLINICIAN)) LICENSEID,
(SELECT Max(NAME) FROM IM_CLINICIANS WHERE LICENSEID = Nvl(ECA.CLINICIAN,ECA.ORDERINGCLINICIAN)) NAME,
IBC.BENEFIT_ID,IBC.BENEFIT_NAME, (SELECT LISTAGG (IMVD.SHORTDESC, ',') WITHIN GROUP (ORDER BY IMVD.SHORTDESC) FROM
 (SELECT ACTIVITY_DETAIL_CODE,CLAIM_CODE,ACTIVITY_CODE,VERSIONDETAILCODE FROM IM_CLAIM_PROCESS_DETAIL) DTL
 LEFT JOIN IM_ACTIVITY_TYPES  ACTTYP ON ACTTYP.TYPECODE=DTL.ACTIVITY_CODE
 JOIN (SELECT DETAILCODE,SHORTDESC FROM IM_VERSION_DETALIS) IMVD ON IMVD.DETAILCODE = DTL.VERSIONDETAILCODE
 WHERE ACTTYP.VALUE = -1 AND DTL.CLAIM_CODE = HDR.CLAIM_CODE GROUP BY DTL.CLAIM_CODE ) ICDCODES,
IVD.CODE,IVD.SHORTDESC DESCRIPTION,DTL.REQUESTAMOUNT CLAIMEDAMOUNT,DTL.DENIAL_VALUE,
DTL.TOTAL APPROVEDAMOUNT,IVDD.CODE DENIALCODE,HDR.PAYMENTREFNO,To_Date(HDR.PAYMENTREFDATE,'DD/MM/RRRR') PAYMENTREFDATE 
FROM IM_CLAIM_PROCESS_HEADER HDR
JOIN IM_CLAIM_PROCESS_DETAIL DTL ON DTL.CLAIM_CODE = HDR.CLAIM_CODE AND Nvl(DTL.TYPE,0) = 0
JOIN IM_PROVIDERS PRO ON PRO.PROVIDERCODE = HDR.PROVIDER_CODE
JOIN IM_MEMBERPOLICY MP ON MP.MEMBERPOLICYCODE = HDR.MEMBERPOLICYCODE
JOIN IM_VERSION_DETALIS IVD ON IVD.DETAILCODE = DTL.VERSIONDETAILCODE
LEFT JOIN IM_BENEFIT_CODES IBC ON IBC.BENEFIT_CODE = DTL.BENEFIT_CODE
LEFT JOIN IM_VERSION_DETALIS IVDD ON IVDD.DETAILCODE = DTL.DENIAL_REASON
JOIN ECLAIM_ACTIVITIES ECA ON ECA.SYS_ACTIVITY_ID = DTL.SYS_ACTIVITY_ID AND ECA.SYS_CLAIM_ID = HDR.MAP_VALUE
WHERE To_Date(HDR.ENCOUNTER_START_DATE,'DD/MM/RRRR') BETWEEN To_Date('01/01/2016','DD/MM/RRRR')
AND  To_Date('07/04/2018','DD/MM/RRRR') AND Nvl(ECA.CLINICIAN,ECA.ORDERINGCLINICIAN) IN
(SELECT * FROM IMCA)
