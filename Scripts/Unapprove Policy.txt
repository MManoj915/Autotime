DECLARE L_FINANCECOUNT NUMBER;
BEGIN
FOR HDR IN(SELECT * FROM IM_INDIVIDUALPOLICY WHERE POLICYID IN ('P-10898-0002','1538-03','P-10924-0002','1461-03','1672-03')) LOOP
SELECT Count(*) INTO L_FINANCECOUNT
FROM IM_POLICYFINANCEPOSTING WHERE INDIVIDUALPOLICYCODE = HDR.INDIVIDUALPOLICYCODE
AND POLICYTYPECODE = 2;
IF L_FINANCECOUNT = 0 THEN
DELETE FROM IM_CORDPRINT WHERE MEMBERPOLICYCODE IN
(SELECT MEMBERPOLICYCODE FROM IM_MEMBERPOLICY WHERE POLICYCODE = HDR.INDIVIDUALPOLICYCODE AND TYPEE = 2);
COMMIT;
DELETE FROM IM_MEMBERPOLICY WHERE POLICYCODE = HDR.INDIVIDUALPOLICYCODE AND TYPEE = 2;
COMMIT;
UPDATE IM_MEMBERS SET POLICYCODE = HDR.OLDPOLICYCODE WHERE POLICYCODE = HDR.INDIVIDUALPOLICYCODE AND POLICYTYPE = 2;
COMMIT;
UPDATE IM_INDIVIDUALPOLICY SET AUTHORIZEDSTATUS = 0,POSTINGDONE = 0 WHERE INDIVIDUALPOLICYCODE = HDR.INDIVIDUALPOLICYCODE;
COMMIT;
END IF;
END LOOP;
END; 


DECLARE L_FINANCECOUNT NUMBER;
BEGIN
FOR HDR IN(SELECT * FROM IM_POLICY WHERE POLICYID IN ('P-10898-0002','1538-03','P-10924-0002','1461-03','1672-03')) LOOP
SELECT Count(*) INTO L_FINANCECOUNT
FROM IM_POLICYFINANCEPOSTING WHERE POLICYCODE = HDR.POLICYCODE
AND POLICYTYPECODE = 1;
IF L_FINANCECOUNT = 0 THEN
DELETE FROM IM_CORDPRINT WHERE MEMBERPOLICYCODE IN
(SELECT MEMBERPOLICYCODE FROM IM_MEMBERPOLICY WHERE POLICYCODE = HDR.POLICYCODE AND TYPEE = 1);
COMMIT;
DELETE FROM IM_MEMBERPOLICY WHERE POLICYCODE = HDR.POLICYCODE AND TYPEE = 1;
COMMIT;
UPDATE IM_MEMBERS SET POLICYCODE = HDR.OLDPOLICYCODE WHERE POLICYCODE = HDR.POLICYCODE AND POLICYTYPE = 1;
COMMIT;
UPDATE IM_POLICY SET AUTHORIZEDSTATUS = 0,POSTINGDONE = 0 WHERE POLICYCODE = HDR.POLICYCODE;
COMMIT;
END IF;
END LOOP;
END; 