CREATE OR REPLACE FUNCTION NGI_PR_CREATE_POLICY_ORAFNC(P_PAYMENTCODE NUMBER,P_RESULT OUT NUMBER) RETURN VARCHAR2
AS
L_ERROR VARCHAR2(1000);L_SEQ NUMBER;
L_SPONSOR_ROW ROWTYPE%IM_PR_SPONSOR;
L_SPONSOR_APP_ROW ROWTYPE%IM_PR_SPONSOR_APPLICATION;
L_STAFF_ROW ROWTYPE%IM_PR_STAFF;
L_OWNERCODE VARCHAR2(1000);
L_POLICYID VARCHAR2(1000);
L_POLICYNAME VARCHAR2(1000);
L_SOURCETYPE NUMBER;L_SOURCECODE NUMBER;
L_APPLICANTID VARCHAR2(100);
L_RULES VARCHAR2(1000);
L_STAFFCOUNT NUMBER;L_AGENTCODE NUMBER;L_ERRORCOUNT NUMBER;
L_AGENTCOUNT NUMBER;L_INDIVIDUALPOLICYCODE NUMBER;
L_INDIVIDUALPOLICYCOUNT NUMBER;L_GROUPCODE NUMBER;
L_AGENTNAME  VARCHAR2(1000); L_POLICYCODE NUMBER;
L_DEFAULTVALUE NUMBER;L_POLICYCOUNT NUMBER;L_LICENSECOUNT NUMBER;
BEGIN

SELECT * INTO L_SPONSOR_ROW FROM IM_PR_SPONSOR WHERE SPONSOR_CODE IN(SELECT SPONSOR_CODE FROM IM_PR_PAYMENT_HDR WHERE PAYMENTCODE = P_PAYMENTCODE);
         
SELECT * INTO L_SPONSOR_APP_ROW FROM   IM_PR_SPONSOR_APPLICATION
WHERE APPLICATIONCODE IN(SELECT APPLICATIONCODE FROM IM_PR_PAYMENT_DTL WHERE PAYMENTCODE = P_PAYMENTCODE);

IF Nvl(L_SPONSOR_ROW.STAFFCODE,0) <> 0 THEN
  SELECT * INTO L_STAFF_ROW FROM IM_PR_STAFF WHERE STAFFCODE = L_SPONSOR_ROW.STAFFCODE;
  IF L_STAFF_ROW.EMPTYPE = 1 THEN
     L_SOURCETYPE := 4;
     L_SOURCECODE := L_STAFF_ROW.EMPCODE;
  ELSIF L_STAFF_ROW.EMPTYPE = 2 THEN
     L_SOURCETYPE := 5;
     L_SOURCECODE := L_STAFF_ROW.EMPCODE;
  END IF;  
END IF;

IF P_SPONSOR_ROW.POLICYTYPE = 2 THEN

  SELECT Count(*) INTO L_POLICYCOUNT FROM IM_INDIVIDUALPOLICY WHERE  LOGCODE = L_SPONSOR_ROW.SPONSOR_CODE AND PORTALTYPE='PR'
  IF L_POLICYCOUNT = 0 THEN
    SELECT IM_PR_POLICY_SEQ.NEXTVAL INTO L_SEQ FROM DUAL;
    L_POLICYID := 'PR-'||L_SEQ||'-01';
    L_POLICYNAME := L_POLICYID||'-'||L_SPONSOR_ROW.FIRSTNAME||' '||L_SPONSOR_ROW.LASTNAME||'-'||TO_CHAR(To_Date(SYSDATE,'DD/MM/RRRR'),'RRRR');  
    INSERT INTO IM_INDIVIDUALPOLICY
    (INDIVIDUALPOLICYCODE,
    POLICYID, POLICYNAME, STARTDATE, ENDDATE, GROUPCODE,
    ISFRONTINGGROUP, CATEGORYCODE, PLANCODE, ACTIVE, CALCULATEFINE,
    FINETEMPLATECODE, FRONTINGSETTING, REMARKS, CREATEDIN, CREATEDON,
    CREATEDBY, LASTMODIFIEDON, LASTMODIFIEDBY, COMPANYCODE, LOCATIONCODE,
    DEACTIVATEDON, DEACTIVATEDBY, SERIALNO, ALTERNATENAME, ANUALLIMITSTYPECODE,
    INPATENTSLIMITSTYPECODE, OUTPATENTSLIMITSTYPECODE, ALTLIMITS, IPTLIMITS, OPTLIMITS,
    IPPREFIX, IPNO, IPSUFFIX, IPFULLNO, AUTHORIZEDSTATUS,
    MEMBERCODE, FINAL_PREMIUM, BASE_PERIMUM, PERIMUMCODE, ELEMENTTEMPLATECODE,
    ISMEMBERPOLICYCONVERTED, TEMPLATECODE, COMMISIONTYPE, AGENTCODE, BROKERCODE,
    OWNERCODE, HAADAPPROVALCODE, REINSURANCECODE, OLDPOLICYCODE, RENEWALPOLICYCODE,
    INDIPOLICYSOURCECODE, PAYMENTMODE, CONTRACTTYPE, INSURANCECO, EXCELVALIDATE,
    BILLINGTYPE, BRANCHCODE, POLICYSERIALNO, POSTINGDONE, NGI_FEES,
    INCEPTIONPREMIUM, ISCAPTIVE, ENTITYTYPE, ENTITYID, CONTACTNUMBER,
    EMAILID, PORTALMEMBERID,LOGCODE,PORTALTYPE,A_POLICYTYPE)
    VALUES
    ((SELECT MAX(INDIVIDUALPOLICYCODE) + 1  FROM IM_INDIVIDUALPOLICY),L_POLICYID, L_POLICYNAME,
    SYSDATE,SYSDATE+364,NULL,0, NULL, NULL, 1,0, NULL, NULL, NULL, NULL,
    SYSDATE, 100000000000000002,SYSDATE, 100000000000000002, 1,
    1, NULL, NULL, (SELECT MAX(SERIALNO) + 1 FROM IM_INDIVIDUALPOLICY), NULL,
    0, 0, 0, 0, 0,0, NULL,NULL, NULL, '',
    0, 100000000000339720, 0, 0, 0,
    NULL, 0, '65', 0,Decode(L_SOURCETYPE,5,NULL,L_SOURCECODE),
    Decode(L_SOURCETYPE,5,L_SOURCECODE,NULL),L_SPONSOR_ROW.ADMINISTRATEDBY, NULL, NULL, NULL,
    NULL, L_SOURCETYPE, 0, 0, NULL,0, 0, NULL, 1, 0,
    L_SOURCETYPE, NULL, NULL, NULL, NULL,NULL, NULL,L_APPLICANTID,L_SPONSOR_ROW.SPONSORCODE,'PR',2);
    COMMIT;

    SELECT INDIVIDUALPOLICYCODE INTO L_INDIVIDUALPOLICYCODE FROM IM_INDIVIDUALPOLICY WHERE POLICYID = L_POLICYID;

    INSERT INTO IM_NGIINDPOLICYCATEGORY
    (POLICYCATEGORYCODE, INDIVIDUALPOLICYCODE, CATEGORYCODE, ALTLIMIT, IPLIMIT, PLANCODE, CALCULATEFINE, ISFRONTINGGROUP, COMPANYCODE, CREATEDBY, LASTMODIFIEDBY, CREATEDON, LASTMODIFIEDON, LOCATIONCODE, SERIALNO, OPLIMIT, ACTIVE, MEMBERCODE, ROOMTYPE, EMGDETECTWINETWTYPE, EMGDETECTWINETWVALUE, EMGDETECTOONETWTYPE, EMGDETECTOONETWVALUE, TOTALPREMIUM, LIMITTYPE, DEDECTABLETYPE, DEDECTABLEVALUE, LIMITS, CO_IN_TYPE, CO_IN_VALUE, OONDEDECTABLETYPE, OONDEDECTABLEVALUE, OONCO_IN_TYPE, OONCO_IN_VALUE, ALERTCLAIMSTEAMREMARK, EMIRATECODE)
    VALUES
      ((SELECT MAX(POLICYCATEGORYCODE) + 1 FROM IM_NGIINDPOLICYCATEGORY), L_INDIVIDUALPOLICYCODE, 100000000000000001, 150000, 150000,
        100000000000000474, 1, 0,
        1, 100000000000000657, 100000000000000657,SYSDATE, SYSDATE,
        1, (SELECT MAX(SERIALNO) + 1 FROM IM_NGIINDPOLICYCATEGORY), 0, 1,
        100000000000313952, 0, 2, 0,
        2, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 100000000000001994);
    COMMIT;
    IF L_SPONSOR_ROW.ADMINISTRATEDBY = 11 THEN
      L_RULES := INSERTTPATREATY(L_INDIVIDUALPOLICYCODE,1,100000000000000168);
      L_RULES := INSERTTPATREATY(L_INDIVIDUALPOLICYCODE,2,100000000000000173);
      L_RULES := INSERTTPATREATY(L_INDIVIDUALPOLICYCODE,3,100000000000000172);
      L_RULES := INSERTTPATREATY(L_INDIVIDUALPOLICYCODE,5,100000000000000041);
    ELSIF L_SPONSOR_ROW.ADMINISTRATEDBY = 3 THEN
      L_RULES := INSERTTPATREATY(L_INDIVIDUALPOLICYCODE,1,100000000000000168);
      L_RULES := INSERTTPATREATY(L_INDIVIDUALPOLICYCODE,2,100000000000000173);
      L_RULES := INSERTTPATREATY(L_INDIVIDUALPOLICYCODE,3,100000000000000172);
      L_RULES := INSERTTPATREATY(L_INDIVIDUALPOLICYCODE,5,100000000000000041); 
    ELSIF L_SPONSOR_ROW.ADMINISTRATEDBY = 1 THEN
      L_RULES := INSERTTPATREATY(L_INDIVIDUALPOLICYCODE,1,100000000000000168);
      L_RULES := INSERTTPATREATY(L_INDIVIDUALPOLICYCODE,2,100000000000000173);
      L_RULES := INSERTTPATREATY(L_INDIVIDUALPOLICYCODE,3,100000000000000172);
      L_RULES := INSERTTPATREATY(L_INDIVIDUALPOLICYCODE,5,100000000000000041);      
    END IF;
    Insert into IM_IP_COMMISSION
    (IP_COMM_CODE, INDIVIDUALPOLICYCODE, COMISSION_TYPES, DEFAULTVALUE, CALC_METHOD, COMMISSION_VALUE, CREATEDIN, CREATEDON, CREATEDBY, LASTMODIFIEDON, LASTMODIFIEDBY, LEGALENTITYCODE, CUSTOMERCODE, LOCATIONCODE, SERIALNO, COMPANYCODE, COMMISSIONTO, INDPOLCYCOMMISIONTO)
    Values
    ((SELECT MAX(IP_COMM_CODE) + 1 FROM IM_IP_COMMISSION), L_INDIVIDUALPOLICYCODE, 1,0, 0,
    0, 1,SYSDATE, 100000000000000002,SYSDATE,
    100000000000000002, 100000000000000001, 100000000000000001,1,(SELECT MAX(SERIALNO) + 1 FROM IM_IP_COMMISSION),
    1, L_AGENTCODE,L_AGENTNAME);
    COMMIT;
    Insert into IM_IP_COMMISSION
    (IP_COMM_CODE, INDIVIDUALPOLICYCODE, COMISSION_TYPES, DEFAULTVALUE, CALC_METHOD, COMMISSION_VALUE, CREATEDIN, CREATEDON, CREATEDBY, LASTMODIFIEDON, LASTMODIFIEDBY, LEGALENTITYCODE, CUSTOMERCODE, LOCATIONCODE, SERIALNO, COMPANYCODE, INDPOLCYCOMMISIONTO, GENERALCOMMBILLINGCODE)
    Values
    ((SELECT MAX(IP_COMM_CODE) + 1 FROM IM_IP_COMMISSION), L_INDIVIDUALPOLICYCODE, 2,0, 0,
    0, 1, SYSDATE, 100000000000000002,SYSDATE,
    100000000000000002, 100000000000000001, 100000000000000001, 1, (SELECT MAX(SERIALNO) + 1 FROM IM_IP_COMMISSION),
    1,'FMC TPA FEE AND CLAIMS FEE',100000000000000090);
    COMMIT;

    UPDATE IM_INDIVIDUALPOLICY SET AUTHORIZEDSTATUS = 1 WHERE INDIVIDUALPOLICYCODE = L_INDIVIDUALPOLICYCODE;
    COMMIT;

  END IF;
             

ELSIF P_SPONSOR_ROW.POLICYTYPE = 1 THEN  -- GROUP POLICY

  SELECT Count(*) INTO L_POLICYCOUNT FROM IM_POLICY WHERE LOGCODE = L_SPONSOR_ROW.SPONSOR_CODE AND PORTALTYPE='PR';
  IF L_POLICYCOUNT = 0 THEN
    SELECT IM_PR_POLICY_SEQ.NEXTVAL INTO L_SEQ FROM DUAL;
    L_POLICYID := 'PR-'||L_SEQ||'-01';
    L_POLICYNAME := L_POLICYID||'-'||L_SPONSOR_ROW.FIRSTNAME||' '||L_SPONSOR_ROW.LASTNAME||'-'||TO_CHAR(To_Date(SYSDATE,'DD/MM/RRRR'),'RRRR');  
 
    Insert into IM_GROUPS
    (GROUP_CODE,GROUP_NUMBER, GROUP_NAME, ADDRESS, REMARKS, CURRENCY_CODE,
    NATURE_OF_BUSSINESS, STATUS, COMPANYCODE, CREATEDBY, LASTMODIFIEDBY,
    CREATEDON, LASTMODIFIEDON, LOCATIONCODE, SERIALNO, GROUP_ID,
    PARENT_GROUP, ISMANUALMEMBER, PICTURE, ISSTAFFNONEEDED, ISGROUPLOGONEEDED,
    ISHATHNONEEDED, PRINTGROUPTYPE, REDCARDTEXT, USERNAME, PASSWORD)
    Values
    ((SELECT MAX(GROUP_CODE) + 1 FROM IM_GROUPS),L_POLICYID, L_SPONSOR_ROW.FIRSTNAME||' ' ||L_SPONSOR_ROW.LASTNAME,NULL, NULL,
    0,L_POLICYID, 0, 1, 100000000000000002, 100000000000000002,SYSDATE,SYSDATE, 
    1, (SELECT MAX(SERIALNO) + 1 FROM IM_GROUPS),L_POLICYID, NULL, 0, NULL, 0,
    0, 0, 0, NULL,L_POLICYID,'123456');
    COMMIT;  

    SELECT Max(GROUP_CODE) INTO L_GROUPCODE FROM IM_GROUPS WHERE Upper(NATURE_OF_BUSSINESS) = Upper(L_POLICYID);
  
    Insert into IM_POLICY
    (POLICYCODE,
    POLICYID, POLICYNAME, STARTDATE, ENDDATE, GROUPCODE,
    ISFRONTINGGROUP, CATEGORYCODE, PLANCODE, ACTIVE, CALCULATEFINE,
    FINETEMPLATECODE, REMARKS, CREATEDIN, CREATEDON, CREATEDBY,
    LASTMODIFIEDON, LASTMODIFIEDBY, COMPANYCODE, LOCATIONCODE, DEACTIVATEDON,
    DEACTIVATEDBY, SERIALNO, FRONTINGSETTING, ANNUALLIMITTYPE, ALTLIMIT,
    INPATIENT, IPLIMIT, OUTPATIENT, OPLIMIT, AUTHORIZEDSTATUS,
    POLICYPREFIX, POLICYNO, POLICYSUFFIX, POLICYFULLNO, MEMBERCODE,
    FINAL_PREMIUM, BASE_PERIMUM, PERIMUMCODE, ELEMENTTEMPLATECODE, ISMEMBERPOLICYCONVERTED,
    UBIPCODE, COMMISIONTYPE, AGENTCODE, BROKERCODE, OWNERCODE,
    OLDPOLICYCODE, RENEWALPOLICYCODE, REQUEST_SOURCE, HAADAPPROVALCODE, REINSURANCECODE,
    PAYMENTMODE, CONTRACTTYPE, INSURANCECO, EXCELVALIDATE, TEMPLATECODE,
    BILLINGTYPE, BRANCHCODE, POLICYSERIALNO, OLDFINAL_PREMIUM, POSTINGDONE,
    NGI_FEES, INCEPTIONPREMIUM, ISCAPTIVE, ENTITYTYPE, ENTITYID,
    CONTACTNUMBER, EMAILID, FRONTINGFEES, REINSURERTYPE, SUBREINSURERTYPE,
    NOOFINSTALLMENT, EXCELFILENAME, TREATYHDRCODE, FACPERCENTAGE, INSURERCODE,
    RIREFCODE, OLDMANAGEBY, A_POLICYTYPE, PERIMUMCODE_BK, PORTALMEMBERID,LOGCODE,PORTALTYPE)
    Values
    ((SELECT MAX(POLICYCODE) + 1 FROM IM_POLICY), L_POLICYID, L_POLICYNAME,
    SYSDATE,SYSDATE+364,L_GROUPCODE, 0, NULL, NULL, 1,
    0, NULL, NULL, 1, TO_DATE('03/13/2017 15:50:30', 'MM/DD/YYYY HH24:MI:SS'),
    100000000000000997, TO_DATE('03/13/2017 15:56:41', 'MM/DD/YYYY HH24:MI:SS'), 100000000000000997, 1, 1,
    TO_DATE('03/13/2017 15:50:30', 'MM/DD/YYYY HH24:MI:SS'), 100000000000000997,
    (SELECT MAX(SERIALNO) + 1 FROM IM_POLICY), NULL, 2,
    0, 2, 0, 2, 0,
    1, NULL, NULL, NULL, '',
    NULL, 0, 0, 1, NULL,
    0, NULL, 0, Decode(L_SOURCETYPE,5,NULL,L_SOURCECODE), NULL,
    Decode(L_SOURCETYPE,5,L_SOURCECODE,NULL), NULL, NULL, L_SOURCETYPE, NULL,
    NULL, 0, 0, NULL, 0,
    '65', 2, NULL, NULL, NULL,
    1, L_SOURCETYPE, NULL, 0, NULL,
    NULL, NULL, NULL, 0, 0,
    0, NULL, NULL, NULL, 0,
    NULL, NULL, NULL, 1, NULL,
    L_APPLICANTID,L_SPONSOR_ROW.SPONSORCODE,'PR');
    COMMIT;

    SELECT  POLICYCODE INTO L_POLICYCODE FROM IM_POLICY WHERE POLICYID = HDR.NEXTCAREPOLICYID;
    Insert into IM_POLICY_CATEGORYDTL
    (PCDCODE,
    POLICYCODE, CATEGORYCODE, ALTLIMIT, IPLIMIT, PLIMIT,
    PLANCODE, CALCULATEFINE, ISFRONTINGGROUP, FRONTINGSETTING, COMPANYCODE,
    CREATEDBY, LASTMODIFIEDBY, CREATEDON, LASTMODIFIEDON, LOCATIONCODE,
    SERIALNO, OPLIMIT, REMARKS, ACTIVE, GROUPCODE,
    MEMBERCODE, ROOMTYPE, EMGDETECTWINETWTYPE, EMGDETECTWINETWVALUE, EMGDETECTOONETWTYPE,
    EMGDETECTOONETWVALUE, TOTALPREMIUM, UBIPCODE, LIMITTYPE, LIMITS,
    CO_IN_TYPE, CO_IN_VALUE, OONDEDECTABLETYPE, OONDEDECTABLEVALUE, OONCO_IN_TYPE,
    OONCO_IN_VALUE, DEDECTABLETYPE, DEDECTABLEVALUE, REPORTTEMPLATECODE, ELEMENTTEMPLATECODE,
    HEALTHAPPROVELNO, ALERTCLAIMSTEAMREMARK)
    Values
    ((SELECT MAX(PCDCODE) + 1 FROM IM_POLICY_CATEGORYDTL), L_POLICYCODE, 100000000000000003, 0, 0,
    NULL, 100000000000000214, 1, 0, NULL,
    1, 100000000000000997, 100000000000000997, TO_DATE('03/13/2017 15:56:23', 'MM/DD/YYYY HH24:MI:SS'), TO_DATE('03/13/2017 15:56:23', 'MM/DD/YYYY HH24:MI:SS'),
    1, (SELECT MAX(SERIALNO) + 1 FROM IM_POLICY_CATEGORYDTL), 0, NULL, NULL,
    100000000000017085, NULL, 0, 2, 0,
    2, 0, 0, NULL, 0,
    0, 0, 0, 0, 0,
    0, 0, 0, 0, NULL,
    NULL, NULL, 0);
    COMMIT;

    IF L_SPONSOR_ROW.ADMINISTRATEDBY = 11 THEN
      L_RULES := INSERTTPATREATY(L_POLICYCODE,1,100000000000000168);
      L_RULES := INSERTTPATREATY(L_POLICYCODE,2,100000000000000173);
      L_RULES := INSERTTPATREATY(L_POLICYCODE,3,100000000000000172);
      L_RULES := INSERTTPATREATY(L_POLICYCODE,5,100000000000000041);
    ELSIF L_SPONSOR_ROW.ADMINISTRATEDBY = 3 THEN
      L_RULES := INSERTTPATREATY(L_POLICYCODE,1,100000000000000168);
      L_RULES := INSERTTPATREATY(L_POLICYCODE,2,100000000000000173);
      L_RULES := INSERTTPATREATY(L_POLICYCODE,3,100000000000000172);
      L_RULES := INSERTTPATREATY(L_POLICYCODE,5,100000000000000041); 
    ELSIF L_SPONSOR_ROW.ADMINISTRATEDBY = 1 THEN
      L_RULES := INSERTTPATREATY(L_POLICYCODE,1,100000000000000168);
      L_RULES := INSERTTPATREATY(L_POLICYCODE,2,100000000000000173);
      L_RULES := INSERTTPATREATY(L_POLICYCODE,3,100000000000000172);
      L_RULES := INSERTTPATREATY(L_POLICYCODE,5,100000000000000041);      
    END IF;

    Insert into IM_POLICY_COMMISSION
    (POLICY_COMM_CODE,
    POLICYCODE, COMISSION_TYPES, DEFAULTVALUE, CALC_METHOD, COMMISSION_VALUE,
    CREATEDIN, CREATEDON, CREATEDBY, LASTMODIFIEDON, LASTMODIFIEDBY,
    LEGALENTITYCODE, CUSTOMERCODE, LOCATIONCODE, SERIALNO, COMPANYCODE,
    COMMISSIONTO, COMMISIONTONAME, GENERALCOMMBILLINGCODE)
    Values
    ((SELECT MAX(POLICY_COMM_CODE) + 1 FROM IM_POLICY_COMMISSION), L_POLICYCODE, 1, 0, 0,
    0, 1, TO_DATE('03/13/2017 15:50:30', 'MM/DD/YYYY HH24:MI:SS'), 100000000000000997, TO_DATE('03/13/2017 15:50:30', 'MM/DD/YYYY HH24:MI:SS'),
    100000000000000997, 100000000000000001, 100000000000000001, 1, (SELECT MAX(SERIALNO) + 1 FROM  IM_POLICY_COMMISSION),
    1, NULL,L_AGENTNAME, NULL);
    COMMIT;
    Insert into IM_POLICY_COMMISSION
    (POLICY_COMM_CODE,
    POLICYCODE, COMISSION_TYPES, DEFAULTVALUE, CALC_METHOD, COMMISSION_VALUE,
    CREATEDIN, CREATEDON, CREATEDBY, LASTMODIFIEDON, LASTMODIFIEDBY,
    LEGALENTITYCODE, CUSTOMERCODE, LOCATIONCODE, SERIALNO, COMPANYCODE,
    COMMISSIONTO, COMMISIONTONAME, GENERALCOMMBILLINGCODE)
    Values
    ((SELECT MAX(POLICY_COMM_CODE) + 1 FROM IM_POLICY_COMMISSION), L_POLICYCODE, 2,0, 0,
    0, 1, TO_DATE('03/13/2017 15:50:30', 'MM/DD/YYYY HH24:MI:SS'), 100000000000000997, TO_DATE('03/13/2017 15:50:30', 'MM/DD/YYYY HH24:MI:SS'),
    100000000000000997, 100000000000000001, 100000000000000001, 1, (SELECT MAX(SERIALNO) + 1 FROM  IM_POLICY_COMMISSION),
    1, NULL, 'FMC TPA FEE AND CLAIMS FEE', 100000000000000090);
    COMMIT;

    UPDATE IM_POLICY SET AUTHORIZEDSTATUS = 1 WHERE  POLICYCODE = L_POLICYCODE;
    COMMIT;

  END IF;
              
END IF;
END LOOP;
L_RULES := IM_FMCPORTALMEMBER_FNC(P_PRIMKEY);
L_RULES := IM_BULKPORTALFINANCEPOST_FNC('F',P_PRIMKEY,P_RESULT);   
RETURN 'OK';
EXCEPTION WHEN OTHERS THEN
P_RESULT := 2;    
RETURN L_ERROR;
END;
/

