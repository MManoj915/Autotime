DECLARE L_CARDNO VARCHAR2(500);L_MEMBERCARD VARCHAR2(500);
BEGIN
FOR HDR IN(SELECT CARDNO,POLICYCODE,APOLICYID,MEMBER_ID,MEMBER_CODE FROM IM_MEMBERS WHERE POLICYCODE IN
(SELECT INDIVIDUALPOLICYCODE FROM IM_INDIVIDUALPOLICY WHERE POLICYID LIKE '%PR%' AND OWNERCODE <> 7)
AND APOLICYID LIKE '%PR%') LOOP 
L_MEMBERCARD:=SubStr(HDR.APOLICYID,0,InStr(HDR.APOLICYID,'-',-1));
L_MEMBERCARD:=REPLACE(L_MEMBERCARD,'-','');
L_CARDNO:=L_MEMBERCARD||HDR.MEMBER_ID;
UPDATE IM_MEMBERS SET CARDNO = L_CARDNO WHERE MEMBER_CODE=HDR.MEMBER_CODE;
COMMIT;
UPDATE IM_MEMBERPOLICY SET ACARDID = L_CARDNO,AMEMBERID = HDR.MEMBER_ID WHERE MEMBERCODE=HDR.MEMBER_CODE;
COMMIT;
UPDATE IM_CORDPRINT SET CARDNO =  L_CARDNO  WHERE MEMBERCODE=HDR.MEMBER_CODE;
COMMIT;
END LOOP;
END; 


DECLARE L_MEMBER_ID VARCHAR2(500);ACATID VARCHAR2(500);AMEMCOUNTERSERIAL NUMBER;
BEGIN
FOR HDR IN(SELECT CARDNO,POLICYCODE,APOLICYID,MEMBER_ID,MEMBER_CODE,CATEGORY_CODE FROM IM_MEMBERS WHERE POLICYCODE IN
(SELECT INDIVIDUALPOLICYCODE FROM IM_INDIVIDUALPOLICY WHERE POLICYID LIKE '%PR%' AND OWNERCODE <> 7)
AND APOLICYID LIKE '%PR%') LOOP 
SELECT MAX(CATEGORY_ID) INTO ACATID FROM IM_CATEGORIES WHERE IM_CATEGORIES.CATEGORY_CODE=NVL(HDR.CATEGORY_CODE,100000000000000001);
SELECT NVL(MAX(VALUE),0)+1 INTO AMEMCOUNTERSERIAL FROM FND_COUNTERS WHERE CODE='MEMID';

IF(AMEMCOUNTERSERIAL<>1) THEN
UPDATE FND_COUNTERS SET FND_COUNTERS.VALUE=AMEMCOUNTERSERIAL WHERE CODE='MEMID';
ELSE
INSERT INTO FND_COUNTERS (CODE,DESCRIPTION,VALUE) VALUES ('MEMID','MEMID',AMEMCOUNTERSERIAL);
END IF;

L_MEMBER_ID := (SUBSTR(ACATID,0,1)||LPAD(AMEMCOUNTERSERIAL,6,'0')||'0001');
   
UPDATE IM_MEMBERS SET MEMBER_ID = L_MEMBER_ID WHERE MEMBER_CODE=HDR.MEMBER_CODE;
COMMIT;
END LOOP;
END;                                                       
                                