SELECT * FROM (SELECT  JVI.REF_NO,MAX(JV.TOTALLC) JAMT,Max(JV.PAIDAMOUNT) JPAMT,
SUM(JVI.AMOUNT) JIAMT,Sum(RECEIVEDAMOUNT) JIPAMT FROM IMS_RETRIEVEDATA JV
JOIN IM_NGI_JV_INSTALLMENT JVI ON JVI.REF_NO = '0'||JV.SERIALNO
GROUP BY  JVI.REF_NO) WHERE JIPAMT <> JPAMT;


UPDATE  IM_NGI_JVPOSTING SET  MANUALINSTALLMENT = 1 WHERE JVPOSTINGCODE IN( 
SELECT * FROM (SELECT JV.JVPOSTINGCODE,MAX(JV.AMOUNT) JAMT,SUM(JVI.AMOUNT) JIAMT FROM IM_NGI_JVPOSTING JV
JOIN IM_NGI_JV_INSTALLMENT JVI ON JVI.JVPOSTINGCODE = JV.JVPOSTINGCODE
GROUP BY JV.JVPOSTINGCODE) WHERE JAMT <> JIAMT);


SELECT ref_no FROM(
SELECT  JV.ref_no,Max(NVL(JV.AMOUNT,0)) JPAMT,
SUM(NVL(JVI.AMOUNT,0)) JIAMT FROM IM_NGI_JVPOSTING JV
LEFT JOIN IM_NGI_JV_INSTALLMENT JVI ON JVI.REF_NO = JV.REF_NO
WHERE JV.JVPREMIUMTYPE = 0 AND JV.REF_CODE IS NOT NULL
GROUP BY  JV.ref_no ) WHERE ABS(JIAMT) <> ABS(JPAMT)