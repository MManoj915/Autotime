SELECT * FROM(SELECT POS.FINANCENO,To_Char(POS.REFDATE,'DD/MM/RRRR') REFDATE,'Group' POLICYTYPE,POL.MASTERCONTRACTID,POL.POLICYID,POL.POLICYNAME,To_Char(POL.STARTDATE) STARTDATE,
To_Char(POL.ENDDATE) ENDDATE,G.CONSTANTNAME MANAGEDBY,MEM.FIRST_NAME||' '||MEM.MIDDLENAME||' '||MEM.LAST_NAME MEMBERNAME,MEM.CARDNO,
MEM.PASSPORT_NO,MEM.UIDNUMBER,GET_COMPASS_NEW_END(POS.POLICYFINANCEPOSTINGCODE,POL.POLICYCODE,POSD.PFPDETAILCODE) UPLOADEDTYPE,
GET_COMPASS_ACTUAL_END(POS.POLICYFINANCEPOSTINGCODE,To_Date(POS.REFDATE,'DD/MM/RRRR'),POL.POLICYCODE,POSD.PFPDETAILCODE) ENDOTYPE FROM IM_POLICYFINANCEPOSTING POS
JOIN IM_POLICYFINANCEPOSTINGDTL POSD ON POSD.POLICYFINANCEPOSTINGCODE = POS.POLICYFINANCEPOSTINGCODE
JOIN IM_POLICY POL ON POL.POLICYCODE = POS.POLICYCODE         
JOIN IM_MEMBERPOLICY M ON M.MEMBERPOLICYCODE = POSD.MEMBERPOLICYCODE
JOIN IM_MEMBERS MEM ON MEM.MEMBER_CODE = M.MEMBERCODE --AND MEM.POLICYCODE = POL.POLICYCODE AND MEM.APOLICYID = POL.POLICYID
LEFT JOIN GENCONSTANT G ON G.CATEGORY = 'NGIQUOTATIONTYPE' AND G.LANGUAGECODE = 'en-US' AND G.CONSTANTVALUE = POL.OWNERCODE
WHERE POL.OWNERCODE IN(1,7,18,17,18) AND TO_DATE(POS.REFDATE,'DD/MM/RRRR') > TO_DATE('10/06/2018','DD/MM/RRRR')
AND POS.PRODUCTIONBATCHCODE IS   NULL AND POS.PRODUCTIONSOURCE IS NULL AND M.MEMBERCODE IS NOT NULL
AND Nvl(POS.AUTHORIZEDSTATUS,0) <> 0 
UNION 
SELECT POS.FINANCENO,To_Char(POS.REFDATE,'DD/MM/RRRR') REFDATE,'Individual' POLICYTYPE,POL.MASTERCONTRACTID,POL.POLICYID,POL.POLICYNAME,To_Char(POL.STARTDATE) STARTDATE,
To_Char(POL.ENDDATE) ENDDATE,G.CONSTANTNAME MANAGEDBY,MEM.FIRST_NAME||' '||MEM.MIDDLENAME||' '||MEM.LAST_NAME MEMBERNAME,MEM.CARDNO,
MEM.PASSPORT_NO,MEM.UIDNUMBER,GET_COMPASS_NEW_IEND(POS.POLICYFINANCEPOSTINGCODE,POL.INDIVIDUALPOLICYCODE,POSD.PFPDETAILCODE) UPLOADEDTYPE,
GET_COMPASS_ACTUAL_IEND(POS.POLICYFINANCEPOSTINGCODE,To_Date(POS.REFDATE,'DD/MM/RRRR'),POL.INDIVIDUALPOLICYCODE,POSD.PFPDETAILCODE) ENDOTYPE FROM IM_POLICYFINANCEPOSTING POS
JOIN IM_POLICYFINANCEPOSTINGDTL POSD ON POSD.POLICYFINANCEPOSTINGCODE = POS.POLICYFINANCEPOSTINGCODE
JOIN IM_INDIVIDUALPOLICY POL ON POL.INDIVIDUALPOLICYCODE = POS.INDIVIDUALPOLICYCODE         
JOIN IM_MEMBERPOLICY M ON M.MEMBERPOLICYCODE = POSD.MEMBERPOLICYCODE
JOIN IM_MEMBERS MEM ON MEM.MEMBER_CODE = M.MEMBERCODE --AND MEM.POLICYCODE = POL.POLICYCODE AND MEM.APOLICYID = POL.POLICYID
LEFT JOIN GENCONSTANT G ON G.CATEGORY = 'NGIQUOTATIONTYPE' AND G.LANGUAGECODE = 'en-US' AND G.CONSTANTVALUE = POL.OWNERCODE
WHERE POL.OWNERCODE IN(1,7,18,17,18) AND TO_DATE(POS.REFDATE,'DD/MM/RRRR') > TO_DATE('10/06/2018','DD/MM/RRRR')
AND POS.PRODUCTIONBATCHCODE IS   NULL AND POS.PRODUCTIONSOURCE IS NULL AND M.MEMBERCODE IS NOT NULL
AND Nvl(POS.AUTHORIZEDSTATUS,0) <> 0 ) ORDER BY REFDATE

