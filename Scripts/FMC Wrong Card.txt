DECLARE L_MEMBERCODE NUMBER;
BEGIN
FOR HDR IN(SELECT * FROM IM_POLICY_MEMBERS WHERE POLICYCODE=100000000000024574 AND PARENTID IS NOT NULL) LOOP

SELECT Max(MEMBER_CODE) INTO L_MEMBERCODE FROM IM_MEMBERS WHERE CARDNO = HDR.PARENTID AND POLICYCODE=100000000000024574; 
UPDATE IM_MEMBERS SET CARDNO = HDR.MEMBERID,MEMBER_ID = HDR.MEMBERID,PARENT_ID=L_MEMBERCODE WHERE MEMBER_CODE =HDR.MEMBERCODE 
AND POLICYCODE=100000000000024574;
COMMIT;
UPDATE IM_MEMBERPOLICY SET ACARDID = HDR.MEMBERID,AMEMBERID = HDR.MEMBERID WHERE MEMBERCODE =HDR.MEMBERCODE 
AND POLICYCODE=100000000000024574;
COMMIT;
UPDATE IM_CORDPRINT SET CARDNO = HDR.MEMBERID WHERE MEMBERCODE =HDR.MEMBERCODE 
AND POLICYCODE=100000000000024574;
COMMIT; 
END LOOP;
END;


SELECT * FROM (SELECT MEMBERCARDNO FROM IM_FMCPORTALDATA_ADD_VW
UNION ALL 
SELECT MEMBERCARDNO FROM IM_FMCORCDATA_ADD_VW )  WHERE MEMBERCARDNO NOT IN(
SELECT MEMBERCARDNO FROM (SELECT MEMBERCARDNO FROM IM_FMCPORTALDATA_ADD_VW
UNION ALL
SELECT MEMBERCARDNO FROM IM_FMCORCDATA_ADD_VW  )
WHERE Length(MEMBERCARDNO) = 9 OR SubStr(MEMBERCARDNO,0,8) = '90152018'
OR Length(MEMBERCARDNO) = 10 OR  Length(MEMBERCARDNO) = 16 OR SubStr(MEMBERCARDNO,0,8) = 'NGI-2018' )
AND  Length(MEMBERCARDNO) = 19



SELECT CARDNO,MEMBER_CODE FROM IM_MEMBERS WHERE CARDNO IN
(SELECT MEMBERCARDNO FROM (SELECT MEMBERCARDNO FROM IM_FMCPORTALDATA_ADD_VW
UNION ALL
SELECT MEMBERCARDNO FROM IM_FMCORCDATA_ADD_VW  )
WHERE Length(MEMBERCARDNO) = 9 OR SubStr(MEMBERCARDNO,0,8) = '90152018'
OR Length(MEMBERCARDNO) = 10 OR  Length(MEMBERCARDNO) = 16 OR SubStr(MEMBERCARDNO,0,8) = 'NGI-2018' )


UPDATE IM_POLICY SET ISDOWNLOADED = 0 WHERE POLICYCODE IN 
(SELECT POLICYCODE FROM IM_FMCPORTALDATA_POST WHERE  POLICYTYPE = 1);
UPDATE IM_INDIVIDUALPOLICY SET ISDOWNLOADED = 0 WHERE INDIVIDUALPOLICYCODE IN 
(SELECT POLICYCODE FROM IM_FMCPORTALDATA_POST WHERE  POLICYTYPE = 2);
DELETE FROM IM_FMCPORTALDATA_POST;
DELETE FROM IM_FMCORCDATA_POST;


BEGIN
FOR HDR IN (SELECT DECODE(P.ISPREXISTING,1,'Yes','No') PREEXISTING,MEMBERCODE FROM IM_PR_SPONSOR_APPLICATION P,IM_POLICY_MEMBERS M 
WHERE POLICYTYPE = 1 AND M.POLICYCODE = M.POLICYCODE AND P.APPLICATIONCODE = M.CUSTOMERCODE) LOOP
UPDATE IM_MEMBERS SET ISPREEXISTING = HDR.PREEXISTING
WHERE MEMBER_CODE = HDR.MEMBERCODE;
COMMIT;
END LOOP;
END;  


BEGIN
FOR HDR IN (SELECT DECODE(P.ISPREXISTING,1,'Yes','No') PREEXISTING,MEMBERCODE FROM IM_PR_SPONSOR_APPLICATION P,IM_IP_MEMBERS M 
WHERE POLICYTYPE = 2 AND P.POLICYCODE = M.INDIVIDUALPOLICYCODE AND P.APPLICATIONCODE = M.CUSTOMERCODE) LOOP
UPDATE IM_MEMBERS SET ISPREEXISTING = HDR.PREEXISTING
WHERE MEMBER_CODE = HDR.MEMBERCODE;
COMMIT;
END LOOP;
END;              

 


DECLARE L_CARDNO VARCHAR2(500);L_MEMBERID VARCHAR2(500);
BEGIN
FOR HDR IN(SELECT MEMBER_ID,CARDNO,MEMBER_CODE FROM IM_MEMBERS WHERE CARDNO IN
(SELECT MEMBERCARDNO FROM (SELECT MEMBERCARDNO FROM IM_FMCPORTALDATA_ADD_VW
UNION ALL
SELECT MEMBERCARDNO FROM IM_FMCORCDATA_ADD_VW  )
WHERE Length(MEMBERCARDNO) = 9 OR SubStr(MEMBERCARDNO,0,8) = '90152018'
OR Length(MEMBERCARDNO) = 10 OR  Length(MEMBERCARDNO) = 16 OR SubStr(MEMBERCARDNO,0,8) = 'NGI-2018' )) LOOP

UPDATE IM_MEMBERS SET MEMBER_ID = NULL WHERE MEMBER_CODE = HDR.MEMBER_CODE;
COMMIT;

END LOOP;
END;

DECLARE L_CARDNO VARCHAR2(500);L_MEMBERID VARCHAR2(500);
BEGIN
FOR HDR IN(SELECT STARTDATE,POLICYID,MEMBER_ID,CARDNO,MEMBER_CODE FROM IM_MEMBERS M,IM_POLICY P
WHERE M.POLICYCODE = P.POLICYCODE AND  M.MEMBER_ID IN (SELECT * FROM IM_MEM)) LOOP
L_CARDNO := (SUBSTR(HDR.POLICYID,0,INSTR(HDR.POLICYID,'-',-1))||TO_CHAR(HDR.STARTDATE,'RRRR'));
L_CARDNO := REPLACE(L_CARDNO,'-','');
L_CARDNO := L_CARDNO||HDR.MEMBER_ID;
UPDATE IM_MEMBERS SET CARDNO = L_CARDNO WHERE MEMBER_CODE = HDR.MEMBER_CODE;
COMMIT;
UPDATE IM_MEMBERPOLICY SET ACARDID = L_CARDNO,AMEMBERID = HDR.MEMBER_ID WHERE MEMBERCODE = HDR.MEMBER_CODE;
COMMIT;
UPDATE IM_CORDPRINT SET CARDNO = L_CARDNO WHERE MEMBERCODE = HDR.MEMBER_CODE;
COMMIT;    
END LOOP;
END;

DECLARE L_CARDNO VARCHAR2(500);L_MEMBERID VARCHAR2(500);
BEGIN
FOR HDR IN(SELECT STARTDATE,POLICYID,MEMBER_ID,CARDNO,MEMBER_CODE FROM IM_MEMBERS M,IM_POLICY P
WHERE M.POLICYCODE = P.POLICYCODE AND M.POLICYTYPE = 1 AND CARDNO IN
(SELECT MEMBERCARDNO FROM (SELECT MEMBERCARDNO FROM IM_FMCPORTALDATA_ADD_VW
UNION ALL
SELECT MEMBERCARDNO FROM IM_FMCORCDATA_ADD_VW  )
WHERE Length(MEMBERCARDNO) = 9 OR SubStr(MEMBERCARDNO,0,8) = '90152018'
OR Length(MEMBERCARDNO) = 10 OR  Length(MEMBERCARDNO) = 16 OR SubStr(MEMBERCARDNO,0,8) = 'NGI-2018' )) LOOP
L_CARDNO := (SUBSTR(HDR.POLICYID,0,INSTR(HDR.POLICYID,0,-1))||TO_CHAR(HDR.STARTDATE,'RRRR'));
L_CARDNO := L_CARDNO||HDR.MEMBER_ID;
UPDATE IM_MEMBERS SET CARDNO = L_CARDNO WHERE MEMBER_CODE = HDR.MEMBER_CODE;
COMMIT;
UPDATE IM_MEMBERPOLICY SET ACARDID = L_CARDNO,AMEMBERID = HDR.MEMBER_ID WHERE MEMBERCODE = HDR.MEMBER_CODE;
COMMIT;
UPDATE IM_CORDPRINT SET CARDNO = L_CARDNO WHERE MEMBERCODE = HDR.MEMBER_CODE;
COMMIT;    
END LOOP;
END;

DECLARE L_CARDNO VARCHAR2(500);L_MEMBERID VARCHAR2(500);
BEGIN
FOR HDR IN(SELECT STARTDATE,POLICYID,MEMBER_ID,CARDNO,MEMBER_CODE FROM IM_MEMBERS M,IM_INDIVIDUALPOLICY P
WHERE M.POLICYCODE = P.INDIVIDUALPOLICYCODE AND M.POLICYTYPE = 2 AND CARDNO IN
(SELECT MEMBERCARDNO FROM (SELECT MEMBERCARDNO FROM IM_FMCPORTALDATA_ADD_VW
UNION ALL
SELECT MEMBERCARDNO FROM IM_FMCORCDATA_ADD_VW  )
WHERE Length(MEMBERCARDNO) = 9 OR SubStr(MEMBERCARDNO,0,8) = '90152018'
OR Length(MEMBERCARDNO) = 10 OR  Length(MEMBERCARDNO) = 16 OR SubStr(MEMBERCARDNO,0,8) = 'NGI-2018' )) LOOP
L_CARDNO := (SUBSTR(HDR.POLICYID,0,INSTR(HDR.POLICYID,0,-1))||TO_CHAR(HDR.STARTDATE,'RRRR'));
L_CARDNO := L_CARDNO||HDR.MEMBER_ID;
UPDATE IM_MEMBERS SET CARDNO = L_CARDNO WHERE MEMBER_CODE = HDR.MEMBER_CODE;
COMMIT;
UPDATE IM_MEMBERPOLICY SET ACARDID = L_CARDNO,AMEMBERID = HDR.MEMBER_ID WHERE MEMBERCODE = HDR.MEMBER_CODE;
COMMIT;
UPDATE IM_CORDPRINT SET CARDNO = L_CARDNO WHERE MEMBERCODE = HDR.MEMBER_CODE;
COMMIT;    
END LOOP;
END;




                                  


 



  