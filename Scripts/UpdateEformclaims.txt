

BEGIN
FOR H IN(SELECT H.BENEFICARYCARDNUMBER,M.APOLICYID,H.POLICYID,MANAGEDBY,CONSTANTNAME,
To_Char(M.POLICYSTARTDDATE,'RRRR') UWYEAR FROM IM_EFORM_CLAIMS_HDR H
JOIN IM_MEMBERPOLICY M ON M.ACARDID=H.BENEFICARYCARDNUMBER
LEFT JOIN IM_POLICY P ON P.POLICYCODE=M.POLICYCODE   AND M.TYPEE=1
LEFT JOIN IM_INDIVIDUALPOLICY IP ON IP.INDIVIDUALPOLICYCODE=M.POLICYCODE AND M.TYPEE=2
LEFT JOIN GENCONSTANT G ON G.CATEGORY='NGIQUOTATIONTYPE' AND G.LANGUAGECODE='en-US' AND G.CONSTANTVALUE=Nvl(P.OWNERCODE,IP.OWNERCODE)
WHERE  To_Date(PAYMENTDATE,'DD/MM/RRRR') BETWEEN To_Date('01/01/2018','DD/MM/RRRR')
AND  To_Date('31/01/2018','DD/MM/RRRR') AND Upper(MANAGEDBY)<>Upper(CONSTANTNAME)) LOOP

UPDATE IM_EFORM_CLAIMS_HDR SET MANAGEDBY=H.CONSTANTNAME,POLICYID=H.APOLICYID,UWYEAR=H.UWYEAR 
WHERE BENEFICARYCARDNUMBER=H.BENEFICARYCARDNUMBER;
COMMIT;
END LOOP;
END;

             




BEGIN
FOR H IN(SELECT * FROM(SELECT   Nvl(P.POLICYID,IP.POLICYID)APOLICYID,H.POLICYID,MANAGEDBY,CONSTANTNAME,
To_Char(Nvl(P.STARTDATE,IP.STARTDATE),'RRRR') UWYEAR,H.CLAIMNUMBER FROM IM_EFORM_CLAIMS_HDR H
JOIN IM_CLAIM_PROCESS_HEADER HDR ON HDR.ACR_FORM_NO = H.CLAIMNUMBER
LEFT JOIN IM_POLICY P ON P.POLICYCODE=HDR.POLICYCODE   AND HDR.POLICYTYPECODE=1
LEFT JOIN IM_INDIVIDUALPOLICY IP ON IP.INDIVIDUALPOLICYCODE=HDR.POLICYCODE AND HDR.POLICYTYPECODE=2
LEFT JOIN GENCONSTANT G ON G.CATEGORY='NGIQUOTATIONTYPE' AND G.LANGUAGECODE='en-US' AND G.CONSTANTVALUE=Nvl(P.OWNERCODE,IP.OWNERCODE)
WHERE  HDR.REQUEST_TYPE=4 AND H.CLAIMTYPE='TPA CLAIM' AND To_Date(PAYMENTDATE,'DD/MM/RRRR') BETWEEN To_Date('01/11/2018','DD/MM/RRRR')
AND  To_Date('30/11/2018','DD/MM/RRRR') AND Upper(MANAGEDBY)<>Upper(CONSTANTNAME))) LOOP

UPDATE IM_EFORM_CLAIMS_HDR SET MANAGEDBY=H.CONSTANTNAME,POLICYID=H.APOLICYID,UWYEAR=H.UWYEAR 
WHERE POLICYID=H.POLICYID AND CLAIMNUMBER=H.CLAIMNUMBER;
COMMIT;
END LOOP;
END;

                                                                                                                                       