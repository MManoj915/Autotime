DECLARE L_TARIFFPRICE NUMBER(19,2);L_MEMBERPOLICYROW IM_MEMBERPOLICY%ROWTYPE;L_NETWORKCODE NUMBER;
BEGIN
FOR HDR IN(SELECT * FROM IM_CLAIM_PROCESS_HEADER WHERE AUTHORIZEDSTATUS = 0 AND CLAIM_STATUS = 1
AND PROVIDER_CODE IN(SELECT PROVIDERCODE FROM IM_PROVIDERS WHERE UPPER(PROVIDERNAME) LIKE '%ASTER%' AND PROVIDERTYPE <> 2)
AND RESUBMISSION_COMMENTS IS NULL  AND SubStr(ACR_FORM_NO,0,1) ='E') LOOP

SELECT * INTO L_MEMBERPOLICYROW FROM IM_MEMBERPOLICY WHERE MEMBERPOLICYCODE = HDR.MEMBERPOLICYCODE;

   IF L_MEMBERPOLICYROW.TYPEE = 1 THEN        
       SELECT Max(IPCN.NETWORKCODE) INTO L_NETWORKCODE FROM IM_POLICY POL
       LEFT JOIN IM_POLICY_CATEGORYDTL DTL ON DTL.POLICYCODE = POL.POLICYCODE
       LEFT JOIN IM_POLICYCOVEREDNETWORK IPCN ON IPCN.PCDCODE = DTL.PCDCODE
       WHERE POL.POLICYCODE = L_MEMBERPOLICYROW.POLICYCODE  AND POL.POLICYCODE = L_MEMBERPOLICYROW.POLICYCODE AND DTL.CATEGORYCODE = L_MEMBERPOLICYROW.CATEGORYCODE
       AND Nvl(IPCN.ACTIVE,0) = 1;   
   ELSIF L_MEMBERPOLICYROW.TYPEE = 2 THEN       
       SELECT Max(IPCN.NETWORKCODE) INTO L_NETWORKCODE FROM IM_INDIVIDUALPOLICY POL
       LEFT JOIN IM_NGIINDPOLICYCATEGORY DTL ON DTL.INDIVIDUALPOLICYCODE = POL.INDIVIDUALPOLICYCODE
       LEFT JOIN IM_INDIVIDUALPOLICYNETWORK IPCN ON IPCN.POLICYCATEGORYCODE = DTL.POLICYCATEGORYCODE
       WHERE POL.INDIVIDUALPOLICYCODE = L_MEMBERPOLICYROW.POLICYCODE AND DTL.CATEGORYCODE = L_MEMBERPOLICYROW.CATEGORYCODE
       AND Nvl(IPCN.ACTIVE,0) = 1;    
   END IF;

FOR DTL IN (SELECT ACTIVITY_DETAIL_CODE,ECA.ACTIVITY_CODE FROM IM_CLAIM_PROCESS_DETAIL DTL,ECLAIM_ACTIVITIES ECA
WHERE CLAIM_CODE=HDR.CLAIM_CODE AND ECA.SYS_ACTIVITY_ID = DTL.sys_ACTIVITY_ID AND ECA.SYS_CLAIM_ID = HDR.MAP_VALUE
AND DTL.ACTIVITY_CODE NOT IN (100000000000000001,100000000000000003,100000000000000006)) LOOP
L_TARIFFPRICE := NGI_LOADCLAIMS.NGI_GETDHATARIFFPRICE(1,HDR.PROVIDER_CODE,DTL.ACTIVITY_CODE,HDR.ENCOUNTER_START_DATE,L_NETWORKCODE);
IF L_TARIFFPRICE = -1 THEN
 CONTINUE;
ELSE
  UPDATE IM_CLAIM_PROCESS_DETAIL SET PRICE = L_TARIFFPRICE,PROVIDERNETPRICE = L_TARIFFPRICE WHERE ACTIVITY_DETAIL_CODE = DTL.ACTIVITY_DETAIL_CODE;
  COMMIT;
END IF;
END LOOP;

END LOOP;
END;







 