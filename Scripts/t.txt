UPDATE IM_MEMBERS SET ISMEMBERDATAUPLOADED = 0 WHERE MEMBER_CODE IN
(SELECT MEMBERCODE FROM IM_MEMBERPOLICY WHERE MEMBERPOLICYCODE IN
(SELECT MEMBERPOLICYCODE FROM IM_POLICYFINANCEPOSTINGDTL WHERE POLICYFINANCEPOSTINGCODE IN
(SELECT REF_CODE FROM IM_NGI_JVPOSTING WHERE To_Date(REFDATE,'DD/MM/RRRR') > To_Date('19/08/2018','DD/MM/RRRR')))).

UPDATE IM_INDIVIDUALPOLICY SET STARTDATE= To_Date('18/10/2018','DD/MM/RRRR'),
ENDDATE=To_Date('17/10/2019','DD/MM/RRRR') WHERE POLICYID='82958-1';
UPDATE IM_MEMBERPOLICY SET MEMBERSTARTDATE= To_Date('18/10/2018','DD/MM/RRRR'),
MEMBERENDDATE=To_Date('17/10/2019','DD/MM/RRRR'),POLICYSTARTDDATE= To_Date('18/10/2018','DD/MM/RRRR'),
POLICYENDDDATE=To_Date('17/10/2019','DD/MM/RRRR') WHERE APOLICYID='82958-1';
UPDATE IM_MEMBERS SET COVERED_FROM_DATE= To_Date('18/10/2018','DD/MM/RRRR'),
COVERED_END_DATE=To_Date('17/10/2019','DD/MM/RRRR'),EFFECTIVE_START_DATE= To_Date('18/10/2018','DD/MM/RRRR'),
EFFECTIVE_END_DATE=To_Date('17/10/2019','DD/MM/RRRR') WHERE APOLICYID='82958-1';

UPDATE IM_EFORM_UW_HDR SET CONTRACTEFFECTIVEDATE= To_Date('07/11/2018','DD/MM/RRRR'),
CONTRACTEXPIRYDATE=To_Date('06/11/2019','DD/MM/RRRR'),BENEFICIARYSTARTDATE= To_Date('07/11/2018','DD/MM/RRRR'),
BENEFICIARYENDDATE=To_Date('06/11/2019','DD/MM/RRRR'),CONTRACTINCEPTIONDATE= To_Date('07/11/2018','DD/MM/RRRR') WHERE 
POLICYNUMBER  IN('82922-1','82923-1','82924-1');




BEGIN
FOR HDR IN(SELECT * FROM IM_MEMBERPOLICY WHERE MEMBERCODE IN(SELECT MEMBER_CODE FROM IM_MEMBERS WHERE MEMBER_CODE NOT IN
(SELECT MEMBERCODE FROM IM_POLICY_MEMBERS WHERE POLICYCODE IN
(SELECT POLICYCODE FROM IM_POLICY WHERE POLICYID = '8141-02')) AND APOLICYID = '8141-02')) LOOP
UPDATE IM_MEMBERS SET COVERED_FROM_DATE=HDR.POLICYSTARTDDATE,
COVERED_END_DATE=HDR.POLICYENDDDATE,EFFECTIVE_START_DATE= HDR.MEMBERSTARTDATE,
EFFECTIVE_END_DATE=HDR.MEMBERENDDATE,APOLICYID = HDR.APOLICYID,APOLICYNAME=HDR.APOLICYNAME,
POLICYCODE=HDR.POLICYCODE,POLICYADDREFCODE=NULL WHERE MEMBER_CODE = HDR.MEMBERCODE;
COMMIT;
END LOOP;
END; 


CREATE TABLE IM_RI_EFORM AS SELECT DISTINCT CALCULATIONTYPE,TRT.TREATYNAME,ENDORESMENTID,To_Date(A.ENDORESMENTDATE,'DD/MM/RRRR') DOCUMENTNAME,INS.INSCODE,INS.INS_NAME,TDTL.FACULTATIVEPERCENTAGE,
A.ACC_PIN,P.POLICYID,P.POLICYNAME,Sum(TOTALPREMIUM)*(TDTL.FACULTATIVEPERCENTAGE/100) TOTALPREMIUM,0 CLAIMAMOUNT,A.UWYEAR,
Sum(TOTALPREMIUM) GROSSPREMIUM,0 NETPREMIUM,Sum(AGENTCOM+TPAFEE+ADMINFEE) COMMISSION,Nvl(Max(P.NGI_FEES),0) NGIFEES,DTL.FACULTATIVEPERCENTAGE TREATYPERCENTAGE,G.CONSTANTNAME,
A.MANAGEDBY,A.BRANCHNAME,P.STARTDATE,P.ENDDATE
 FROM IM_EFORM_UW_HDR A,IM_POLICY P,IM_POLICY_INSURER_DTL DTL,IM_POLICY_INSURER_SUBDTL SDTL,
IM_TREATY_HDR TRT,IM_TREATY_DTL TDTL,GENCONSTANT G,IM_INSURER INS 
WHERE To_Date(ENDORESMENTDATE,'DD/MM/RRRR')
BETWEEN To_Date('01/01/2018','DD/MM/RRRR') AND To_Date('30/09/2018','DD/MM/RRRR')  
AND Upper(POLICYTYPE) = 'GROUP' AND A.POLICYNUMBER = P.POLICYID   AND P.POLICYCODE = DTL.POLICYCODE
AND DTL.POLICYINSURERDTLCODE = SDTL.POLICYINSURERDTLCODE  AND SDTL.TREATYHDRCODE = TRT.TREATYHDRCODE 
AND G.CATEGORY='PREMIUMTYPES' AND G.LANGUAGECODE = 'en-US' AND G.CONSTANTVALUE = SDTL.PREMIUMTYPE
AND TRT.TREATYHDRCODE = TDTL.TREATYHDRCODE AND P.OWNERCODE NOT IN(11,14,15,22,23) AND INS.INSCODE = TDTL.INSURERCODE 
AND SDTL.PREMIUMTYPE = 4     --AND ENDORESMENTID='02181123561'
GROUP BY POLICYNUMBER,ENDORESMENTID,TRT.TREATYNAME,INS.INS_NAME,TDTL.FACULTATIVEPERCENTAGE,G.CONSTANTNAME,
TRT.CALCULATIONTYPE,SDTL.PREMIUMTYPE,To_Date(A.ENDORESMENTDATE,'DD/MM/RRRR'),A.ACC_PIN,P.POLICYID,P.POLICYNAME,A.UWYEAR,
A.MANAGEDBY,A.BRANCHNAME,DTL.FACULTATIVEPERCENTAGE,P.STARTDATE,P.ENDDATE,INS.INSCODE  
  