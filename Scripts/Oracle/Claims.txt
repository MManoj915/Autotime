CREATE OR REPLACE VIEW im_claimhistory_dec_vw (
  claim_code,
  request_number,
  cpprefix,
  cpno,
  cpsuffix,
  cpfullno,
  authorizedstatus,
  transactiondate,
  request_source,
  request_type,
  request_status,
  provider_code,
  is_blocked,
  is_fasttrace_payment,
  member_code,
  authorizatoin_code,
  createdin,
  createdon,
  createdby,
  lastmodifiedon,
  lastmodifiedby,
  legalentitycode,
  customercode,
  locationcode,
  companycode,
  benefit_code,
  request_amount,
  approved_date,
  approved_amount,
  treatment_type,
  encounter_start_date,
  "TYPE",
  claim_status,
  denial_reason,
  casesummary,
  serialno,
  denailvalue,
  picture,
  invoicenumber,
  denialreason,
  reason,
  typecode,
  activitycode,
  map_value,
  batch_number,
  athorizatoin_code,
  encounter_end_date,
  duration,
  request_date,
  resubmission_type,
  batchcode,
  parentclaimcode,
  currencycode,
  networkcode,
  policycode,
  category_code,
  isemergency,
  provincecode,
  cdcode,
  uploadstatus,
  discounttotal,
  activityprice,
  co_ins_value,
  deductablevalue,
  invoicedate,
  acr_form_no,
  acr_form_type,
  claim_type,
  netamount,
  memberpolicycode,
  resubmission,
  isresubmission,
  claim_remarks,
  encounter_start_type,
  encounter_end_type,
  encounter_facility_type,
  rfp,
  submittora,
  finance,
  orginalpatientshare,
  rate,
  reimbursementamt,
  source_type,
  source_code,
  acr_form_seq_no,
  acr_product_code,
  acr_serial_no,
  acr_product_category,
  acr_member_no,
  acr_member_reference_no,
  acr_provider_code,
  acr_physician_code,
  isposted,
  paymentrefno,
  sourceprovider,
  screeningdone,
  acr_uw_year,
  outofnetworkprovidername,
  cardno,
  isnextcare,
  policytypecode,
  networktype,
  administratedby,
  resubmission_comments,
  resubmission_attachment,
  ubymanoj,
  processeddate,
  tobedeleteclaims,
  alreadyscreened,
  tobeupdated,
  acr_sequence_no,
  ceedstatus,
  reviewedbydoctor,
  declineamount,
  hnmamount,
  mdeduct,
  mco_ins,
  oldclaims,
  autoreject,
  isdeclinedposted,
  isfraud,
  isautomated,
  lcnt,
  ibnrmonth,
  medpostingdone,
  isprocessed,
  crtclaim,
  originaldeductableamount,
  originalrequestamount,
  autoprocessed,
  claimmemberbatchcode,
  actcheckhdr,
  isreversed,
  paymenttypecode,
  reimbursement_form_no,
  formtypecode,
  brate,
  memotype,
  priceupdate,
  medrefdate,
  acr_seq_no,
  acr_inv_no,
  iscardresubmission,
  isreversedfordebit,
  isreversedforcredit,
  policyid,
  policyname,
  username,
  providername,
  membername,
  benefitname,
  requestsourcename,
  authorizedstatusname,
  providertype,
  icdcodes,
  selec,
  deleteclaims,
  approveclaims,
  ref_no,
  claimstatusname,
  requesttypename,
  memberdeclineamount,
  providerrecoveryamount
) AS
SELECT "CLAIM_CODE","REQUEST_NUMBER","CPPREFIX","CPNO","CPSUFFIX","CPFULLNO","AUTHORIZEDSTATUS","TRANSACTIONDATE","REQUEST_SOURCE","REQUEST_TYPE","REQUEST_STATUS","PROVIDER_CODE","IS_BLOCKED","IS_FASTTRACE_PAYMENT","MEMBER_CODE","AUTHORIZATOIN_CODE","CREATEDIN","CREATEDON","CREATEDBY","LASTMODIFIEDON","LASTMODIFIEDBY","LEGALENTITYCODE","CUSTOMERCODE","LOCATIONCODE","COMPANYCODE","BENEFIT_CODE","REQUEST_AMOUNT","APPROVED_DATE","APPROVED_AMOUNT","TREATMENT_TYPE","ENCOUNTER_START_DATE","TYPE","CLAIM_STATUS","DENIAL_REASON","CASESUMMARY","SERIALNO","DENAILVALUE","PICTURE","INVOICENUMBER","DENIALREASON","REASON","TYPECODE","ACTIVITYCODE","MAP_VALUE","BATCH_NUMBER","ATHORIZATOIN_CODE","ENCOUNTER_END_DATE","DURATION","REQUEST_DATE","RESUBMISSION_TYPE","BATCHCODE","PARENTCLAIMCODE","CURRENCYCODE","NETWORKCODE","POLICYCODE","CATEGORY_CODE","ISEMERGENCY","PROVINCECODE","CDCODE","UPLOADSTATUS","DISCOUNTTOTAL","ACTIVITYPRICE","CO_INS_VALUE","DEDUCTABLEVALUE","INVOICEDATE","ACR_FORM_NO","ACR_FORM_TYPE","CLAIM_TYPE","NETAMOUNT","MEMBERPOLICYCODE","RESUBMISSION","ISRESUBMISSION","CLAIM_REMARKS","ENCOUNTER_START_TYPE","ENCOUNTER_END_TYPE","ENCOUNTER_FACILITY_TYPE","RFP","SUBMITTORA","FINANCE","ORGINALPATIENTSHARE","RATE","REIMBURSEMENTAMT","SOURCE_TYPE","SOURCE_CODE","ACR_FORM_SEQ_NO","ACR_PRODUCT_CODE","ACR_SERIAL_NO","ACR_PRODUCT_CATEGORY","ACR_MEMBER_NO","ACR_MEMBER_REFERENCE_NO","ACR_PROVIDER_CODE","ACR_PHYSICIAN_CODE","ISPOSTED","PAYMENTREFNO","SOURCEPROVIDER","SCREENINGDONE","ACR_UW_YEAR","OUTOFNETWORKPROVIDERNAME","CARDNO","ISNEXTCARE","POLICYTYPECODE","NETWORKTYPE","ADMINISTRATEDBY","RESUBMISSION_COMMENTS","RESUBMISSION_ATTACHMENT","UBYMANOJ","PROCESSEDDATE","TOBEDELETECLAIMS","ALREADYSCREENED","TOBEUPDATED","ACR_SEQUENCE_NO","CEEDSTATUS","REVIEWEDBYDOCTOR","DECLINEAMOUNT","HNMAMOUNT","MDEDUCT","MCO_INS","OLDCLAIMS","AUTOREJECT","ISDECLINEDPOSTED","ISFRAUD","ISAUTOMATED","LCNT","IBNRMONTH","MEDPOSTINGDONE","ISPROCESSED","CRTCLAIM","ORIGINALDEDUCTABLEAMOUNT","ORIGINALREQUESTAMOUNT","AUTOPROCESSED","CLAIMMEMBERBATCHCODE","ACTCHECKHDR","ISREVERSED","PAYMENTTYPECODE","REIMBURSEMENT_FORM_NO","FORMTYPECODE","BRATE","MEMOTYPE","PRICEUPDATE","MEDREFDATE","ACR_SEQ_NO","ACR_INV_NO","ISCARDRESUBMISSION","ISREVERSEDFORDEBIT","ISREVERSEDFORCREDIT","POLICYID","POLICYNAME","USERNAME","PROVIDERNAME","MEMBERNAME","BENEFITNAME","REQUESTSOURCENAME","AUTHORIZEDSTATUSNAME","PROVIDERTYPE","ICDCODES","SELEC","DELETECLAIMS","APPROVECLAIMS","REF_NO","CLAIMSTATUSNAME","REQUESTTYPENAME","MEMBERDECLINEAMOUNT","PROVIDERRECOVERYAMOUNT" FROM ( SELECT CPH.*,MEM.APOLICYID POLICYID,MEM.APOLICYNAME POLICYNAME,
ADM.USERNAME,PRO.PROVIDERNAME,MEM.AMEMBERNAME MEMBERNAME,
'' BENEFITNAME,  '' REQUESTSOURCENAME,GEN.CONSTANTNAME AUTHORIZEDSTATUSNAME,PRO.PROVIDERTYPE,
(SELECT LISTAGG (IMVD.SHORTDESC, ',') WITHIN GROUP (ORDER BY IMVD.SHORTDESC) FROM  (SELECT ACTIVITY_DETAIL_CODE,CLAIM_CODE,ACTIVITY_CODE
,VERSIONDETAILCODE FROM IM_CLAIM_PROCESS_DETAIL) DTL
LEFT JOIN IM_ACTIVITY_TYPES  ACTTYP ON ACTTYP.TYPECODE=DTL.ACTIVITY_CODE
JOIN (SELECT DETAILCODE,SHORTDESC FROM IM_VERSION_DETALIS) IMVD ON IMVD.DETAILCODE = DTL.VERSIONDETAILCODE
WHERE ACTTYP.VALUE = -1 AND DTL.CLAIM_CODE = CPH.CLAIM_CODE GROUP BY DTL.CLAIM_CODE ) ICDCODES,
0 SELEC,0 DELETECLAIMS,  0 APPROVECLAIMS,JVPOS.REF_NO REF_NO,
GEN1.CONSTANTNAME CLAIMSTATUSNAME,GEN2.CONSTANTNAME REQUESTTYPENAME,
(SELECT SUM(NVL(DENIEDAMOUNT,0)) FROM IM_DECLINEAMOUNT_VW WHERE CLAIM_CODE = CPH.CLAIM_CODE) MEMBERDECLINEAMOUNT,
(SELECT SUM(NVL(DENIEDAMOUNT,0)) FROM IM_RECOVERYAMOUNT_VW WHERE CLAIM_CODE = CPH.CLAIM_CODE) PROVIDERRECOVERYAMOUNT
 FROM IM_CLAIM_PROCESS_HEADER CPH
LEFT JOIN IM_MEMBERPOLICY MEM ON MEM.MEMBERPOLICYCODE=CPH.MEMBERPOLICYCODE  AND MEM.MEMBERCODE = CPH.MEMBER_CODE
AND MEM.POLICYCODE = CPH.POLICYCODE
LEFT JOIN (SELECT PROVIDERTYPE,PROVIDERID,PROVIDERNAME,PROVIDERCODE FROM IM_PROVIDERS)  PRO ON PRO.PROVIDERCODE=CPH.PROVIDER_CODE
LEFT JOIN IM_ENDPOSTCLAIMDTL IME ON IME.CLAIMCODE = CPH.CLAIM_CODE AND NVL(INCLUDE_CLAIM,0) = 0
LEFT JOIN IM_NGI_JVPOSTING JVPOS ON JVPOS.CLAIMREFCODE = IME.ENDORESMENTCODE AND NVL(JVPOS.REVERSEJVDONE,0) = 0
JOIN (SELECT CONSTANTNAME,CONSTANTVALUE FROM GENCONSTANT  WHERE CATEGORY='AUTHORIZEDSTATUS' AND UPPER(LANGUAGECODE)='EN-US')
GEN ON GEN.CONSTANTVALUE=CPH.AUTHORIZEDSTATUS
JOIN GENCONSTANT GEN1 ON GEN1.CATEGORY='CLAIMREQSTATUS' AND UPPER(GEN1.LANGUAGECODE)='EN-US'   AND GEN1.CONSTANTVALUE =  CPH.CLAIM_STATUS
JOIN GENCONSTANT GEN2 ON GEN2.CATEGORY='CLAIMPROSOURCETYPE' AND UPPER(GEN2.LANGUAGECODE)='EN-US'   AND GEN2.CONSTANTVALUE =  CPH.REQUEST_TYPE
JOIN (SELECT USERCODE,USERNAME FROM ADMUSER) ADM ON ADM.USERCODE  = CPH.LASTMODIFIEDBY
ORDER BY ENCOUNTER_START_DATE ASC)
/

