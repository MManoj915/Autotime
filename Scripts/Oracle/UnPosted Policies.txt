CREATE OR REPLACE VIEW IM_NEXTCAREPOLICIES_VW
AS SELECT HDR.*,ROWNUM AS PKEY FROM(SELECT DISTINCT MEM.AMEMBERNAME MEMBERNAME,POL.INDIVIDUALPOLICYCODE POLICYCODE,POL.POLICYID,POL.POLICYNAME,AGN.AGENT_NAME_EN AGENTNAME,NXT.GROSSPREMIUM,
(NXT.GROSSPREMIUM)*(TPA.COMMISSIONRATE/100) AGENTCOM,(NXT.GROSSPREMIUM)*0.05 NEXTCARECOMMISSION,
HR.SHORT_NAME
FROM IM_REINS_ADDMEMBERPOLICY ADM
JOIN IM_INDIVIDUALPOLICY POL ON POL.INDIVIDUALPOLICYCODE = ADM.POLICYCODE
JOIN IM_MEMBERPOLICY MEM ON MEM.POLICYCODE = POL.INDIVIDUALPOLICYCODE 
LEFT JOIN IM_AGENTS AGN ON AGN.AGENTCODE =  POL.AGENTCODE
JOIN IM_NEXTCAREMEMBERCARD_DTL_TEMP NXT ON NXT.CARDNUMBER=MEM.ACARDID
LEFT JOIN IM_TPABRANCH_DTL TPA ON Upper(TPA.AGENTCODE) = Upper(AGN.AGENT_ID)
LEFT JOIN HR_ORGANIZATIONS_D HR ON HR.ORGANIZATIONS_CODE = AGN.BRANCHCODE 
WHERE Nvl(ADM.STATUS,0) = 0 AND PORTALMEMBERID IS NOT NULL
AND TYPEE = 2) HDR   
