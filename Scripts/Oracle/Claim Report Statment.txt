SELECT * FROM(
SELECT
IMPOL.TYPEE  POLICYTYPE,
HDR.POLICYCODE,
IMPOL.APOLICYID POLICYID,
IMPOL.APOLICYNAME POLICYNAME,
--POL.POLICYNO,
HDR.CARDNO,
INITCAP(IMPOL.AMEMBERNAME) INSUREDPERSON,
HDR.ENCOUNTER_START_DATE TREATMENTDATE,
HDR.LASTMODIFIEDON INVOICEDATE,
HDR.INVOICENUMBER,
HDR.REQUEST_AMOUNT INVOICEAMOUNT,
NVL((SELECT SUM(DENIEDAMOUNT) FROM IM_RECOVERYAMOUNT_VW DEC WHERE DEC.CLAIM_CODE = HDR.CLAIM_CODE),0) RECOVERYAMOUNT,
NVL(HDR.DEDUCTABLEVALUE,0) DEDUCTIBLEAMOUNT,
NVL(HDR.CO_INS_VALUE,0) COINSURANCEAMOUNT,
NVL((HDR.APPROVED_AMOUNT+(NVL((SELECT SUM(DENIEDAMOUNT) FROM IM_DECLINEAMOUNT_VW DEC WHERE DEC.CLAIM_CODE = HDR.CLAIM_CODE),0))),0) NETPAY,
NVL(HDR.ACR_FORM_NO,0) FROMNUMBER,
(IMPRO.PROVIDERID|| '-' || IMPRO.PROVIDERNAME) PROVIDERID,IMPRO.PROVIDERNAME,
HDR.MEMBER_CODE,
0 GROUP_CODE,
HDR.PROVIDER_CODE,
SYSDATE AS FROMDATE,
SYSDATE AS TODATE,
NVL((IMC.ORGINALLICENCE||'-'||IMC.NAME),0) CLINICIANNAME,
IMC.CDCODE CDCODE,
(SELECT LISTAGG (IMVD.SHORTDESC, ',') WITHIN GROUP (ORDER BY IMVD.SHORTDESC) FROM IM_CLAIM_PROCESS_DETAIL_DTL SDTL
JOIN IM_CLAIM_PROCESS_DETAIL DTL ON DTL.ACTIVITY_DETAIL_CODE = SDTL.ACTIVITY_DETAIL_CODE
JOIN IM_VERSION_DETALIS IMVD ON IMVD.DETAILCODE = DTL.DENIAL_REASON
WHERE DTL.CLAIM_CODE = HDR.CLAIM_CODE AND ROWNUM < 5 GROUP BY DTL.CLAIM_CODE) RECOVERYCODE,
HDR.TRANSACTIONDATE TRANSACTIONDATE,
'' ISSERIALNONEEDED,
HDR.ORGINALPATIENTSHARE,
NVL((SELECT SUM(DENIEDAMOUNT) FROM IM_DECLINEAMOUNT_VW DEC WHERE DEC.CLAIM_CODE = HDR.CLAIM_CODE),0)  DECLINEAMOUNT,
NVL((SELECT SUM(DENIEDAMOUNT) FROM IM_RECOVERYAMOUNT_VW DEC WHERE DEC.CLAIM_CODE = HDR.CLAIM_CODE),0) HNMAMOUNT,
NVL(DECODE(HDR.SOURCEPROVIDER,2,DECODE((HDR.REQUEST_AMOUNT),((NVL((HDR.APPROVED_AMOUNT+
(NVL((SELECT SUM(DENIEDAMOUNT) FROM IM_DECLINEAMOUNT_VW DEC WHERE DEC.CLAIM_CODE = HDR.CLAIM_CODE),0)) +
(NVL((SELECT SUM(DENIEDAMOUNT) FROM IM_RECOVERYAMOUNT_VW DEC
WHERE DEC.CLAIM_CODE = HDR.CLAIM_CODE),0))),0))),HDR.CLAIM_STATUS,1),DECODE((HDR.REQUEST_AMOUNT),((NVL(HDR.DEDUCTABLEVALUE,0) + NVL(HDR.CO_INS_VALUE,0) +
NVL((HDR.APPROVED_AMOUNT+(NVL((SELECT SUM(DENIEDAMOUNT) FROM IM_DECLINEAMOUNT_VW DEC WHERE DEC.CLAIM_CODE = HDR.CLAIM_CODE),0))+
(NVL((SELECT SUM(DENIEDAMOUNT) FROM IM_RECOVERYAMOUNT_VW DEC
WHERE DEC.CLAIM_CODE = HDR.CLAIM_CODE),0))),0))),HDR.CLAIM_STATUS,1)),HDR.CLAIM_STATUS) CLAIMSTATUS,
HDR.CLAIM_CODE CHECKAMOUNT
FROM IM_CLAIM_PROCESS_HEADER HDR
LEFT JOIN (SELECT AMEMBERNAME,TYPEE,MEMBERPOLICYCODE,APOLICYID,APOLICYNAME FROM IM_MEMBERPOLICY) IMPOL ON IMPOL.MEMBERPOLICYCODE = HDR.MEMBERPOLICYCODE
LEFT JOIN (SELECT PROVIDERCODE,PROVIDERID,PROVIDERNAME FROM IM_PROVIDERS) IMPRO ON IMPRO.PROVIDERCODE = HDR.PROVIDER_CODE
LEFT JOIN (SELECT CDCODE,NAME,ORGINALLICENCE FROM IM_CLINICIANS) IMC ON IMC.CDCODE = HDR.CDCODE
WHERE
HDR.PROVIDER_CODE IN (SELECT PROVIDERCODE FROM HNMCLAIMPAYMENT_RP WHERE  USERCODE = AUSERCODE) AND
HDR.CLAIM_STATUS = 2 AND  NVL(HDR.ISPOSTED,0) = 0  AND NVL(ISRESUBMISSION,0) = 0 AND PAYMENTREFNO IS NULL
AND TRANSACTIONDATE BETWEEN (SELECT SDATE FROM HNMCLAIMPAYMENT_RP WHERE  USERCODE = AUSERCODE)
 AND (SELECT EDATE FROM HNMCLAIMPAYMENT_RP WHERE  USERCODE = AUSERCODE)  AND HDR.LASTMODIFIEDON IS NOT NULL
 AND Nvl(HDR.ISREVERSEDFORDEBIT,0) = 0

) ORDER BY CLAIMSTATUS DESC