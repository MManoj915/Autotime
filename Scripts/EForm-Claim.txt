SELECT CLAIMLINE,TREATMENTTYPE,NVL(BENEFICARYCARDNUMBER,0) BENEFICARYCARDNUMBER,NVL(CLAIMNUMBER,0) CLAIMNUMBER,NVL(CLAIMTYPE,0) CLAIMTYPE,
NVL(COUNTRYNAME,'N/A') COUNTRYNAME,ISEMERGENCY,CLAIMSTATUS,NVL(PROVIDERTYPE,'N/A')PROVIDERTYPE,PROVIDERID,
NVL(TRANSACTION_DATE,REPORTEDDATE) TRANSACTION_DATE,NVL(DISCHARGEDATE,REPORTEDDATE) DISCHARGEDATE,REPORTEDDATE,
NVL(PAYMENTDATE,'') PAYMENTDATE,DOCUMENTNO,CLAIMEDAMOUNT,NVL(APPROVEDAMOUNT,0) APPROVEDAMOUNT,NVL(BENEFICARYSHARE,0)BENEFICARYSHARE,
NVL(DECODE(ISREVERSEDFORDEBIT,0,PROVIDERRECOVERYAMOUNT,1,0),0)PROVIDERRECOVERYAMOUNT,
NVL(DECODE(ISREVERSEDFORDEBIT,0,NETAMOUNT1,1,(PROVIDERRECOVERYAMOUNT*-1)),0) NETVALUE,
NVL(REVERSEREFDATE,'') REVERSEREFDATE,NVL(INVOICENUMBER,0) INVOICENUMBER,NVL(DECLINEREASON,'NULL') DECLINEREASON,
NVL(CLAIMSOURCE,'NULL')CLAIMSOURCE,PROCESSDATE,PROVIDERNAME,NVL(BENEFITTYPE,'NULL') BENEFITTYPE,NVL(ACTIVITYTYPE,'NULL') ACTIVITYTYPE,
NVL(ICDCODES,'NULL') ICDCODES,NVL(ICDDESCRIPTION,'NULL') ICDDESCRIPTION,
NVL(MAINBRANCH,'NULL') MAINBRANCH,NVL(SUBBRANCH,'NULL') SUBBRANCH,NVL(FURTHERBRANCH,'NULL') FURTHERBRANCH,
NVL(PROCEDURETYPE,'NULL') PROCEDURETYPE,NVL(LICENSEAUTHORITY,'NULL') LICENSEAUTHORITY,NVL(PROFESSIONALID,'NULL') PROFESSIONALID,
NVL(PROFESSIONALTYPE,'NULL') PROFESSIONALTYPE,NVL(PROFESSIONALSPECIALITY,'NULL') PROFESSIONALSPECIALITY,
NVL(PROFESSIONALNAME,'NULL') PROFESSIONALNAME,NVL(UWYEAR,'NULL') UWYEAR,NVL(MANAGEDBY,'NULL') MANAGEDBY,NVL(NETWORKTYPE,'NULL') NETWORKTYPE, 
POLICYID POLICYNUMBER,NVL(BENEFICARYCARDNUMBER,0) BENEFICARYID,POLICYSTARTDATE,POLICYENDDATE,POLICYCATEGORY,
(SELECT GETANNUALLIMIT(REQUEST_TYPE,ANNUALPOLICYTYPE,ANNUALPOLICYCODE,BENEFICARYCARDNUMBER) FROM DUAL) ANNUALLIMIT,
(SELECT GETBENEFITLIMIT(REQUEST_TYPE,ANNUALPOLICYTYPE,ANNUALPOLICYCODE,BENEFICARYCARDNUMBER,10000000000000048) FROM DUAL) OPLIMIT,
(SELECT GETBENEFITLIMIT(REQUEST_TYPE,ANNUALPOLICYTYPE,ANNUALPOLICYCODE,BENEFICARYCARDNUMBER,10000000000000035)  FROM DUAL) MATLIMIT,
(SELECT GETBENEFITLIMIT(REQUEST_TYPE,ANNUALPOLICYTYPE,ANNUALPOLICYCODE,BENEFICARYCARDNUMBER,10000000000000113) FROM DUAL) DENTALLIMIT,
(SELECT GETBENEFITLIMIT(REQUEST_TYPE,ANNUALPOLICYTYPE,ANNUALPOLICYCODE,BENEFICARYCARDNUMBER,10000000000000105) FROM DUAL) OPTICALLIMIT,
(SELECT GETBENEFITLIMIT(REQUEST_TYPE,ANNUALPOLICYTYPE,ANNUALPOLICYCODE,BENEFICARYCARDNUMBER,10000000000000054) FROM DUAL) PBMLIMIT,
(SELECT GETDEDUCTAMOUNT(REQUEST_TYPE,ANNUALPOLICYTYPE,ANNUALPOLICYCODE,BENEFICARYCARDNUMBER,10000000000000017) FROM DUAL) IPDEDUCTIBLE,
(SELECT GETCOINSAMOUNT(REQUEST_TYPE,ANNUALPOLICYTYPE,ANNUALPOLICYCODE,BENEFICARYCARDNUMBER,10000000000000017) FROM DUAL) IPCOINSURANCE,
(SELECT GETDEDUCTAMOUNT(REQUEST_TYPE,ANNUALPOLICYTYPE,ANNUALPOLICYCODE,BENEFICARYCARDNUMBER,10000000000000048) FROM DUAL) OPDEDUCTIBLE,
(SELECT GETCOINSAMOUNT(REQUEST_TYPE,ANNUALPOLICYTYPE,ANNUALPOLICYCODE,BENEFICARYCARDNUMBER,10000000000000048) FROM DUAL) OPCOINSURANCE,
(SELECT GETDEDUCTAMOUNT(REQUEST_TYPE,ANNUALPOLICYTYPE,ANNUALPOLICYCODE,BENEFICARYCARDNUMBER,10000000000000035) FROM DUAL) MATDEDUCTIBLE,
(SELECT GETCOINSAMOUNT(REQUEST_TYPE,ANNUALPOLICYTYPE,ANNUALPOLICYCODE,BENEFICARYCARDNUMBER,10000000000000035) FROM DUAL) MATCOINSURANCE,
(SELECT GETDEDUCTAMOUNT(REQUEST_TYPE,ANNUALPOLICYTYPE,ANNUALPOLICYCODE,BENEFICARYCARDNUMBER,10000000000000113) FROM DUAL) DENTALDEDUCTIBLE,
(SELECT GETCOINSAMOUNT(REQUEST_TYPE,ANNUALPOLICYTYPE,ANNUALPOLICYCODE,BENEFICARYCARDNUMBER,10000000000000113) FROM DUAL) DENTALCOINSURANCE,
(SELECT GETDEDUCTAMOUNT(REQUEST_TYPE,ANNUALPOLICYTYPE,ANNUALPOLICYCODE,BENEFICARYCARDNUMBER,10000000000000105) FROM DUAL) OPTICALDEDUCTIBLE,
(SELECT GETCOINSAMOUNT(REQUEST_TYPE,ANNUALPOLICYTYPE,ANNUALPOLICYCODE,BENEFICARYCARDNUMBER,10000000000000105) FROM DUAL) OPTICALCOINSURANCE,
(SELECT GETDEDUCTAMOUNT(REQUEST_TYPE,ANNUALPOLICYTYPE,ANNUALPOLICYCODE,BENEFICARYCARDNUMBER,10000000000000054) FROM DUAL) PBMDEDUCTIBLE,
(SELECT GETCOINSAMOUNT(REQUEST_TYPE,ANNUALPOLICYTYPE,ANNUALPOLICYCODE,BENEFICARYCARDNUMBER,10000000000000054)  FROM DUAL)PBMCOINSURANCE,
POLICYNAME,(SELECT GETPLANNAME(REQUEST_TYPE,ANNUALPOLICYTYPE,ANNUALPOLICYCODE,BENEFICARYCARDNUMBER)  FROM DUAL) PLANNAME,
COINSURANCEAMOUNT,DEDUCTIBLEAMOUNT FROM(
SELECT HDR1.*,DECODE(MEMOTYPE,1,(NETAMOUNT*-1),NETAMOUNT) NETAMOUNT1 FROM(
SELECT HDR.*,GROSSAMOUNT - GROSSAMOUNT / 100 * DISCOUNTPERCENT NETAMOUNT FROM (
SELECT MPOL.ACARDID BENEFICARYCARDNUMBER,HDR.ACR_FORM_NO CLAIMNUMBER,ROWNUM CLAIMLINE,GENCON.CONSTANTNAME TREATMENTTYPE,
DECODE(HDR.REQUEST_TYPE,1,'ECLAIM',2,'PAPER CLAIM',3,'REIMBURSEMENT CLAIM',4,'TPA CLAIM') CLAIMTYPE,
CON.COUNTRYNAME,'N' ISEMERGENCY,DECODE(HDR.CLAIM_STATUS,2,'PROCESSED','PENDING') CLAIMSTATUS,
GEN.CONSTANTNAME PROVIDERTYPE,PRO.PROVIDERID,TO_DATE(HDR.ENCOUNTER_START_DATE,'DD/MM/RRRR') TRANSACTION_DATE,
TO_DATE(NVL(HDR.ENCOUNTER_END_DATE,HDR.ENCOUNTER_START_DATE),'DD/MM/RRRR') DISCHARGEDATE,
TO_DATE(HDR.TRANSACTIONDATE,'DD/MM/RRRR') REPORTEDDATE,TO_DATE (HDR.PAYMENTREFDATE, 'DD/MM/RRRR') PAYMENTDATE,
HDR.PAYMENTREFNO DOCUMENTNO,HDR.REQUEST_AMOUNT CLAIMEDAMOUNT,
((ROUND (HDR.APPROVED_AMOUNT, 2)+ (SELECT NVL (SUM (NVL (DENIEDAMOUNT, 0)), 0) DENIEDAMOUNT
FROM IM_DECLINEAMOUNT_VW VW WHERE VW.CLAIM_CODE = HDR.CLAIM_CODE AND
HDR.CLAIM_CODE NOT IN(SELECT CLAIM_CODE FROM REJDEC)AND REQUEST_TYPE IN (1, 2))) +
NVL(HDR.CO_INS_VALUE,0) + NVL(HDR.DEDUCTABLEVALUE,0)) APPROVEDAMOUNT,
(NVL(HDR.CO_INS_VALUE,0) + NVL(HDR.DEDUCTABLEVALUE,0)) BENEFICARYSHARE,
NVL(HDR.CO_INS_VALUE,0) COINSURANCEAMOUNT,NVL(HDR.DEDUCTABLEVALUE,0) DEDUCTIBLEAMOUNT,
NVL((SELECT SUM (DENIEDAMOUNT)FROM IM_RECOVERYAMOUNT_VW DEC
WHERE DEC.CLAIM_CODE = HDR.CLAIM_CODE),0) PROVIDERRECOVERYAMOUNT,
Nvl((SELECT NVL (SUM (NVL (DENIEDAMOUNT, 0)), 0) DENIEDAMOUNT
FROM IM_DECLINEAMOUNT_VW VW WHERE VW.CLAIM_CODE = HDR.CLAIM_CODE AND
 HDR.CLAIM_CODE NOT IN(SELECT CLAIM_CODE FROM REJDEC)AND REQUEST_TYPE IN (3)),0) MEMBERDECLINEAMOUNT,
(ROUND (HDR.APPROVED_AMOUNT, 2)+ (SELECT NVL (SUM (NVL (DENIEDAMOUNT, 0)), 0) DENIEDAMOUNT
FROM IM_DECLINEAMOUNT_VW VW WHERE VW.CLAIM_CODE = HDR.CLAIM_CODE AND
 HDR.CLAIM_CODE NOT IN(SELECT CLAIM_CODE FROM REJDEC)AND REQUEST_TYPE IN (1, 2)))
GROSSAMOUNT,TO_CHAR (HDR.REVERSEREFDATE, 'DD/MM/RRRR') REVERSEREFDATE,
HDR.INVOICENUMBER,
(SELECT LISTAGG (IMVD.SHORTDESC, ',')WITHIN GROUP (ORDER BY IMVD.SHORTDESC)
FROM IM_CLAIM_PROCESS_DETAIL DTL
JOIN IM_VERSION_DETALIS IMVD ON IMVD.DETAILCODE = DTL.DENIAL_REASON
WHERE  HDR.CLAIM_CODE = DTL.CLAIM_CODE AND ROWNUM < 21
GROUP BY DTL.CLAIM_CODE)DECLINEREASON,GEN1.CONSTANTNAME CLAIMSOURCE,
DECODE(HDR.CLAIM_STATUS,2,TO_CHAR(HDR.LASTMODIFIEDON,'DD/MM/RRRR'),'') PROCESSDATE,
PRO.PROVIDERNAME,(SELECT LISTAGG (IBC.BENEFIT_ID, ',') WITHIN GROUP (ORDER BY IBC.BENEFIT_ID)
FROM IM_CLAIM_PROCESS_DETAIL DTL
LEFT JOIN IM_BENEFIT_CODES IBC ON IBC.BENEFIT_CODE = DTL.BENEFIT_CODE
WHERE DTL.CLAIM_CODE = HDR.CLAIM_CODE AND ROWNUM < 21
GROUP BY DTL.CLAIM_CODE) BENEFITTYPE,
(  SELECT LISTAGG (IMVD.SHORTDESC, ',') WITHIN GROUP (ORDER BY IMVD.SHORTDESC)
FROM IM_CLAIM_PROCESS_DETAIL DTL
LEFT JOIN IM_ACTIVITY_TYPES ACTTYP ON ACTTYP.TYPECODE = DTL.ACTIVITY_CODE
JOIN IM_VERSION_DETALIS IMVD  ON IMVD.DETAILCODE = DTL.VERSIONDETAILCODE
WHERE ACTTYP.VALUE <> -1 AND ROWNUM < 21 AND DTL.CLAIM_CODE = HDR.CLAIM_CODE
GROUP BY DTL.CLAIM_CODE) ACTIVITYTYPE,
(SELECT LISTAGG (IMVD.CODE, ',') WITHIN GROUP (ORDER BY IMVD.CODE)
FROM IM_CLAIM_PROCESS_DETAIL DTL
LEFT JOIN IM_ACTIVITY_TYPES ACTTYP ON ACTTYP.TYPECODE = DTL.ACTIVITY_CODE
JOIN IM_VERSION_DETALIS IMVD  ON IMVD.DETAILCODE = DTL.VERSIONDETAILCODE
WHERE ACTTYP.VALUE = -1 AND ROWNUM < 21 AND DTL.CLAIM_CODE = HDR.CLAIM_CODE
GROUP BY DTL.CLAIM_CODE) ICDCODES,
(SELECT LISTAGG (IMVD.SHORTDESC, ',') WITHIN GROUP (ORDER BY IMVD.SHORTDESC)
FROM IM_CLAIM_PROCESS_DETAIL DTL
LEFT JOIN IM_ACTIVITY_TYPES ACTTYP ON ACTTYP.TYPECODE = DTL.ACTIVITY_CODE
JOIN IM_VERSION_DETALIS IMVD  ON IMVD.DETAILCODE = DTL.VERSIONDETAILCODE
WHERE ACTTYP.VALUE = -1 AND ROWNUM < 21 AND DTL.CLAIM_CODE = HDR.CLAIM_CODE
GROUP BY DTL.CLAIM_CODE) ICDDESCRIPTION,
SF_GETMAINBRANCH(HDR.MEMBERPOLICYCODE) MAINBRANCH,
SF_GETMAINBRANCH(HDR.MEMBERPOLICYCODE) SUBBRANCH,
SF_GETMAINBRANCH(HDR.MEMBERPOLICYCODE) FURTHERBRANCH,
(SELECT TRIM(LISTAGG(TO_CHAR(ACTTYP.TYPENAME), ',') WITHIN GROUP (ORDER BY ACTTYP.TYPENAME))
FROM IM_CLAIM_PROCESS_DETAIL DTL
LEFT JOIN IM_ACTIVITY_TYPES ACTTYP ON ACTTYP.TYPECODE = DTL.ACTIVITY_CODE
WHERE ACTTYP.VALUE <> -1 AND ROWNUM < 21 AND DTL.CLAIM_CODE = HDR.CLAIM_CODE
GROUP BY DTL.CLAIM_CODE) PROCEDURETYPE,DECODE(HDR.SOURCEPROVIDER,1,'DHA',2,'HADD') LICENSEAUTHORITY,
SF_GETCLINICIANINFO(HDR.CDCODE,1) PROFESSIONALID,
SF_GETCLINICIANINFO(HDR.CDCODE,3) PROFESSIONALTYPE,
SF_GETCLINICIANINFO(HDR.CDCODE,2) PROFESSIONALSPECIALITY,
SF_GETCLINICIANINFO(HDR.CDCODE,4) PROFESSIONALNAME,NVL (HDR.DISCOUNTPERCENTAGE, 0) DISCOUNTPERCENT,DECODE (ISNEXTCARE,
1, 'IN NET',
(SELECT L_INNET
FROM TABLE (
SF_GETCLAIMSNWTYPE_FNC (
HDR.POLICYCODE,
HDR.CATEGORY_CODE,
HDR.PROVIDER_CODE,
1))))
NETWORKTYPE,NVL (GEN8.CONSTANTNAME, 'NGI') MANAGEDBY,NVL (POL.POLICYID, IPOL.POLICYID) POLICYID,HDR.MEMOTYPE,
NVL(HDR.ISREVERSEDFORDEBIT,0) ISREVERSEDFORDEBIT,TO_CHAR(NVL(POL.STARTDATE,IPOL.STARTDATE),'RRRR') UWYEAR,
NVL(POL.STARTDATE,IPOL.STARTDATE) POLICYSTARTDATE,NVL(POL.ENDDATE,IPOL.ENDDATE) POLICYENDDATE,
Decode(Nvl(POL.POLICYCODE,0),0,'Individual','Group') POLICYCATEGORY,HDR.REQUEST_TYPE,
Nvl(POL.POLICYCODE,IPOL.INDIVIDUALPOLICYCODE) ANNUALPOLICYCODE,Decode(Nvl(POL.POLICYCODE,0),0,2,1) ANNUALPOLICYTYPE,
Nvl(POL.POLICYNAME,IPOL.POLICYNAME) POLICYNAME  
FROM
(SELECT * FROM IM_CLAIM_PROCESS_HEADER WHERE TRANSACTIONDATE BETWEEN
TO_DATE('01/07/2016','DD/MM/RRRR') AND TO_DATE(SYSDATE -1,'DD/MM/RRRR') AND NVL(ISPOSTED,0) = 1
AND PAYMENTREFNO IS NOT NULL AND CLAIM_CODE IN (SELECT CLAIMCODE FROM IM_ENDPOSTCLAIMDTL)) HDR
LEFT JOIN IM_MEMBERPOLICY MPOL ON MPOL.MEMBERPOLICYCODE = HDR.MEMBERPOLICYCODE
LEFT JOIN IM_PROVIDERS PRO ON PRO.PROVIDERCODE = HDR.PROVIDER_CODE
LEFT JOIN GENCONSTANT GEN ON GEN.CONSTANTVALUE = PRO.PROVIDERTYPE AND GEN.CATEGORY='PROVIDERTYPE' AND UPPER(GEN.LANGUAGECODE) = 'EN-US'
LEFT JOIN GENCONSTANT GEN1 ON GEN1.CONSTANTVALUE = HDR.SOURCEPROVIDER AND GEN1.CATEGORY='PRIORSOURCEPROVIDER' AND UPPER(GEN1.LANGUAGECODE) = 'EN-US'
LEFT JOIN GENCOUNTRY CON ON CON.COUNTRYCODE = PRO.COUNTRYCODE
LEFT JOIN IM_POLICY POL ON POL.POLICYCODE = NVL (MPOL.POLICYCODE, HDR.POLICYCODE) --AND MPOL.TYPEE = 1
LEFT JOIN IM_INDIVIDUALPOLICY IPOL ON IPOL.INDIVIDUALPOLICYCODE = NVL (MPOL.POLICYCODE, HDR.POLICYCODE)
LEFT JOIN GENCONSTANT GENCON ON GENCON.CONSTANTVALUE = Nvl(HDR.TREATMENT_TYPE,0) AND GENCON.CATEGORY = 'APPLICABLE' AND UPPER(GENCON.LANGUAGECODE) = 'EN-US'
LEFT JOIN GENCONSTANT GEN8 ON GEN8.CONSTANTVALUE = NVL (POL.OWNERCODE, IPOL.OWNERCODE) AND GEN8.CATEGORY = 'NGIQUOTATIONTYPE' AND UPPER (GEN8.LANGUAGECODE) = 'EN-US'
WHERE HDR.ACR_MEMBER_NO IS NULL AND CLAIM_CODE NOT IN (SELECT CLAIMCODE FROM IM_ENDPOSTCLAIMDTL WHERE ENDORESMENTCODE
IN (SELECT CLAIMREFCODE FROM JAN12011 WHERE REVERSEJVCODE =
100000000000007308))
)HDR)HDR1)