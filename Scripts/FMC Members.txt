
DECLARE L_GENDER NUMBER;
L_RELATION NUMBER;
L_RELATIONNAME VARCHAR2(500);
L_MARITALSTATUS NUMBER;
L_NATIONALITY NUMBER;L_LOCATION NUMBER;
L_SALARYBAND NUMBER;L_SALARYBANDNAME VARCHAR2(500);
L_POLICY_ROW IM_POLICY%ROWTYPE; L_PARENTCODE NUMBER;
BEGIN
FOR HDR IN(SELECT A.*,'8181-1' POLICYID FROM IM_PR_FMC_ACTIVE A WHERE MEMBERCARDNO NOT IN
(SELECT CARDNO FROM IM_MEMBERS WHERE CARDNO IS NOT NULL)) LOOP  
SELECT * INTO L_POLICY_ROW FROM IM_POLICY WHERE POLICYID = HDR.POLICYID;   
SELECT Max(CONSTANTVALUE) INTO L_GENDER FROM GENCONSTANT WHERE CATEGORY = 'GENDER' AND
Upper(CONSTANTNAME) = Upper(HDR.GENDER) AND Upper(LANGUAGECODE) = 'EN-US';   
SELECT Max(CONSTANTVALUE) INTO L_MARITALSTATUS FROM GENCONSTANT WHERE CATEGORY = 'MARITALSTATUS' AND
Upper(CONSTANTNAME) = Upper(HDR.MARITALSTATUS) AND Upper(LANGUAGECODE) = 'EN-US';   
SELECT Max(CONSTANTVALUE) INTO L_NATIONALITY FROM GENCONSTANT WHERE CATEGORY = 'FND_NATIONALITY' AND
Upper(CONSTANTNAME) = Upper(HDR.NATIONALITY) AND Upper(LANGUAGECODE) = 'EN-US';
SELECT Max(CONSTANTVALUE) INTO L_LOCATION FROM GENCONSTANT WHERE CATEGORY = 'MEMBERLOCATION' AND
Upper(CONSTANTNAME) = Upper(HDR.STATENAME) AND Upper(LANGUAGECODE) = 'EN-US';     
L_SALARYBAND := 4;     
L_RELATIONNAME := 'SELF';       
SELECT Max(CONSTANTVALUE) INTO L_RELATION FROM GENCONSTANT WHERE CATEGORY = 'MEMBERRELATION' AND
Upper(CONSTANTNAME) = Upper(L_RELATIONNAME) AND Upper(LANGUAGECODE) = 'EN-US';  
INSERT INTO IM_MEMBERS(
GROUP_CODE, MEMBER_CODE, MEMBER_ID, MEMBER_TYPE, FIRST_NAME, LAST_NAME, ARABIC_FIRST_NAME, PICTURE, 
ATTACHMENT, DATE_OF_BIRTH, GENDER, RELATION, DESIGNATION, NATIONALITY, NATIONALITY_DISPLAY, DEPARTMENT, EMIRATES_ID, 
MOBILE_NUMBER, PHONE_NUMBER, COVERED_FROM_DATE, EFFECTIVE_START_DATE, EFFECTIVE_END_DATE, 
PARENT_ID, CREATEDIN, CREATEDON, CREATEDBY, LASTMODIFIEDON, LASTMODIFIEDBY, LEGALENTITYCODE, CUSTOMERCODE, LOCATIONCODE, COMPANYCODE, 
SERIALNO, REMARKS, CATEGORY_CODE, RELATIONCODE, PRINTT, REPRINT, RETURNED, MARITAL_STATUS, CARDAMOUNT, CARDNO, USERCODE, 
COVERED_END_DATE, CARDID, EMAILID, ADDRESS, EMPLOYEENO, EMIRATECODE, POLICYMEMBERID, PARENTGROUPCODE, INCEPTION_DATE, 
ISEXISTINGMEMBER, EXISTING_INSURER, DATE_OF_ENTRY, COCEXPIRY, OCCUPATION, ADDRESS1, ADDRESS2, PHONE_NO, MOBILE_NO, EMAIL_ID, 
PASSPORT_NO, HEIGHT, WEIGHT, STAFF_ID, DISCOUNT_PCT, LOADING_PCT, LOCATION, STATUS, USERNAME, PASSWORD, 
MEMBERPOLICYCODE, POLICYCODE, POLICYTYPE, APM_PRODUCT_CODE, APM_SERIAL_NO, APM_PRODUCT_CATEGORY, APM_UW_YEAR, APM_MEMBER_NO, APM_MEM_REFERENCE_NO, 
APM_ACTIVE_FLAG, MEMBERREFCODE, OLDMEMBERID, SHOWSUBGROUPINCARD, ADDMEMBERPOLICYCODE, ADDMEMBERDETCODE, POLICYADDREFCODE, INDPOLICYADDREFCODE, 
IP_MEM_CODE, POLICY_MEM_CODE, MEMBERSINCE, APOLICYID, APOLICYNAME, FINEAMOUNT, ASTAFF_ID, TMEMBERSINCE, 
TPICTURE, ENTRYTYPE, HAADFINE, WAIVEAMOUNT, NOOFDAYS, WORKLOCATION, RESIDENTLOCATION, ISCOMMISSION, SALARYBAND, UIDNUMBER, 
ISPREEXISTING, ENTITYTYPE, ENTITYID, MIDDLENAME, ISMEMBERDATAUPLOADED, IMAGEUPDATE, MEMBERENTITYIDNAME, NATIONALITY_OLD, UPS)
VALUES(
L_POLICY_ROW.GROUPCODE, (SELECT Max(MEMBER_CODE)+1 FROM IM_MEMBERS),HDR.MEMBER_ID, 1, HDR.MEMBERFNAME, HDR.MEMBERLNAME, HDR.MEMBERFNAME , NULL, 
NULL,To_Date(HDR.DOB,'DD/MM/RRRR'),L_GENDER,L_RELATION,NULL,L_NATIONALITY, L_NATIONALITY, NULL, HDR.EMIRATESID, 
'971-55-5555555','971-55-5555555',To_Date(HDR.EFFECTIVEFROM,'DD/MM/RRRR'),To_Date(HDR.EFFECTIVEFROM,'DD/MM/RRRR'), To_Date(HDR.EFFECTIVETO,'DD/MM/RRRR'), 
L_PARENTCODE, 1, NULL, 100000000000000002, NULL, 100000000000000002, 100000000000000001, 100000000000000001, 1, 1, 
(SELECT Max(SERIALNO)+1 FROM IM_MEMBERS), NULL, 100000000000000003, L_RELATION, 0, 0, 0, L_MARITALSTATUS, NULL,HDR.MEMBERCARDNO, 100000000000000271, 
To_Date(HDR.EFFECTIVETO,'DD/MM/RRRR'),HDR.MEMBERCARDNO, NULL, NULL, NULL, NULL, NULL, NULL, To_Date(HDR.EFFECTIVEFROM,'DD/MM/RRRR'),
NULL, NULL, NULL, NULL, NULL, NULL, NULL, '971-55-5555555','971-55-5555555',NULL, 
HDR.PASSPORTNO, NULL, NULL,NULL, NULL, NULL, 1, 0,NULL,NULL, 
NULL, L_POLICY_ROW.POLICYCODE, 1,NULL,NULL, NULL, NULL,NULL,NULL, 
'A', NULL, NULL, NULL, NULL, NULL, NULL, NULL, 
NULL,NULL,To_Date(HDR.EFFECTIVEFROM,'DD/MM/RRRR'),L_POLICY_ROW.POLICYID,L_POLICY_ROW.POLICYNAME, NULL, NULL , NULL, 
NULL, NULL, NULL, NULL, NULL, L_LOCATION, L_LOCATION, 2, L_SALARYBAND, HDR.UIDNUMBER, 
NULL, 1, NULL, HDR.MEMBERMNAME, 1, NULL, HDR.UIDNUMBER, L_NATIONALITY, 1206);
COMMIT;        
END LOOP;
END;

DECLARE L_MEMBERPOLICYCODE NUMBER;L_SERIALNO NUMBER;
BEGIN
SELECT Max(MEMBERPOLICYCODE)+1 INTO L_MEMBERPOLICYCODE FROM IM_MEMBERPOLICY;
SELECT Max(SERIALNO)+1 INTO L_SERIALNO FROM IM_MEMBERPOLICY;
INSERT INTO IM_MEMBERPOLICY
SELECT L_MEMBERPOLICYCODE+ROWNUM,H.MEMBER_CODE,H.POLICYCODE,H.COVERED_FROM_DATE,P.ENDDATE,P.STARTDATE,P.ENDDATE, 
1, 1, NULL, NULL,SYSDATE, 100000000000000002, NULL, 100000000000000002, 100000000000000001, 100000000000000001, 
L_SERIALNO+ROWNUM,H.CATEGORY_CODE,SYSDATE,0, 1, 1, 0, 
NULL, NULL,H.DATE_OF_BIRTH, H.GENDER, H.RELATION, NULL, H.MARITAL_STATUS, H.MEMBER_ID, H.FIRST_NAME||' '||H.MIDDLENAME||' '||H.LAST_NAME, 
H.GROUP_CODE, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 
NULL, NULL, H.FIRST_NAME, H.LAST_NAME,H.FIRST_NAME,H.NATIONALITY, H.EMIRATES_ID, H.MOBILE_NUMBER, 
H.PHONE_NUMBER, NULL, H.RELATION, H.MARITAL_STATUS, H.CARDNO, H.EMAILID, NULL, NULL, NULL, NULL, NULL, 
H.PHONE_NUMBER, H.MOBILE_NUMBER, H.EMAILID, H.PASSPORT_NO, NULL, NULL, H.STAFF_ID, '1',H.MEMBERSINCE, H.APOLICYID,H.APOLICYNAME, 
H.CARDNO, NULL, NULL, NULL, H.WORKLOCATION, H.RESIDENTLOCATION, H.ISCOMMISSION, H.SALARYBAND, H.UIDNUMBER, NULL, 
NULL, NULL, NULL,NULL, NULL, NULL, 0         
FROM IM_MEMBERS H
JOIN IM_POLICY P ON P.POLICYCODE = H.POLICYCODE
WHERE H.POLICYTYPE=1 AND UPS=1206 AND P.POLICYID = '8181-1';
COMMIT;
END;




                                     