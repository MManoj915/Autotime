DECLARE L_POLCATESETTLMITAGECODE NUMBER;
BEGIN 
FOR HDR IN(SELECT * FROM IM_POLICY WHERE PORTALTYPE ='PR') LOOP
IF HDR.OWNERCODE = 11 THEN
  FOR PDTL IN (SELECT * FROM IM_POLICY_CATEGORYDTL WHERE POLICYCODE = HDR.POLICYCODE) LOOP

    DELETE FROM IM_POLCATESETTINGAGELIMITS WHERE PCDCODE = PDTL.PCDCODE;
    COMMIT;

      FOR DTL IN(SELECT DISTINCT GROSSPREMIUM,GENDER,MARITAL_STATUS,FROMAGE,TOAGE FROM IM_PR_BASERATES WHERE ACTIVE = 1 AND OWNERCODE = HDR.OWNERCODE
      AND PLANCODE = 100000000000000006 AND SOURCE = HDR.REQUEST_SOURCE) LOOP
        INSERT INTO CAPPS.IM_POLCATESETTINGAGELIMITS
        (POLCATESETTLMITAGECODE,PCDCODE, AGEFROM, AGETO, GENDERCODE, PREMIUM, 
        CREATEDIN, CREATEDON, CREATEDBY, LASTMODIFIEDON, LASTMODIFIEDBY, 
        COMPANYCODE, LOCATIONCODE, DEACTIVATEDON, DEACTIVATEDBY, SERIALNO, 
        APPLICABLEFOR, RENEWALTYPE, RENEWALVALUE, CARDTEXT, ISRESIZE)
        VALUES
        ((SELECT MAX(POLCATESETTLMITAGECODE) + 1 FROM IM_POLCATESETTINGAGELIMITS), PDTL.PCDCODE, DTL.FROMAGE, DTL.TOAGE, DTL.GENDER, 
        DTL.GROSSPREMIUM, NULL, SYSDATE, 100000000000001417, SYSDATE, 
        100000000000001136, 1, 1, NULL, NULL, 
        (SELECT MAX(POLCATESETTLMITAGECODE) + 1 FROM IM_POLCATESETTINGAGELIMITS), DTL.MARITAL_STATUS, NULL, NULL,  NULL, 
        1);
        COMMIT;      
      END LOOP;

      FOR DTL IN(SELECT DISTINCT GROSSPREMIUM,GENDER,MARITAL_STATUS,FROMAGE,TOAGE FROM IM_PR_BASERATES WHERE ACTIVE = 1 AND OWNERCODE = HDR.OWNERCODE
      AND PLANCODE  = 100000000000000006  AND SOURCE = HDR.REQUEST_SOURCE) LOOP
        SELECT POLCATESETTLMITAGECODE INTO L_POLCATESETTLMITAGECODE FROM  IM_POLCATESETTINGAGELIMITS WHERE  AGEFROM = DTL.FROMAGE AND AGETO = DTL.TOAGE
        AND GENDERCODE = DTL.GENDER AND PREMIUM = DTL.GROSSPREMIUM AND APPLICABLEFOR = DTL.MARITAL_STATUS AND PCDCODE = PDTL.PCDCODE;
        
        DELETE FROM  IM_POLCATEGORYAGERELATION WHERE POLCATESETTLMITAGECODE = L_POLCATESETTLMITAGECODE;
        COMMIT;

        FOR SDTL IN(SELECT DISTINCT RELATION FROM IM_PR_BASERATES WHERE ACTIVE = 1 AND OWNERCODE = HDR.OWNERCODE
        AND PLANCODE  = 100000000000000006 AND SOURCE = HDR.REQUEST_SOURCE AND GROSSPREMIUM = DTL.GROSSPREMIUM
        AND GENDER = DTL.GENDER AND MARITAL_STATUS = DTL.MARITAL_STATUS AND FROMAGE = DTL.FROMAGE AND TOAGE = DTL.TOAGE) LOOP
            INSERT INTO CAPPS.IM_POLCATEGORYAGERELATION
            (RELATIONCODE,POLCATESETTLMITAGECODE, RELATIONTYPECODE, PREMIUM, CREATEDIN, CREATEDON, 
            CREATEDBY, LASTMODIFIEDON, LASTMODIFIEDBY, COMPANYCODE, LOCATIONCODE, 
            DEACTIVATEDON, DEACTIVATEDBY, SERIALNO, ISAPPLICABLE, RENEWALTYPE, 
            RENEWALVALUE)
            VALUES
            ((SELECT MAX(RELATIONCODE) + 1 FROM IM_POLCATEGORYAGERELATION), L_POLCATESETTLMITAGECODE, SDTL.RELATION, DTL.GROSSPREMIUM, NULL, 
            SYSDATE, 100000000000001417, SYSDATE, 100000000000001417, 1, 
            1, NULL, NULL, (SELECT MAX(SERIALNO) + 1 FROM IM_POLCATEGORYAGERELATION), 1, 
            NULL, NULL);
            COMMIT;
        END LOOP;   
      END LOOP;

  END LOOP;   
ELSE
  FOR PDTL IN (SELECT * FROM IM_POLICY_CATEGORYDTL WHERE POLICYCODE = HDR.POLICYCODE) LOOP

    DELETE FROM IM_POLCATESETTINGAGELIMITS WHERE PCDCODE = PDTL.PCDCODE;
    COMMIT;

      FOR DTL IN(SELECT DISTINCT GROSSPREMIUM,GENDER,MARITAL_STATUS,FROMAGE,TOAGE FROM IM_PR_BASERATES WHERE ACTIVE = 1 AND OWNERCODE = HDR.OWNERCODE
      AND PLANCODE IS NULL  AND SOURCE = HDR.REQUEST_SOURCE) LOOP
        INSERT INTO CAPPS.IM_POLCATESETTINGAGELIMITS
        (POLCATESETTLMITAGECODE,PCDCODE, AGEFROM, AGETO, GENDERCODE, PREMIUM, 
        CREATEDIN, CREATEDON, CREATEDBY, LASTMODIFIEDON, LASTMODIFIEDBY, 
        COMPANYCODE, LOCATIONCODE, DEACTIVATEDON, DEACTIVATEDBY, SERIALNO, 
        APPLICABLEFOR, RENEWALTYPE, RENEWALVALUE, CARDTEXT, ISRESIZE)
        VALUES
        ((SELECT MAX(POLCATESETTLMITAGECODE) + 1 FROM IM_POLCATESETTINGAGELIMITS), PDTL.PCDCODE, DTL.FROMAGE, DTL.TOAGE, DTL.GENDER, 
        DTL.GROSSPREMIUM, NULL, SYSDATE, 100000000000001417, SYSDATE, 
        100000000000001136, 1, 1, NULL, NULL, 
        (SELECT MAX(POLCATESETTLMITAGECODE) + 1 FROM IM_POLCATESETTINGAGELIMITS), DTL.MARITAL_STATUS, NULL, NULL,  NULL, 
        1);
        COMMIT;      
      END LOOP;

      FOR DTL IN(SELECT DISTINCT GROSSPREMIUM,GENDER,MARITAL_STATUS,FROMAGE,TOAGE FROM IM_PR_BASERATES WHERE ACTIVE = 1 AND OWNERCODE = HDR.OWNERCODE
      AND PLANCODE IS NULL  AND SOURCE = HDR.REQUEST_SOURCE) LOOP
        SELECT POLCATESETTLMITAGECODE INTO L_POLCATESETTLMITAGECODE FROM  IM_POLCATESETTINGAGELIMITS WHERE  AGEFROM = DTL.FROMAGE AND AGETO = DTL.TOAGE
        AND GENDERCODE = DTL.GENDER AND PREMIUM = DTL.GROSSPREMIUM AND APPLICABLEFOR = DTL.MARITAL_STATUS AND PCDCODE = PDTL.PCDCODE;

        DELETE FROM  IM_POLCATEGORYAGERELATION WHERE POLCATESETTLMITAGECODE = L_POLCATESETTLMITAGECODE;
        COMMIT;
        
        FOR SDTL IN(SELECT DISTINCT RELATION FROM IM_PR_BASERATES WHERE ACTIVE = 1 AND OWNERCODE = HDR.OWNERCODE
        AND PLANCODE IS NULL AND SOURCE = HDR.REQUEST_SOURCE AND GROSSPREMIUM = DTL.GROSSPREMIUM
        AND GENDER = DTL.GENDER AND MARITAL_STATUS = DTL.MARITAL_STATUS AND FROMAGE = DTL.FROMAGE AND TOAGE = DTL.TOAGE) LOOP
            INSERT INTO CAPPS.IM_POLCATEGORYAGERELATION
            (RELATIONCODE,POLCATESETTLMITAGECODE, RELATIONTYPECODE, PREMIUM, CREATEDIN, CREATEDON, 
            CREATEDBY, LASTMODIFIEDON, LASTMODIFIEDBY, COMPANYCODE, LOCATIONCODE, 
            DEACTIVATEDON, DEACTIVATEDBY, SERIALNO, ISAPPLICABLE, RENEWALTYPE, 
            RENEWALVALUE)
            VALUES
            ((SELECT MAX(RELATIONCODE) + 1 FROM IM_POLCATEGORYAGERELATION), L_POLCATESETTLMITAGECODE, SDTL.RELATION, DTL.GROSSPREMIUM, NULL, 
            SYSDATE, 100000000000001417, SYSDATE, 100000000000001417, 1, 
            1, NULL, NULL, (SELECT MAX(SERIALNO) + 1 FROM IM_POLCATEGORYAGERELATION), 1, 
            NULL, NULL);
            COMMIT;
        END LOOP;   
      END LOOP;

  END LOOP;   
END IF; 
END LOOP;
END;
                   
 

             




DECLARE L_POLCATESETTLMITAGECODE NUMBER;
BEGIN 
FOR HDR IN(SELECT * FROM IM_INDIVIDUALPOLICY WHERE PORTALTYPE ='PR'  ) LOOP
IF HDR.OWNERCODE = 11 THEN
  FOR PDTL IN (SELECT * FROM IM_NGIINDPOLICYCATEGORY WHERE INDIVIDUALPOLICYCODE = HDR.INDIVIDUALPOLICYCODE) LOOP

    DELETE FROM IM_INDCATESETTINGAGELIMITS WHERE POLICYCATEGORYCODE = PDTL.POLICYCATEGORYCODE;
    COMMIT;

      FOR DTL IN(SELECT DISTINCT GROSSPREMIUM,GENDER,MARITAL_STATUS,FROMAGE,TOAGE FROM IM_PR_BASERATES WHERE ACTIVE = 1 AND OWNERCODE = HDR.OWNERCODE
      AND PLANCODE = 100000000000000006 AND SOURCE = HDR.INDIPOLICYSOURCECODE) LOOP
        INSERT INTO CAPPS.IM_INDCATESETTINGAGELIMITS
        (POLCATESETTLMITAGECODE,POLICYCATEGORYCODE, AGEFROM, AGETO, GENDERCODE, PREMIUM, 
        CREATEDIN, CREATEDON, CREATEDBY, LASTMODIFIEDON, LASTMODIFIEDBY, 
        COMPANYCODE, LOCATIONCODE, DEACTIVATEDON, DEACTIVATEDBY, SERIALNO, 
        APPLICABLEFOR, RENEWALTYPE, RENEWALVALUE, CARDTEXT, ISRESIZE)
        VALUES
        ((SELECT MAX(POLCATESETTLMITAGECODE) + 1 FROM IM_INDCATESETTINGAGELIMITS), PDTL.POLICYCATEGORYCODE, DTL.FROMAGE, DTL.TOAGE, DTL.GENDER, 
        DTL.GROSSPREMIUM, NULL, SYSDATE, 100000000000001417, SYSDATE, 
        100000000000001136, 1, 1, NULL, NULL, 
        (SELECT MAX(POLCATESETTLMITAGECODE) + 1 FROM IM_INDCATESETTINGAGELIMITS), DTL.MARITAL_STATUS, NULL, NULL,  NULL, 
        1);
        COMMIT;      
      END LOOP;

      FOR DTL IN(SELECT DISTINCT GROSSPREMIUM,GENDER,MARITAL_STATUS,FROMAGE,TOAGE FROM IM_PR_BASERATES WHERE ACTIVE = 1 AND OWNERCODE = HDR.OWNERCODE
      AND PLANCODE  = 100000000000000006  AND SOURCE = HDR.INDIPOLICYSOURCECODE) LOOP
        SELECT POLCATESETTLMITAGECODE INTO L_POLCATESETTLMITAGECODE FROM  IM_INDCATESETTINGAGELIMITS WHERE  AGEFROM = DTL.FROMAGE AND AGETO = DTL.TOAGE
        AND GENDERCODE = DTL.GENDER AND PREMIUM = DTL.GROSSPREMIUM AND APPLICABLEFOR = DTL.MARITAL_STATUS AND POLICYCATEGORYCODE = PDTL.POLICYCATEGORYCODE;
        
        DELETE FROM  IM_INDPOLCATEGORYAGERELATION WHERE POLCATESETTLMITAGECODE = L_POLCATESETTLMITAGECODE;
        COMMIT;

        FOR SDTL IN(SELECT DISTINCT RELATION FROM IM_PR_BASERATES WHERE ACTIVE = 1 AND OWNERCODE = HDR.OWNERCODE
        AND PLANCODE  = 100000000000000006 AND SOURCE = HDR.INDIPOLICYSOURCECODE AND GROSSPREMIUM = DTL.GROSSPREMIUM
        AND GENDER = DTL.GENDER AND MARITAL_STATUS = DTL.MARITAL_STATUS AND FROMAGE = DTL.FROMAGE AND TOAGE = DTL.TOAGE) LOOP
            INSERT INTO CAPPS.IM_INDPOLCATEGORYAGERELATION
            (RELATIONCODE,POLCATESETTLMITAGECODE, RELATIONTYPECODE, PREMIUM, CREATEDIN, CREATEDON, 
            CREATEDBY, LASTMODIFIEDON, LASTMODIFIEDBY, COMPANYCODE, LOCATIONCODE, 
            DEACTIVATEDON, DEACTIVATEDBY, SERIALNO, ISAPPLICABLE, RENEWALTYPE, 
            RENEWALVALUE)
            VALUES
            ((SELECT MAX(RELATIONCODE) + 1 FROM IM_INDPOLCATEGORYAGERELATION), L_POLCATESETTLMITAGECODE, SDTL.RELATION, DTL.GROSSPREMIUM, NULL, 
            SYSDATE, 100000000000001417, SYSDATE, 100000000000001417, 1, 
            1, NULL, NULL, (SELECT MAX(SERIALNO) + 1 FROM IM_INDPOLCATEGORYAGERELATION), 1, 
            NULL, NULL);
            COMMIT;
        END LOOP;   
      END LOOP;

  END LOOP;   
ELSE
  FOR PDTL IN (SELECT * FROM IM_NGIINDPOLICYCATEGORY WHERE INDIVIDUALPOLICYCODE = HDR.INDIVIDUALPOLICYCODE) LOOP

    DELETE FROM IM_INDCATESETTINGAGELIMITS WHERE POLICYCATEGORYCODE = PDTL.POLICYCATEGORYCODE;
    COMMIT;

      FOR DTL IN(SELECT DISTINCT GROSSPREMIUM,GENDER,MARITAL_STATUS,FROMAGE,TOAGE FROM IM_PR_BASERATES WHERE ACTIVE = 1 AND OWNERCODE = HDR.OWNERCODE
      AND PLANCODE IS NULL  AND SOURCE = HDR.INDIPOLICYSOURCECODE) LOOP
        INSERT INTO CAPPS.IM_INDCATESETTINGAGELIMITS
        (POLCATESETTLMITAGECODE,POLICYCATEGORYCODE, AGEFROM, AGETO, GENDERCODE, PREMIUM, 
        CREATEDIN, CREATEDON, CREATEDBY, LASTMODIFIEDON, LASTMODIFIEDBY, 
        COMPANYCODE, LOCATIONCODE, DEACTIVATEDON, DEACTIVATEDBY, SERIALNO, 
        APPLICABLEFOR, RENEWALTYPE, RENEWALVALUE, CARDTEXT, ISRESIZE)
        VALUES
        ((SELECT MAX(POLCATESETTLMITAGECODE) + 1 FROM IM_INDCATESETTINGAGELIMITS), PDTL.POLICYCATEGORYCODE, DTL.FROMAGE, DTL.TOAGE, DTL.GENDER, 
        DTL.GROSSPREMIUM, NULL, SYSDATE, 100000000000001417, SYSDATE, 
        100000000000001136, 1, 1, NULL, NULL, 
        (SELECT MAX(POLCATESETTLMITAGECODE) + 1 FROM IM_INDCATESETTINGAGELIMITS), DTL.MARITAL_STATUS, NULL, NULL,  NULL, 
        1);
        COMMIT;      
      END LOOP;

      FOR DTL IN(SELECT DISTINCT GROSSPREMIUM,GENDER,MARITAL_STATUS,FROMAGE,TOAGE FROM IM_PR_BASERATES WHERE ACTIVE = 1 AND OWNERCODE = HDR.OWNERCODE
      AND PLANCODE IS NULL  AND SOURCE = HDR.INDIPOLICYSOURCECODE) LOOP
        SELECT POLCATESETTLMITAGECODE INTO L_POLCATESETTLMITAGECODE FROM  IM_INDCATESETTINGAGELIMITS WHERE  AGEFROM = DTL.FROMAGE AND AGETO = DTL.TOAGE
        AND GENDERCODE = DTL.GENDER AND PREMIUM = DTL.GROSSPREMIUM AND APPLICABLEFOR = DTL.MARITAL_STATUS AND POLICYCATEGORYCODE = PDTL.POLICYCATEGORYCODE;

        DELETE FROM  IM_INDPOLCATEGORYAGERELATION WHERE POLCATESETTLMITAGECODE = L_POLCATESETTLMITAGECODE;
        COMMIT;
        
        FOR SDTL IN(SELECT DISTINCT RELATION FROM IM_PR_BASERATES WHERE ACTIVE = 1 AND OWNERCODE = HDR.OWNERCODE
        AND PLANCODE IS NULL AND SOURCE = HDR.INDIPOLICYSOURCECODE AND GROSSPREMIUM = DTL.GROSSPREMIUM
        AND GENDER = DTL.GENDER AND MARITAL_STATUS = DTL.MARITAL_STATUS AND FROMAGE = DTL.FROMAGE AND TOAGE = DTL.TOAGE) LOOP
            INSERT INTO CAPPS.IM_INDPOLCATEGORYAGERELATION
            (RELATIONCODE,POLCATESETTLMITAGECODE, RELATIONTYPECODE, PREMIUM, CREATEDIN, CREATEDON, 
            CREATEDBY, LASTMODIFIEDON, LASTMODIFIEDBY, COMPANYCODE, LOCATIONCODE, 
            DEACTIVATEDON, DEACTIVATEDBY, SERIALNO, ISAPPLICABLE, RENEWALTYPE, 
            RENEWALVALUE)
            VALUES
            ((SELECT MAX(RELATIONCODE) + 1 FROM IM_INDPOLCATEGORYAGERELATION), L_POLCATESETTLMITAGECODE, SDTL.RELATION, DTL.GROSSPREMIUM, NULL, 
            SYSDATE, 100000000000001417, SYSDATE, 100000000000001417, 1, 
            1, NULL, NULL, (SELECT MAX(SERIALNO) + 1 FROM IM_INDPOLCATEGORYAGERELATION), 1, 
            NULL, NULL);
            COMMIT;
        END LOOP;   
      END LOOP;

  END LOOP;   
END IF; 
END LOOP;
END;
                   
 

             

