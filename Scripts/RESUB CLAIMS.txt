
DECLARE L_SENDERID VARCHAR2(100);L_CLAIMID VARCHAR2(100);L_MEMBERID VARCHAR2(100);
L_RADATE DATE;L_ENCOUNTERSTARTDATE DATE; L_TDATE DATE;
BEGIN
FOR HDR IN(SELECT MAP_VALUE,CARDNO,CLAIM_CODE FROM IM_CLAIM_PROCESS_HEADER  WHERE RESUBMISSION_COMMENTS IS NOT NULL
AND CLAIM_STATUS = 1 AND MEDREFDATE IS NOT NULL) LOOP

SELECT SENDER_ID,CLAIM_ID,MEMBER_ID,To_Date(ENCOUNTER_START,'DD/MM/RRRR'),To_Date(TRANSACTION_DATE,'DD/MM/RRRR')
INTO L_SENDERID,L_CLAIMID,L_MEMBERID,L_ENCOUNTERSTARTDATE,L_TDATE FROM ECLAIMS WHERE SYS_CLAIM_ID = HDR.MAP_VALUE;

SELECT Max(RAUPLOADDATE) INTO L_RADATE FROM ECLAIMS WHERE SENDER_ID = L_SENDERID
AND CLAIM_ID = L_CLAIMID AND  UPPER(TRIM(REPLACE(L_MEMBERID,' ','')))=UPPER(TRIM(REPLACE(MEMBER_ID,' ','')))
AND To_Date(ENCOUNTER_START,'DD/MM/RRRR') = To_Date(L_ENCOUNTERSTARTDATE,'DD/MM/RRRR') AND RAUPLOADDATE IS NOT NULL
AND To_Date(TRANSACTION_DATE,'DD/MM/RRRR') <> To_Date(L_TDATE,'DD/MM/RRRR') ;


UPDATE IM_CLAIM_PROCESS_HEADER SET MEDREFDATE = L_RADATE WHERE CLAIM_CODE = HDR.CLAIM_CODE;
COMMIT;
         
END LOOP;
END;

