  
DECLARE L_GENDER NUMBER;
L_RELATION NUMBER;
L_RELATIONNAME VARCHAR2(500);
L_MARITALSTATUS NUMBER;
L_NATIONALITY NUMBER;L_LOCATION NUMBER;
L_SALARYBAND NUMBER;L_SALARYBANDNAME VARCHAR2(500);
L_POLICY_ROW IM_POLICY%ROWTYPE; L_PARENTCODE NUMBER;
BEGIN
FOR HDR IN(SELECT * FROM IM_PR_NXT_ACTIVE_LIST WHERE EXTREF IN
(SELECT POLICYID FROM IM_POLICY  WHERE  POLICYID IS NOT NULL)) LOOP  
SELECT * INTO L_POLICY_ROW FROM IM_POLICY WHERE POLICYID = HDR.EXTREF;
SELECT Max(MEMBER_CODE) INTO L_PARENTCODE FROM IM_MEMBERS WHERE Upper(MEMBER_ID) = Upper(HDR.PRINCIPALID);
SELECT Max(CONSTANTVALUE) INTO L_GENDER FROM GENCONSTANT WHERE CATEGORY = 'GENDER' AND
Upper(CONSTANTNAME) = Upper(HDR.GENDER) AND Upper(LANGUAGECODE) = 'EN-US';   
SELECT Max(CONSTANTVALUE) INTO L_MARITALSTATUS FROM GENCONSTANT WHERE CATEGORY = 'MARITAL_STATUS' AND
Upper(CONSTANTNAME) = Upper(HDR.MARITALSTATUS) AND Upper(LANGUAGECODE) = 'EN-US';   
SELECT Max(CONSTANTVALUE) INTO L_NATIONALITY FROM GENCONSTANT WHERE CATEGORY = 'FND_NATIONALITY' AND
Upper(CONSTANTNAME) = Upper(HDR.NATIONALITY) AND Upper(LANGUAGECODE) = 'EN-US';
SELECT Max(CONSTANTVALUE) INTO L_LOCATION FROM GENCONSTANT WHERE CATEGORY = 'MEMBERLOCATION' AND
Upper(CONSTANTNAME) = Upper(HDR.SUBREGION) AND Upper(LANGUAGECODE) = 'EN-US';     
IF HDR.SALARY = '0' THEN
L_SALARYBAND := 4;
ELSIF HDR.SALARY = '1' OR  HDR.SALARY = '3999' THEN
L_SALARYBAND := 1;
ELSIF HDR.SALARY = '4001' THEN
L_SALARYBAND := 2;
ELSE
L_SALARYBAND := 3;    
END IF;
IF Upper(HDR.DEPENDENCY) = 'PRINCIPAL' THEN
L_RELATIONNAME := 'SELF';
ELSIF Upper(HDR.DEPENDENCY) = 'SPOUSE' AND L_GENDER = 0  THEN
L_RELATIONNAME := 'HUSBAND';
ELSIF Upper(HDR.DEPENDENCY) = 'SPOUSE' AND L_GENDER = 1  THEN
L_RELATIONNAME := 'WIFE';
ELSIF Upper(HDR.DEPENDENCY) = 'CHILD' AND L_GENDER = 0  THEN
L_RELATIONNAME := 'SON';
ELSIF Upper(HDR.DEPENDENCY) = 'CHILD' AND L_GENDER = 1  THEN
L_RELATIONNAME := 'DAUGHTER';
ELSE
L_RELATIONNAME := 'OTHERS';
END IF;         
SELECT Max(CONSTANTVALUE) INTO L_RELATION FROM GENCONSTANT WHERE CATEGORY = 'MEMBERRELATION' AND
Upper(CONSTANTNAME) = Upper(L_RELATIONNAME) AND Upper(LANGUAGECODE) = 'EN-US';  
INSERT INTO IM_MEMBERS(
GROUP_CODE, MEMBER_CODE, MEMBER_ID, MEMBER_TYPE, FIRST_NAME, LAST_NAME, ARABIC_FIRST_NAME, PICTURE, 
ATTACHMENT, DATE_OF_BIRTH, GENDER, RELATION, DESIGNATION, NATIONALITY, NATIONALITY_DISPLAY, DEPARTMENT, EMIRATES_ID, 
MOBILE_NUMBER, PHONE_NUMBER, COVERED_FROM_DATE, EFFECTIVE_START_DATE, EFFECTIVE_END_DATE, 
PARENT_ID, CREATEDIN, CREATEDON, CREATEDBY, LASTMODIFIEDON, LASTMODIFIEDBY, LEGALENTITYCODE, CUSTOMERCODE, LOCATIONCODE, COMPANYCODE, 
SERIALNO, REMARKS, CATEGORY_CODE, RELATIONCODE, PRINTT, REPRINT, RETURNED, MARITAL_STATUS, CARDAMOUNT, CARDNO, USERCODE, 
COVERED_END_DATE, CARDID, EMAILID, ADDRESS, EMPLOYEENO, EMIRATECODE, POLICYMEMBERID, PARENTGROUPCODE, INCEPTION_DATE, 
ISEXISTINGMEMBER, EXISTING_INSURER, DATE_OF_ENTRY, COCEXPIRY, OCCUPATION, ADDRESS1, ADDRESS2, PHONE_NO, MOBILE_NO, EMAIL_ID, 
PASSPORT_NO, HEIGHT, WEIGHT, STAFF_ID, DISCOUNT_PCT, LOADING_PCT, LOCATION, STATUS, USERNAME, PASSWORD, 
MEMBERPOLICYCODE, POLICYCODE, POLICYTYPE, APM_PRODUCT_CODE, APM_SERIAL_NO, APM_PRODUCT_CATEGORY, APM_UW_YEAR, APM_MEMBER_NO, APM_MEM_REFERENCE_NO, 
APM_ACTIVE_FLAG, MEMBERREFCODE, OLDMEMBERID, SHOWSUBGROUPINCARD, ADDMEMBERPOLICYCODE, ADDMEMBERDETCODE, POLICYADDREFCODE, INDPOLICYADDREFCODE, 
IP_MEM_CODE, POLICY_MEM_CODE, MEMBERSINCE, APOLICYID, APOLICYNAME, FINEAMOUNT, ASTAFF_ID, TMEMBERSINCE, 
TPICTURE, ENTRYTYPE, HAADFINE, WAIVEAMOUNT, NOOFDAYS, WORKLOCATION, RESIDENTLOCATION, ISCOMMISSION, SALARYBAND, UIDNUMBER, 
ISPREEXISTING, ENTITYTYPE, ENTITYID, MIDDLENAME, ISMEMBERDATAUPLOADED, IMAGEUPDATE, MEMBERENTITYIDNAME, NATIONALITY_OLD, UPS)
VALUES(
L_POLICY_ROW.GROUPCODE, AV_SEQ_MEM_PK.NEXTVAL,HDR.BENEFICIARYID, 1, HDR.BENEFICIARYFIRSTNAME, HDR.BENEFICIARYFAMILYNAME, HDR.BENEFICIARYFIRSTNAME , NULL, 
NULL,To_Date(HDR.DOB,'DD/MM/RRRR'),L_GENDER,L_RELATION,NULL,L_NATIONALITY, L_NATIONALITY, NULL, HDR.IDNUMBER, 
HDR.MOBILENBR, HDR.MOBILENBR,To_Date(HDR.EFFECTIVEDATE,'DD/MM/RRRR'),To_Date(HDR.EFFECTIVEDATE,'DD/MM/RRRR'), To_Date(HDR.EXPIRYDATE,'DD/MM/RRRR'), 
L_PARENTCODE, 1, NULL, 100000000000000002, NULL, 100000000000000002, 100000000000000001, 100000000000000001, 1, 1, 
 AV_SEQ_MEM_SNO.NEXTVAL, NULL, 100000000000000003, L_RELATION, 0, 0, 0, L_MARITALSTATUS, NULL,HDR.CARDNUMBER, 100000000000000271, 
To_Date(HDR.EXPIRYDATE,'DD/MM/RRRR'),HDR.CARDNUMBER, HDR.EMAILADDRESS, NULL, NULL, NULL, NULL, NULL, To_Date(HDR.EFFECTIVEDATE,'DD/MM/RRRR'),
NULL, NULL, NULL, NULL, NULL, NULL, NULL, HDR.MOBILENBR, HDR.MOBILENBR,HDR.EMAILADDRESS, 
HDR.PASSPORTNUMBER, NULL, NULL,HDR.STAFFNBR, NULL, NULL, 1, 0,NULL,NULL, 
NULL, L_POLICY_ROW.POLICYCODE, 1,NULL,NULL, NULL, NULL,NULL,NULL, 
'A', NULL, NULL, NULL, NULL, NULL, NULL, NULL, 
NULL,NULL,To_Date(HDR.EFFECTIVEDATE,'DD/MM/RRRR'),L_POLICY_ROW.POLICYID,L_POLICY_ROW.POLICYNAME, NULL, HDR.STAFFNBR, NULL, 
NULL, NULL, NULL, NULL, NULL, L_LOCATION, L_LOCATION, 2, L_SALARYBAND, HDR.UIDNUMBER, 
NULL, 1, NULL, HDR.BENEFICIARYMIDDLENAME, 1, NULL, HDR.UIDNUMBER, L_NATIONALITY, 1206);
COMMIT;        
END LOOP;
END;


                                                                                                       
                                                                  
                                                                              