DECLARE L_CODE NUMBER;
BEGIN
FOR HDR IN(SELECT MPOL.*,PDTL.POLICYFINANCEPOSTINGCODE
FROM IM_MEMBERPOLICY MPOL
JOIN IM_POLICYFINANCEPOSTINGDTL PDTL ON PDTL.MEMBERPOLICYCODE = MPOL.MEMBERPOLICYCODE       
WHERE PDTL.POLICYFINANCEPOSTINGCODE IN
(SELECT REF_CODE FROM IM_NGI_JVPOSTING WHERE REFDATE > To_Date('01/01/2018','DD/MM/RRRR')
AND REF_CODE IS NOT NULL)  AND PDTL.REFUNDPREMIUM <> 0 

)  LOOP

SELECT Max(PFPDETAILCODE) INTO L_CODE FROM IM_POLICYFINANCE_VAT WHERE
CARDNO = HDR.ACARDID AND POLICYCODE = HDR.POLICYCODE AND ADDITIONAMOUNT <> 0;

UPDATE IM_POLICYFINANCE_VAT SET REFERENCECODE = HDR.POLICYFINANCEPOSTINGCODE WHERE PFPDETAILCODE= L_CODE;
COMMIT; 
END LOOP;
END;





