BEGIN
FOR HDR IN(SELECT  AMEMBERID,CLINE,A.MEMBERPOLICYCODE,M.POLICYCODE APOLICYCODE,A.POLICYCODE,SF_GETMAINBRANCH (A.MEMBERPOLICYCODE) BRANCHNAME,
SF_GETDISTRIBUTORTYPE(A.MEMBERPOLICYCODE) DISTRIBUTORTYPE,
SF_GETDISTRIBUTORNAME(A.MEMBERPOLICYCODE) DISTRIBUTORNAME,
SF_GETPLANNAME (A.MEMBERPOLICYCODE) PLANNAME,Nvl(APOLICYID,POL.POLICYID) POLICYID,Nvl(APOLICYNAME,POL.POLICYNAME)POLICYNAME,
POLICYSTARTDDATE,POLICYENDDDATE,MEMBERSTARTDATE,MEMBERENDDATE,
AMEMBERNAME,ACARDID,POL.POLICYNAME PRODUCTNAME,GRP.GROUP_NAME CONTRACTNAME,ADATE_OF_BIRTH,DECODE (M.AGENDER,  0, 'MALE',  1, 'FEMALE') GENDER,
 GEN.CONSTANTNAME NATIONALITY,G4.CONSTANTNAME MARITALSTATUS,GENC3.CONSTANTNAME SALARYBAND,C.CATEGORY_ID   FROM IM_EFORM_UW_HDR_M2019 A
LEFT JOIN IM_MEMBERPOLICY_POSTING M ON A.MEMBERPOLICYCODE = M.MEMBERPOLICYCODE
LEFT JOIN IM_POLICY POL ON POL.POLICYCODE = A.POLICYCODE     
LEFT JOIN IM_CATEGORIES C ON C.CATEGORY_CODE = M.CATEGORYCODE
LEFT JOIN IM_GROUPS GRP ON GRP.GROUP_CODE = POL.GROUPCODE 
LEFT JOIN GENCONSTANT GEN ON     GEN.CONSTANTVALUE = M.A_NATIONALITY AND GEN.CATEGORY = 'FND_NATIONALITY' AND UPPER (GEN.LANGUAGECODE) = 'EN-US'
LEFT JOIN GENCONSTANT GENC3 ON     GENC3.CATEGORY = 'SALARYBANDTYPE' AND GENC3.CONSTANTVALUE = M.SALARYBAND AND UPPER (GENC3.LANGUAGECODE) = 'EN-US'
LEFT JOIN GENCONSTANT G4 ON     G4.CATEGORY = 'MARITAL_STATUS' AND G4.CONSTANTVALUE = M.A_MARITAL_STATUS AND UPPER (G4.LANGUAGECODE) = 'EN-US'
LEFT JOIN GENCONSTANT GEN2 ON     GEN2.CONSTANTVALUE = M.ARELATION AND GEN2.CATEGORY = 'MEMBERRELATION' AND UPPER (GEN2.LANGUAGECODE) = 'EN-US'     
WHERE DISTRIBUTORNAME IS NULL   AND Upper(A.POLICYTYPE) = 'GROUP') LOOP
UPDATE  IM_EFORM_UW_HDR_M2019 SET BRANCHNAME = HDR.BRANCHNAME,DISTRIBUTORTYPE = HDR.DISTRIBUTORTYPE,DISTRIBUTORNAME = HDR.DISTRIBUTORNAME,
PLANNAME = HDR.PLANNAME,PRODUCTNAME = HDR.PRODUCTNAME,CONTRACTNAME = HDR.CONTRACTNAME,CONTRACTEFFECTIVEDATE = HDR.POLICYSTARTDDATE,
CONTRACTEXPIRYDATE = HDR.POLICYENDDDATE,BENEFICIARYSTARTDATE = HDR.MEMBERSTARTDATE,BENEFICIARYENDDATE = HDR.MEMBERENDDATE,
CONTRACTINCEPTIONDATE = HDR.POLICYSTARTDDATE,POLICYNUMBER = HDR.POLICYID,BENEFICIARYID = HDR.AMEMBERID,
BENEFICIARYFIRSTNAME = HDR.AMEMBERNAME,DATEOFBIRTH = HDR.ADATE_OF_BIRTH,GENDER = HDR.GENDER,BENEFICIARYNATIONALITY = HDR.NATIONALITY,
CARDNUMBER = HDR.ACARDID,MARITALSTATUS = HDR.MARITALSTATUS,SALARYBAND = HDR.SALARYBAND WHERE CLINE = HDR.CLINE;
COMMIT;
END LOOP;
END;


BEGIN
FOR HDR IN(SELECT  AMEMBERID,CLINE,A.MEMBERPOLICYCODE,M.POLICYCODE APOLICYCODE,A.POLICYCODE,SF_GETMAINBRANCH (A.MEMBERPOLICYCODE) BRANCHNAME,
SF_GETDISTRIBUTORTYPE(A.MEMBERPOLICYCODE) DISTRIBUTORTYPE,
SF_GETDISTRIBUTORNAME(A.MEMBERPOLICYCODE) DISTRIBUTORNAME,
SF_GETPLANNAME (A.MEMBERPOLICYCODE) PLANNAME,Nvl(APOLICYID,POL.POLICYID) POLICYID,Nvl(APOLICYNAME,POL.POLICYNAME)POLICYNAME,
POLICYSTARTDDATE,POLICYENDDDATE,MEMBERSTARTDATE,MEMBERENDDATE,
AMEMBERNAME,ACARDID,POL.POLICYNAME PRODUCTNAME,GRP.GROUP_NAME CONTRACTNAME,ADATE_OF_BIRTH,DECODE (M.AGENDER,  0, 'MALE',  1, 'FEMALE') GENDER,
 GEN.CONSTANTNAME NATIONALITY,G4.CONSTANTNAME MARITALSTATUS,GENC3.CONSTANTNAME SALARYBAND,C.CATEGORY_ID   FROM IM_EFORM_UW_HDR_M2019 A
LEFT JOIN IM_MEMBERPOLICY_POSTING M ON A.MEMBERPOLICYCODE = M.MEMBERPOLICYCODE
LEFT JOIN IM_INDIVIDUALPOLICY POL ON POL.INDIVIDUALPOLICYCODE = A.POLICYCODE     
LEFT JOIN IM_CATEGORIES C ON C.CATEGORY_CODE = M.CATEGORYCODE
LEFT JOIN IM_GROUPS GRP ON GRP.GROUP_CODE = POL.GROUPCODE 
LEFT JOIN GENCONSTANT GEN ON     GEN.CONSTANTVALUE = M.A_NATIONALITY AND GEN.CATEGORY = 'FND_NATIONALITY' AND UPPER (GEN.LANGUAGECODE) = 'EN-US'
LEFT JOIN GENCONSTANT GENC3 ON     GENC3.CATEGORY = 'SALARYBANDTYPE' AND GENC3.CONSTANTVALUE = M.SALARYBAND AND UPPER (GENC3.LANGUAGECODE) = 'EN-US'
LEFT JOIN GENCONSTANT G4 ON     G4.CATEGORY = 'MARITAL_STATUS' AND G4.CONSTANTVALUE = M.A_MARITAL_STATUS AND UPPER (G4.LANGUAGECODE) = 'EN-US'
LEFT JOIN GENCONSTANT GEN2 ON     GEN2.CONSTANTVALUE = M.ARELATION AND GEN2.CATEGORY = 'MEMBERRELATION' AND UPPER (GEN2.LANGUAGECODE) = 'EN-US'     
WHERE DISTRIBUTORNAME IS NULL   AND Upper(A.POLICYTYPE) = 'INDIVIDUAL') LOOP
UPDATE  IM_EFORM_UW_HDR_M2019 SET BRANCHNAME = HDR.BRANCHNAME,DISTRIBUTORTYPE = HDR.DISTRIBUTORTYPE,DISTRIBUTORNAME = HDR.DISTRIBUTORNAME,
PLANNAME = HDR.PLANNAME,PRODUCTNAME = HDR.PRODUCTNAME,CONTRACTNAME = HDR.CONTRACTNAME,CONTRACTEFFECTIVEDATE = HDR.POLICYSTARTDDATE,
CONTRACTEXPIRYDATE = HDR.POLICYENDDDATE,BENEFICIARYSTARTDATE = HDR.MEMBERSTARTDATE,BENEFICIARYENDDATE = HDR.MEMBERENDDATE,
CONTRACTINCEPTIONDATE = HDR.POLICYSTARTDDATE,POLICYNUMBER = HDR.POLICYID,BENEFICIARYID = HDR.AMEMBERID,
BENEFICIARYFIRSTNAME = HDR.AMEMBERNAME,DATEOFBIRTH = HDR.ADATE_OF_BIRTH,GENDER = HDR.GENDER,BENEFICIARYNATIONALITY = HDR.NATIONALITY,
CARDNUMBER = HDR.ACARDID,MARITALSTATUS = HDR.MARITALSTATUS,SALARYBAND = HDR.SALARYBAND WHERE CLINE = HDR.CLINE;
COMMIT;
END LOOP;
END;

BEGIN
FOR HDR IN(SELECT A.*,CONSTANTNAME   FROM IM_EFORM_UW_HDR_M2019 A
JOIN IM_POLICY P ON  A.POLICYCODE = P.POLICYCODE AND Upper(A.POLICYTYPE) = 'GROUP'
LEFT JOIN GENCONSTANT G ON G.CATEGORY = 'NGIQUOTATIONTYPE' AND G.CONSTANTVALUE = P.OWNERCODE AND Upper(G.LANGUAGECODE) = 'EN-US'
WHERE A.MANAGEDBY IS NULL) LOOP

UPDATE  IM_EFORM_UW_HDR_M2019  SET  MANAGEDBY = HDR.CONSTANTNAME WHERE CLINE = HDR.CLINE;
COMMIT;


END LOOP;
END; 


BEGIN
FOR HDR IN(SELECT A.*,CONSTANTNAME   FROM IM_EFORM_UW_HDR_M2019 A
JOIN IM_INDIVIDUALPOLICY P ON  A.POLICYCODE = P.INDIVIDUALPOLICYCODE AND Upper(A.POLICYTYPE) = 'INDIVIDUAL'
LEFT JOIN GENCONSTANT G ON G.CATEGORY = 'NGIQUOTATIONTYPE' AND G.CONSTANTVALUE = P.OWNERCODE AND Upper(G.LANGUAGECODE) = 'EN-US'
) LOOP

UPDATE  IM_EFORM_UW_HDR_M2019  SET  MANAGEDBY = HDR.CONSTANTNAME WHERE CLINE = HDR.CLINE;
COMMIT;


END LOOP;
END; 


DECLARE L_RULES VARCHAR2(500);
BEGIN
FOR HDR IN(SELECT DISTINCT POL.POLICYCODE,To_Char(POL.STARTDATE,'RRRR') UWYEAR FROM IM_EFORM_UW_HDR_M2019  P,IM_POLICY POL
WHERE Upper(POLICYTYPE) = 'GROUP' AND P.POLICYCODE = POL.POLICYCODE) LOOP

IF HDR.UWYEAR = 2018 THEN
L_RULES:=INSERTGROUPHEPTREATY(HDR.POLICYCODE,8,100000000000000236);
ELSIF HDR.UWYEAR = 2019 THEN
L_RULES:=INSERTGROUPHEPTREATY(HDR.POLICYCODE,8,100000000000000233);
END IF;

END LOOP;
END;


DECLARE L_RULES VARCHAR2(500);
BEGIN
FOR HDR IN(SELECT DISTINCT POL.POLICYCODE,To_Char(POL.STARTDATE,'RRRR') UWYEAR FROM IM_EFORM_UW_HDR_M2019  P,IM_POLICY POL
WHERE Upper(POLICYTYPE) = 'GROUP' AND P.POLICYCODE = POL.POLICYCODE) LOOP

IF HDR.UWYEAR = 2018 THEN
L_RULES:=INSERTGROUPHEPTREATY(HDR.POLICYCODE,9,100000000000000235);
ELSIF HDR.UWYEAR = 2019 THEN
L_RULES:=INSERTGROUPHEPTREATY(HDR.POLICYCODE,9,100000000000000232);
END IF;

END LOOP;    
END;        



DECLARE L_RULES VARCHAR2(500);
BEGIN
FOR HDR IN(SELECT DISTINCT POL.INDIVIDUALPOLICYCODE,To_Char(POL.STARTDATE,'RRRR') UWYEAR FROM IM_EFORM_UW_HDR_M2019  P,IM_INDIVIDUALPOLICY POL
WHERE Upper(POLICYTYPE) = 'INDIVIDUAL' AND P.POLICYCODE = POL.INDIVIDUALPOLICYCODE) LOOP

IF HDR.UWYEAR = 2018 THEN
L_RULES:=INSERTINDPHEPTREATY(HDR.INDIVIDUALPOLICYCODE,8,100000000000000236);
ELSIF HDR.UWYEAR = 2019 THEN
L_RULES:=INSERTINDPHEPTREATY(HDR.INDIVIDUALPOLICYCODE,8,100000000000000233);
END IF;

END LOOP;
END;


DECLARE L_RULES VARCHAR2(500);
BEGIN
FOR HDR IN(SELECT DISTINCT POL.INDIVIDUALPOLICYCODE,To_Char(POL.STARTDATE,'RRRR') UWYEAR FROM IM_EFORM_UW_HDR_M2019  P,IM_INDIVIDUALPOLICY POL
WHERE Upper(POLICYTYPE) = 'INDIVIDUAL' AND P.POLICYCODE = POL.INDIVIDUALPOLICYCODE) LOOP

IF HDR.UWYEAR = 2018 THEN
L_RULES:=INSERTINDPHEPTREATY(HDR.INDIVIDUALPOLICYCODE,9,100000000000000235);
ELSIF HDR.UWYEAR = 2019 THEN
L_RULES:=INSERTINDPHEPTREATY(HDR.INDIVIDUALPOLICYCODE,9,100000000000000232);
END IF;

END LOOP;    
END;                                                                            


UPDATE IM_EFORM_UW_HDR_M2019 SET TOTALPREMIUM = 0 WHERE TOTALPREMIUM IS NULL;
UPDATE IM_EFORM_UW_HDR_M2019 SET HEPPREMIUM = 0 WHERE HEPPREMIUM IS NULL;
UPDATE IM_EFORM_UW_HDR_M2019 SET CANPREMIUM = 0 WHERE CANPREMIUM IS NULL;
UPDATE IM_EFORM_UW_HDR_M2019 SET IPPREMIUM = 0 WHERE IPPREMIUM IS NULL;
UPDATE IM_EFORM_UW_HDR_M2019 SET OPPREMIUM = 0 WHERE OPPREMIUM IS NULL;
UPDATE IM_EFORM_UW_HDR_M2019 SET ADMINFEE = 0 WHERE ADMINFEE IS NULL;
UPDATE IM_EFORM_UW_HDR_M2019 SET TPAFEE = 0 WHERE TPAFEE IS NULL;
UPDATE IM_EFORM_UW_HDR_M2019 SET NGI_FEES = 0 WHERE NGI_FEES IS NULL;
UPDATE IM_EFORM_UW_HDR_M2019 SET AGENTCOM = 0 WHERE AGENTCOM IS NULL;
UPDATE IM_EFORM_UW_HDR_M2019 SET LIFEPREMIUM = 0 WHERE LIFEPREMIUM IS NULL; 


BEGIN
FOR HDR IN(SELECT JV1.REF_NO NEWNO,JV1.REFDATE DOCDATE,JV.REF_NO OLDNO FROM IM_NGI_JVPOSTING JV,IM_NGI_JVPOSTING JV1 
WHERE JV.JVPOSTINGCODE=JV1.REVERSEJVCODE AND JV1.REF_NO IN
('02191154094','02191154139','02191154269','02191154579','02191155408','02191154292'
) )   LOOP
INSERT INTO IM_EFORM_UW_HDR_M2019 
SELECT * FROM IM_EFORM_UW_HDR WHERE ENDORESMENTID = HDR.OLDNO;
COMMIT;
UPDATE IM_EFORM_UW_HDR_M2019 SET ENDORESMENTID = HDR.NEWNO,ENDORESMENTDATE = HDR.DOCDATE,
ENDORESMENTISSUEDATE = HDR.DOCDATE,ADDPREMIUM = ADDPREMIUM*-1,REFUNDPREMIUM = REFUNDPREMIUM*-1,
IPPREMIUM = IPPREMIUM*-1,OPPREMIUM = OPPREMIUM*-1,TOTALPREMIUM = TOTALPREMIUM *-1,
CANPREMIUM = CANPREMIUM*-1,HEPPREMIUM = HEPPREMIUM*-1,LIFEPREMIUM = LIFEPREMIUM*-1,
ADMINFEE = ADMINFEE*-1,AGENTCOM = AGENTCOM*-1,TPAFEE = TPAFEE*-1,NGI_fEES = NGI_FEES*-1
WHERE  ENDORESMENTID = HDR.OLDNO;
COMMIT;
END LOOP;
END;





                       
                                                              
                                                              