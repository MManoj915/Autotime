SELECT * FROM (SELECT GROUPNAME,CLIENTNAME,BRANCHNAME,DOCDATE,AGENT,POLICYNAME,PAYMENTMODE,POLICYCODE,ADMISTRATEBY,
NVL(GET_POLICYINCEPTIONPREMIUM(POLICYTYPECODE,POLICYCODE),0) INCEPTIONPREMIUM,
NVL(GET_POLICYINCADDREFPREMIUM(POLICYTYPECODE,POLICYCODE),0)  ADDREFUNDAMOUNT,
0  PREMIUMVALUE FROM (  
SELECT  'LOST BUSINESS' GROUPNAME,POL.POLICYNAME CLIENTNAME,BAR1.ORGANIZATION_NAME BRANCHNAME ,POL.STARTDATE DOCDATE,POL.ENDDATE EXPIRYDATE,
NVL(AGE.AGENT_NAME_EN,BRO.BROKER_NAME_EN) AGENT,POL.POLICYID POLICYNAME,0 ADDREFUNDAMOUNT,GENN2.CONSTANTNAME PAYMENTMODE,
POL.POLICYCODE,GEN10.CONSTANTNAME ADMISTRATEBY,NULL BILLINGTYPENAME,NULL ENDORSEMENTNO,1 POLICYTYPECODE FROM
(SELECT * FROM IM_POLICY  WHERE PORTALMEMBERID IS NULL AND   POLICYCODE NOT  IN (SELECT NVL(OLDPOLICYCODE,0) FROM IM_POLICY )
AND TO_DATE(ENDDATE , 'DD/MM/RRRR') + 1 BETWEEN TO_DATE('01/06/2019', 'DD/MM/RRRR') AND TO_DATE('30/06/2019', 'DD/MM/RRRR') --AND OWNERCODE IN (1,4)   
) POL
LEFT JOIN IM_AGENTS AGE ON AGE.AGENTCODE=POL.AGENTCODE
LEFT JOIN IM_BROKERS BRO ON BRO.BROKERCODE=POL.BROKERCODE
LEFT JOIN HR_ORGANIZATIONS_D BAR1 ON BAR1.ORGANIZATIONS_CODE=(NVL(POL.BRANCHCODE,DECODE(POL.BILLINGTYPE,0, AGE.BRANCHCODE,1,BRO.BRANCHCODE,NVL(POL.BRANCHCODE,NVL(AGE.BRANCHCODE,BRO.BRANCHCODE)))))
LEFT JOIN GENCONSTANT GEN10 ON GEN10.CONSTANTVALUE=POL.OWNERCODE AND GEN10.CATEGORY='NGIQUOTATIONTYPE' AND UPPER(GEN10.LANGUAGECODE)='EN-US'
LEFT JOIN GENCONSTANT  GENN2 ON GENN2.CONSTANTVALUE=POL.PAYMENTMODE AND GENN2.CATEGORY='POLICYPAYMENTMODE' AND UPPER(GENN2.LANGUAGECODE)='EN-US'
GROUP BY
POL.POLICYNAME,NVL(AGE.AGENT_NAME_EN,BRO.BROKER_NAME_EN),POL.POLICYID,POL.STARTDATE ,POL.ENDDATE,
POL.POLICYCODE,BAR1.ORGANIZATION_NAME,GEN10.CONSTANTNAME,GENN2.CONSTANTNAME  
UNION ALL
SELECT 'LOST BUSINESS' GROUPNAME,INDPOL.POLICYNAME CLIENTNAME,BAR1.ORGANIZATION_NAME BRANCHNAME ,INDPOL.STARTDATE DOCDATE,INDPOL.ENDDATE EXPIRYDATE,
NVL(AGE.AGENT_NAME_EN,BRO.BROKER_NAME_EN) AGENT,
INDPOL.POLICYID POLICYNAME,0 ADDREFUNDAMOUNT,GENN2.CONSTANTNAME PAYMENTMODE,INDPOL.INDIVIDUALPOLICYCODE ,GEN10.CONSTANTNAME ADMISTRATEBY,
NULL BILLINGTYPENAME,NULL ENDORSEMENTNO,2 POLICYTYPECODE FROM
( SELECT * FROM IM_INDIVIDUALPOLICY WHERE PORTALMEMBERID IS NULL AND  INDIVIDUALPOLICYCODE NOT  IN (SELECT NVL(OLDPOLICYCODE,0) FROM IM_INDIVIDUALPOLICY ) AND
TO_DATE(ENDDATE , 'DD/MM/RRRR') + 1 BETWEEN TO_DATE('01/06/2019', 'DD/MM/RRRR') AND TO_DATE('30/06/2019', 'DD/MM/RRRR') --AND OWNERCODE IN (1,4)   
) INDPOL
LEFT JOIN IM_AGENTS AGE ON AGE.AGENTCODE=INDPOL.AGENTCODE
LEFT JOIN IM_BROKERS BRO ON BRO.BROKERCODE=INDPOL.BROKERCODE
LEFT JOIN HR_ORGANIZATIONS_D BAR1 ON BAR1.ORGANIZATIONS_CODE=(NVL(INDPOL.BRANCHCODE,DECODE(INDPOL.BILLINGTYPE,0, AGE.BRANCHCODE,1,BRO.BRANCHCODE,NVL(INDPOL.BRANCHCODE,NVL(AGE.BRANCHCODE,BRO.BRANCHCODE)))))
LEFT JOIN GENCONSTANT GEN10 ON GEN10.CONSTANTVALUE=INDPOL.OWNERCODE AND GEN10.CATEGORY='NGIQUOTATIONTYPE' AND UPPER(GEN10.LANGUAGECODE)='EN-US'
LEFT JOIN GENCONSTANT  GENN2 ON GENN2.CONSTANTVALUE=INDPOL.PAYMENTMODE AND GENN2.CATEGORY='POLICYPAYMENTMODE' AND UPPER(GENN2.LANGUAGECODE)='EN-US'
WHERE TO_DATE(INDPOL.ENDDATE,'DD/MM/RRRR') BETWEEN TO_DATE('01/06/2019','DD/MM/RRRR') AND TO_DATE('30/06/2019','DD/MM/RRRR') AND INDPOL.OLDPOLICYCODE IS NULL
GROUP BY INDPOL.POLICYNAME,NVL(AGE.AGENT_NAME_EN,BRO.BROKER_NAME_EN),INDPOL.POLICYID,INDPOL.STARTDATE,INDPOL.ENDDATE,
INDPOL.INDIVIDUALPOLICYCODE,BAR1.ORGANIZATION_NAME,GEN10.CONSTANTNAME,GENN2.CONSTANTNAME  ))  
