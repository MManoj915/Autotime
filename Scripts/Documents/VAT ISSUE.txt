

SELECT * FROM(SELECT Sum(M.AMOUNT) AMOUNT,Sum(VATAMOUNT)VATAMOUNT,DOCNO,DOC_TYPE,JV.REF_CODE FROM IM_FINANCE_LINK_POSTING M,IM_NGI_JVPOSTING JV WHERE M.VATAMOUNT  <> ROUND(M.AMOUNT*0.05,2)
AND To_Date(DOCDATE,'DD/MM/RRRR') > To_Date('01/01/2019','DD/MM/RRRR') AND DOC_TYPE <> 'CLM' AND M.DOCNO = JV.REF_NO
AND M.AMOUNT <> 0 AND DOCNO NOT IN(SELECT REF_NO FROM  IM_NGI_JVPOSTING WHERE MEMBERTYPE=0)
AND DOCNO     NOT IN(SELECT REF_NO FROM  IM_NGI_JVPOSTING WHERE POLICYTYPE = 1) 
AND DOCNO NOT IN( SELECT REf_NO FROM IM_NGI_JVPOSTING WHERE REF_CODE=100000000000104588  )  GROUP BY DOCNO,DOC_TYPE,JV.REF_CODE ) 
WHERE REF_CODE      NOT  IN(SELECT REF_cODE FROM IM_NGI_JVPOSTING WHERE To_Date(REFDATE,'DD/MM/RRRR') < To_Date('01/01/2019','DD/MM/RRRR') AND REF_CODE IS NOT NULL) 
ORDER BY REF_CODE



SELECT Sum(AMOUNT) AMT,Sum(VATAMOUNT) VAMT,DOC_TYPE,REF_CODE FROM
(SELECT * FROM(SELECT Sum(M.AMOUNT) AMOUNT,Sum(VATAMOUNT)VATAMOUNT,DOCNO,DOC_TYPE,JV.REF_CODE FROM IM_FINANCE_LINK_POSTING M,IM_NGI_JVPOSTING JV WHERE M.VATAMOUNT  <> ROUND(M.AMOUNT*0.05,2)
AND To_Date(DOCDATE,'DD/MM/RRRR') > To_Date('01/03/2019','DD/MM/RRRR') AND DOC_TYPE <> 'CLM' AND M.DOCNO = JV.REF_NO
AND M.AMOUNT <> 0 AND DOCNO NOT IN(SELECT REF_NO FROM  IM_NGI_JVPOSTING WHERE MEMBERTYPE=0)
AND DOCNO     NOT IN(SELECT REF_NO FROM  IM_NGI_JVPOSTING WHERE POLICYTYPE = 1) 
AND DOCNO NOT IN( SELECT REf_NO FROM IM_NGI_JVPOSTING WHERE REF_CODE=100000000000104588  )  GROUP BY DOCNO,DOC_TYPE,JV.REF_CODE ) 
WHERE REF_CODE      NOT  IN(SELECT REF_cODE FROM IM_NGI_JVPOSTING WHERE To_Date(REFDATE,'DD/MM/RRRR') < To_Date('01/01/2019','DD/MM/RRRR') AND REF_CODE IS NOT NULL) 
ORDER BY REF_CODE
)  WHERE REF_CODE   IN(SELECT * FROM IM_VAT_REF)  GROUP BY DOC_TYPE,REF_CODE ORDER BY REF_CODE










SELECT * FROM IM_NGI_JVPOSTING WHERE REF_CODE=100000000000106272;

SELECT * FROM IM_FINANCE_LINK_POSTING WHERE DOCNO IN
(SELECT * FROM IM_NGI_JVPOSTING WHERE REF_CODE=100000000000112131)


CREATE TABLE IM_VAT_REF1 AS 
SELECT REF_CODE FROM(SELECT Sum(AMOUNT) AMOUNT,Sum(VATAMOUNT) VATAMOUNT,REF_CODE FROM
(SELECT * FROM(SELECT Sum(M.AMOUNT) AMOUNT,Sum(VATAMOUNT)VATAMOUNT,DOCNO,DOC_TYPE,JV.REF_CODE FROM IM_FINANCE_LINK_POSTING M,IM_NGI_JVPOSTING JV WHERE M.VATAMOUNT  <> ROUND(M.AMOUNT*0.05,2)
AND To_Date(DOCDATE,'DD/MM/RRRR') > To_Date('01/01/2019','DD/MM/RRRR') AND DOC_TYPE <> 'CLM' AND M.DOCNO = JV.REF_NO
AND M.AMOUNT <> 0 AND DOCNO NOT IN(SELECT REF_NO FROM  IM_NGI_JVPOSTING WHERE MEMBERTYPE=0)
AND DOCNO     NOT IN(SELECT REF_NO FROM  IM_NGI_JVPOSTING WHERE POLICYTYPE = 1) 
AND DOCNO NOT IN( SELECT REf_NO FROM IM_NGI_JVPOSTING WHERE REF_CODE=100000000000104588  )  GROUP BY DOCNO,DOC_TYPE,JV.REF_CODE ) 
WHERE REF_CODE      NOT  IN(SELECT REF_cODE FROM IM_NGI_JVPOSTING WHERE To_Date(REFDATE,'DD/MM/RRRR') < To_Date('01/01/2019','DD/MM/RRRR') AND REF_CODE IS NOT NULL) 
ORDER BY REF_CODE
) GROUP BY REF_CODE ORDER BY REF_CODE) WHERE AMOUNT = 0

 DROP TABLE IM_VAT_REF


SELECT * FROM
(SELECT * FROM(SELECT Sum(M.AMOUNT) AMOUNT,Sum(VATAMOUNT)VATAMOUNT,DOCNO,DOC_TYPE,JV.REF_CODE FROM IM_FINANCE_LINK_POSTING M,IM_NGI_JVPOSTING JV WHERE M.VATAMOUNT  <> ROUND(M.AMOUNT*0.05,2)
AND To_Date(DOCDATE,'DD/MM/RRRR') > To_Date('01/01/2019','DD/MM/RRRR') AND DOC_TYPE <> 'CLM' AND M.DOCNO = JV.REF_NO
AND M.AMOUNT <> 0 AND DOCNO NOT IN(SELECT REF_NO FROM  IM_NGI_JVPOSTING WHERE MEMBERTYPE=0)
AND DOCNO     NOT IN(SELECT REF_NO FROM  IM_NGI_JVPOSTING WHERE POLICYTYPE = 1) 
AND DOCNO NOT IN( SELECT REf_NO FROM IM_NGI_JVPOSTING WHERE REF_CODE=100000000000104588  )  GROUP BY DOCNO,DOC_TYPE,JV.REF_CODE ) 
WHERE REF_CODE      NOT  IN(SELECT REF_cODE FROM IM_NGI_JVPOSTING WHERE To_Date(REFDATE,'DD/MM/RRRR') < To_Date('01/01/2019','DD/MM/RRRR') AND REF_CODE IS NOT NULL) 
ORDER BY REF_CODE
)  WHERE REF_CODE   IN(SELECT * FROM IM_VAT_REF)  ORDER BY REF_CODE
                    