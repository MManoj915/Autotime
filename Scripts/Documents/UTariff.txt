SELECT * FROM IM_CLAIM_PROCESS_HEADER WHERE H.MEMBERPOLICYCODE IN
(SELECT MEMBERPOLICYCODE FROM IM_MEMBERPOLICY WHERE (APOLICYID,POLICYCODE,CATEGORYCODE) IN
(SELECT P.POLICYID,P.POLICYCODE,PD.CATEGORYCODE FROM IM_POLICY P,IM_POLICY_CATEGORYDTL PD,IM_POLICYCOVEREDNETWORK PN  
WHERE PN.NETWORKCODE IN(1000000000000000031,1000000000000000032) AND PD.PCDCODE = PN.PCDCODE 
AND P.POLICYCODE = PD.POLICYCODE   AND P.OWNERCODE IN(3,21,25,26) )) AND H.REQUEST_TYPE = 1
AND Nvl(H.AUTHORIZEDSTATUS,0) = 0  AND SubStr(H.ACR_FORM_NO,0,1) = 'E'  


DECLARE L_NETWORKCODE NUMBER;L_PRICE NUMBER(19,2);
BEGIN
FOR HDR IN(SELECT NW.NETWORKCODE,H.POLICYCODE,H.CATEGORY_CODE,A.ACTIVITY_DETAIL_CODE,H.PROVIDER_CODE,D.CODE,A.ACTIVITYSTARTDATE,
REQUESTAMOUNT,QTY,A.DENIAL_REASON,PRICEBK,PRICE,PROVIDERNETPRICE FROM IM_CLAIM_PROCESS_DETAIL A,IM_CLAIM_PROCESS_HEADER H,IM_VERSION_DETALIS D,
IM_POLICY_CATEGORYDTL PD,IM_POLICYCOVEREDNETWORK NW WHERE
A.CLAIM_CODE = H.CLAIM_CODE AND H.PROVIDER_CODE IN
(SELECT PROVIDERCODE FROM IM_PROVIDERS WHERE PROVIDERID='M748')   AND NVL(H.AUTHORIZEDSTATUS,0) = 0 AND A.VERSIONDETAILCODE = D.DETAILCODE 
AND Nvl(A.TYPE,0) = 0 AND A.ACTIVITY_CODE NOT IN(100000000000000003) 
AND PD.CATEGORYCODE = H.CATEGORY_CODE AND  PD.PCDCODE = NW.PCDCODE  AND   NVL(NW.ACTIVE,0) = 1  AND H.POLICYCODE = PD.POLICYCODE 
AND REQUESTAMOUNT > PRICE
) LOOP  
L_PRICE:=NGI_LOADCLAIMS.NGI_GETDHATARIFFPRICE(1,HDR.PROVIDER_CODE,HDR.CODE,HDR.ACTIVITYSTARTDATE,HDR.NETWORKCODE);
--UPDATE IM_CLAIM_PROCESS_DETAIL SET PRICE=PRICEBK,PROVIDERNETPRICE=PRICEBK WHERE ACTIVITY_DETAIL_CODE=HDR.ACTIVITY_DETAIL_CODE;
COMMIT;
UPDATE IM_CLAIM_PROCESS_DETAIL SET PRICEBK=L_PRICE WHERE ACTIVITY_DETAIL_CODE=HDR.ACTIVITY_DETAIL_CODE;
COMMIT;
END LOOP;
END;



DECLARE L_NETWORKCODE NUMBER;L_PRICE NUMBER(19,2);
BEGIN
FOR HDR IN(SELECT H.POLICYCODE,A.ACTIVITY_CODE,H.CATEGORY_CODE,A.ACTIVITY_DETAIL_CODE,H.PROVIDER_CODE,D.CODE,A.ACTIVITYSTARTDATE,PRICE,PROVIDERNETPRICE 
FROM IM_CLAIM_PROCESS_DETAIL A,IM_CLAIM_PROCESS_HEADER H,IM_VERSION_DETALIS D WHERE
A.CLAIM_CODE = H.CLAIM_CODE AND  H.MEMBERPOLICYCODE IN
(SELECT MEMBERPOLICYCODE FROM IM_MEMBERPOLICY WHERE (APOLICYID,POLICYCODE,CATEGORYCODE) IN
(SELECT P.POLICYID,P.POLICYCODE,PD.CATEGORYCODE FROM IM_POLICY P,IM_POLICY_CATEGORYDTL PD,IM_POLICYCOVEREDNETWORK PN  
WHERE PN.NETWORKCODE IN(1000000000000000031,1000000000000000032) AND PD.PCDCODE = PN.PCDCODE 
AND P.POLICYCODE = PD.POLICYCODE   AND P.OWNERCODE IN(3,21,25,26) )) AND H.REQUEST_TYPE = 1
AND Nvl(H.AUTHORIZEDSTATUS,0) = 0  AND SubStr(H.ACR_FORM_NO,0,1) = 'E'  
AND A.VERSIONDETAILCODE = D.DETAILCODE  AND Nvl(A.TYPE,0) = 0 AND A.ACTIVITY_CODE NOT IN(100000000000000003) ) LOOP
SELECT  Max(IPCN.NETWORKCODE) INTO L_NETWORKCODE  FROM IM_POLICY POL
LEFT JOIN IM_POLICY_CATEGORYDTL DTL ON DTL.POLICYCODE = POL.POLICYCODE
LEFT JOIN IM_POLICYCOVEREDNETWORK IPCN ON IPCN.PCDCODE = DTL.PCDCODE
WHERE POL.POLICYCODE = HDR.POLICYCODE  AND POL.POLICYCODE = HDR.POLICYCODE AND DTL.CATEGORYCODE = HDR.CATEGORY_CODE
AND Nvl(IPCN.ACTIVE,0) = 1;   
L_PRICE:=NGI_LOADCLAIMS.NGI_GETDHATARIFFPRICE(1,HDR.PROVIDER_CODE,HDR.CODE,HDR.ACTIVITYSTARTDATE,L_NETWORKCODE);
UPDATE IM_CLAIM_PROCESS_DETAIL SET PRICEBK = L_PRICE,TOBEUP=8 WHERE ACTIVITY_DETAIL_CODE=HDR.ACTIVITY_DETAIL_CODE;
COMMIT;
END LOOP;
END;


DECLARE L_NETWORKCODE NUMBER;L_PRICE NUMBER(19,2);
BEGIN
FOR HDR IN(SELECT H.POLICYCODE,H.CATEGORY_CODE,A.ACTIVITY_DETAIL_CODE,H.PROVIDER_CODE,D.CODE,A.ACTIVITYSTARTDATE,PRICE,PROVIDERNETPRICE FROM IM_CLAIM_PROCESS_DETAIL A,IM_CLAIM_PROCESS_HEADER H,IM_VERSION_DETALIS D WHERE
A.CLAIM_CODE = H.CLAIM_CODE AND  H.CLAIM_CODE= 100000000004776649
AND Nvl(H.AUTHORIZEDSTATUS,0) = 0 AND A.VERSIONDETAILCODE = D.DETAILCODE AND PRICE <> 0 ) LOOP
SELECT  Max(IPCN.NETWORKCODE) INTO L_NETWORKCODE  FROM IM_POLICY POL
LEFT JOIN IM_POLICY_CATEGORYDTL DTL ON DTL.POLICYCODE = POL.POLICYCODE
LEFT JOIN IM_POLICYCOVEREDNETWORK IPCN ON IPCN.PCDCODE = DTL.PCDCODE
WHERE POL.POLICYCODE = HDR.POLICYCODE  AND POL.POLICYCODE = HDR.POLICYCODE AND DTL.CATEGORYCODE = HDR.CATEGORY_CODE
AND Nvl(IPCN.ACTIVE,0) = 1;   
L_PRICE:=NGI_LOADCLAIMS.NGI_GETDHATARIFFPRICE(1,HDR.PROVIDER_CODE,HDR.CODE,HDR.ACTIVITYSTARTDATE,L_NETWORKCODE);
UPDATE IM_CLAIM_PROCESS_DETAIL SET PRICE = L_PRICE,PROVIDERNETPRICE = L_PRICE WHERE ACTIVITY_DETAIL_CODE=HDR.ACTIVITY_DETAIL_CODE;
COMMIT;
END LOOP;
END;




SELECT  Max(IPCN.NETWORKCODE)  FROM IM_POLICY POL
LEFT JOIN IM_POLICY_CATEGORYDTL DTL ON DTL.POLICYCODE = POL.POLICYCODE
LEFT JOIN IM_POLICYCOVEREDNETWORK IPCN ON IPCN.PCDCODE = DTL.PCDCODE
WHERE POL.POLICYCODE =100000000000024016 AND DTL.CATEGORYCODE = 100000000000000003
AND Nvl(IPCN.ACTIVE,0) = 1;   


SELECT * FROM IM_PROVIDER_TARIFF_DETAILS WHERE TARIFFCODE IN(SELECT TARIFFCODE FROM IM_PROVIDER_TARIFF WHERE PROVIDERCODE =1000000000000001085
AND STANDARDCODE IN(SELECT DETAILCODE FROM IM_VERSION_DETALIS WHERE CODE IN ('10','84484','93000')))   AND NETWORKCODE=1000000000000000031


BEGIN
FOR HDR IN(SELECT ACTIVITY_DETAIL_CODE,QTY,VERSIONDETAILCODE,CLAIM_CODE,REQUESTAMOUNT,SYS_ACTIVITY_STATUS,PRICE,PROVIDERNETPRICE,PRICEBK FROM IM_CLAIM_PROCESS_DETAIL WHERE TOBEUP = 8
AND PRICE <> PRICEBK  AND CLAIM_CODE IN
(SELECT CLAIM_CODE FROM IM_CLAIM_PROCESS_HEADER WHERE CLAIM_CODE IN(SELECT DISTINCT CLAIM_CODE  FROM IM_CLAIM_PROCESS_DETAIL WHERE TOBEUP = 8
AND PRICE <> PRICEBK   

                                                               )     AND CLAIM_STATUS = 1 ) 

)     LOOP
UPDATE IM_CLAIM_PROCESS_DETAIL SET PRICE = HDR.PRICEBK,PROVIDERNETPRICE = HDR.PRICEBK,SYS_ACTIVITY_STATUS = 1,
DENIAL_VALUE = 0,DENIAL_REASON = NULL WHERE ACTIVITY_DETAIL_CODE = HDR.ACTIVITY_DETAIL_CODE;
COMMIT;
DELETE FROM IM_CLAIM_PROCESS_DETAIL_DTL WHERE ACTIVITY_DETAIL_CODE = HDR.ACTIVITY_DETAIL_CODE;
COMMIT;
END LOOP;
END;

                                                               








                                    