SELECT PAYMENTNO,H.PAYMENTCODE,D.APPLICATIONCODE,AUTHORIZEDSTATUS,PAYMENTMETHOD,POLICYFINANCEPOSTINGCODE FROM IM_PR_PAYMENT_HDR H,IM_PR_PAYMENT_DTL D
WHERE H.PAYMENTCODE = D.PAYMENTCODE AND PAYMENTMETHOD <> 3 AND H.PAYMENTCODE IN(SELECT PAYMENTCODE FROM IM_PR_PAYMENT_DTL WHERE APPLICATIONCODE IN
(SELECT APPLICATIONCODE FROM IM_PR_PAYMENT_DTL WHERE PAYMENTCODE IN
(SELECT Max(PAYMENTCODE) FROM IM_PR_PAYMENT_DTL  
GROUP BY APPLICATIONCODE HAVING Count(*) > 1)))
AND APPLICATIONCODE NOT IN(100000000000000091,100000000000000093,100000000000000094) ORDER BY APPLICATIONCODE 

                         
SELECT * FROM IM_PR_PAYMENT_DTL WHERE PAYMENTCODE IN(100000000000000987,100000000000000988)
SELECT * FROM IM_PR_PAYMENT_HDR WHERE PAYMENTCODE NOT IN
(SELECT PAYMENTCODE FROM IM_PR_PAYMENT_DTL )

SELECT * FROM IM_PR_PAYMENT_HDR WHERE  PAYMENTCODE IN(
SELECT PAYMENTCODE FROM   IM_PR_PAYMENT_DTL WHERE  APPLICATIONCODE=100000000000000199)



BEGIN
FOR HDR IN(SELECT Min(PAYMENTCODE) FROM(SELECT PAYMENTNO,H.PAYMENTCODE,D.APPLICATIONCODE,AUTHORIZEDSTATUS FROM IM_PR_PAYMENT_HDR H,IM_PR_PAYMENT_DTL D
WHERE H.PAYMENTCODE = D.PAYMENTCODE AND PAYMENTMETHOD <> 3  AND H.PAYMENTCODE IN(SELECT PAYMENTCODE FROM IM_PR_PAYMENT_DTL WHERE APPLICATIONCODE IN
(SELECT APPLICATIONCODE FROM IM_PR_PAYMENT_DTL WHERE PAYMENTCODE IN
(SELECT Max(PAYMENTCODE) FROM IM_PR_PAYMENT_DTL  
GROUP BY APPLICATIONCODE HAVING Count(*) > 1)))
AND APPLICATIONCODE NOT IN(100000000000000091,100000000000000093,100000000000000094) ORDER BY APPLICATIONCODE )
GROUP BY APPLICATIONCODE ) LOOP
DELETE FROM  IM_PR_PAYMENT_HDR WHERE AUTHORIZEDSTATUS =1 AND PAYMENTMETHOD <> 3;
COMMIT;  
END LOOP;
END;
 